---
ms.date: 06/12/2017
contributor: JKeithB
keywords: коллекции,powershell,командлет,psgallery
description: Руководства для издателей
title: Руководства и рекомендации для публикации коллекции PowerShell
ms.openlocfilehash: 64c3d607b13dce64f70f138fdee849e5baaf85df
ms.sourcegitcommit: 6ae5b50a4b3ffcd649de1525c3ce6f15d3669082
ms.translationtype: MTE95
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2019
ms.locfileid: "56265575"
---
# <a name="powershellgallery-publishing-guidelines-and-best-practices"></a>Руководства и рекомендации для публикации коллекции PowerShell

Это руководство описывает рекомендуемые специалистами Майкрософт этапы, гарантирующие, что пакеты, опубликованные в коллекции PowerShell, получат широкое распространение среди пользователей и будут полезны для них. Это возможно благодаря тому, как именно коллекция PowerShell обрабатывает данные манифеста, а также получению отзывов большого количества пользователей коллекции PowerShell.
Пакеты, опубликованные в соответствии с рекомендациями этого руководства, с большей вероятностью будут установлены, считаясь надежными и популярными среди большого количества пользователей.

Ниже приведены рекомендации, которые помогут оптимизировать пакет коллекции PowerShell, описаны самые важные необязательные параметры манифеста. Кроме того здесь приведены советы по улучшению вашего кода на основе отзывов первоначальных рецензентов и [анализатора скриптов PowerShell](https://aka.ms/psscriptanalyzer), управлению версиями модуля, а также работе с документацией, тестами и примерами использования опубликованных пакетов.
Большая часть этой документации содержит рекомендации по публикации [высококачественных модулей ресурсов DSC](https://github.com/PowerShell/DscResources/blob/master/HighQualityModuleGuidelines.md).

См. дополнительные сведения о [создании и публикации пакета в коллекции PowerShell](/powershell/gallery/how-to/publishing-packages/publishing-a-package).

Мы будем рады получить ваши отзывы об этом руководстве. Чтобы оставить отзыв, перейдите на вкладку с вопросами в [репозитории документации Github](https://github.com/powershell/powershell-docs/issues).

## <a name="best-practices-for-publishing-packages"></a>Рекомендации по публикации пакетов

Ниже приведены важные рекомендации пользователей, использующих элементы коллекции PowerShell. Они перечисляются в порядке номинального приоритета.
Пользователи чаще скачивают и применяют пакеты, опубликованные в соответствии с этими рекомендациями.

- Используйте PSScriptAnalyzer.
- Добавьте документацию и примеры.
- Поддерживайте обратную связь с пользователями.
- Предоставьте модули вместо скриптов.
- Предоставьте ссылки на сайт проекта.
- Тег пакет с помощью совместимых PSEdition(s) и платформ 
- Добавьте проверку модулей.
- Включите условия лицензионного соглашения и/или предоставьте ссылку на них.
- Подписание кода
- Следуйте рекомендациям [SemVer](http://semver.org/) по управлению версиями.
- Используйте общие теги, как описано в коллекции тегов распространенных модулей PowerShell.
- Тестируйте публикацию с помощью локального репозитория
- Публикация с помощью PowerShellGet

Каждая из этих рекомендаций кратко описывается в разделах ниже.

## <a name="use-psscriptanalyzer"></a>Использование PSScriptAnalyzer

[PSScriptAnalyzer](https://www.powershellgallery.com/packages/PSScriptAnalyzer) — это бесплатное средство статического анализа кода, которое можно использовать с кодом PowerShell.
PSScriptAnalyzer определяет наиболее распространенные проблемы, возникающие в коде PowerShell, и часто предоставляет рекомендации по устранению проблемы.
Это средство просто в использовании и классифицирует проблемы как ошибки (серьезные ошибки, которые необходимо устранить), предупреждения (которые необходимо изучить и устранить) и сведения (которые следует рассмотреть для получения рекомендаций).
Все пакеты, опубликованные в коллекции PowerShell, будут сканироваться с помощью PSScriptAnalyzer. Сведения об ошибках, которые необходимо устранить, будут передаваться владельцу для устранения.

Мы рекомендуем запустить `Invoke-ScriptAnalyzer` с предупреждением `-Recurse` и `-Severity`.

Просмотрите результаты и убедитесь, что:

- в документации исправлены или устранены все ошибки;
- все предупреждения проверены и по возможности устранены.

Мы настоятельно рекомендуем пользователям, получившим пакеты из коллекции PowerShell, запустить PSScriptAnalyzer и проверить все ошибки и предупреждения.
Если PSScriptAnalyzer обнаруживает ошибку, это значит, что пользователи, скорее всего, будут обращаться к владельцам пакетов.
Если есть веское основание сохранить код пакета, который помечен как ошибка, добавьте эти сведения в документацию, чтобы не отвечать на один и тот же вопрос несколько раз.

## <a name="include-documentation-and-examples"></a>Добавление документации и примеров

Документация и примеры — это лучший способ для пользователей воспользоваться преимуществами любого общего кода.

Документация — это самое полезное, что следует добавить в пакеты, публикуемые в коллекции PowerShell.
Как правило, пользователи не обращают внимание на пакеты без документации. так как иначе им нужно просматривать код, чтобы понять, что это за пакет и как его использовать.
Доступно несколько статей о том, как добавить документацию к пакетам PowerShell:

- Рекомендации по предоставлению справки, которые находятся в статье [How to Write Cmdlet Help](https://go.microsoft.com/fwlink/?LinkID=123415) (Как писать справку для командлетов).
- Создание справки по командлетам (самый оптимальный вариант для любого скрипта, функции или командлета PowerShell).
  См. дополнительные сведения о [написании справки по командлетам](https://go.microsoft.com/fwlink/?LinkID=123415).
  Сведения о том, как добавить справку в скрипт, см. в статье [About Comment Based Help](/powershell/module/microsoft.powershell.core/about/about_comment_based_help) (Справка на основе комментариев).
- Много модулей также содержат документацию в текстовом формате, например файлы MarkDown.
  Это может быть особенно полезно при наличии сайта проекта на Github, где интенсивно используется формат Markdown.
  Мы рекомендуем использовать [GitHub Flavored Markdown](https://help.github.com/categories/writing-on-github/).

На примерах пользователи смогут понять как необходимо использовать пакет.
Многие разработчики указывают, что прежде чем изучить документацию, они просматривают примеры, чтобы понять, как использовать элемент.
В лучших типах примеров показаны базовые варианты использования, а также имитация реальных вариантов использования. Приведенные примеры кода хорошо комментируются.
Примеры для модулей, опубликованные в коллекции PowerShell, должны находиться в папке примеров в корневом элементе модуля.

Хороший шаблон для примеров можно найти в [модуле PSDscResource](https://www.powershellgallery.com/packages/PSDscResources) в папке Examples\RegistryResource.
Существует четыре примера варианта использования с кратким описанием в верхней части каждого файла, которые содержат сведения о рассматриваемых вариантах.

## <a name="respond-to-feedback"></a>Обратная связь с пользователями

Владельцы пакетов, должным образом отвечающие на отзывы, вносят ценный вклад в сообщество.
Очень важно реагировать на конструктивные отзывы пользователей, так как их интерес к пакету может способствовать его улучшению.

В коллекции PowerShell можно использовать следующие два метода обратной связи:

- Обращение к владельцу. Эта возможность позволяет пользователю отправить сообщение по электронной почте владельцу пакета. Владельцу пакета следует просматривать электронную почту, указанную для пакетов коллекции PowerShell, и реагировать на возникающие вопросы. Единственный недостаток этого метода в том, что информацию видит только пользователь и владелец, поэтому владелец может отвечать на один и тот же вопрос несколько раз.
- Комментарии. В нижней части страницы пакета есть поле для отправки комментария.
  Преимущество этой системы заключается в том, что остальные пользователи могут просматривать комментарии и ответы. Поэтому владельцу не нужно будет отвечать на один и тот же вопрос.
  Мы настоятельно рекомендуем владельцу пакета просматривать комментарии к каждому пакету.
Сведения о том, как это сделать, см. в статье [Providing Feedback via Social Media or Comments](../how-to/working-with-packages/social-media-feedback.md) (Предоставление отзыва с помощью социальных сетей или комментариев).

Владельцы, дающие конструктивные ответы на отзывы, высоко ценятся в сообществе.
Используйте отчеты, чтобы при необходимости запросить дополнительные сведения, предоставить возможное решение или определить, устранит ли обновление проблему.

Если в любом из этих каналов связи наблюдается неправильное поведение, воспользуйтесь функцией Report Abuse (Сообщить о нарушении) коллекции PowerShell, чтобы связаться с администраторами коллекции.

## <a name="modules-versus-scripts"></a>Модули и скрипты

Совместное использование скрипта с другими пользователями — это отличная идея. Другие пользователи могут просматривать примеры решения проблем, которые могут возникнуть.
Проблема заключается в том, что скрипты в коллекции PowerShell — это отдельные файлы, которые не содержат документации, примеров и тестов.

Структура папок модулей PowerShell позволяет включать в пакет несколько папок и файлов.
Структура модуля позволяет добавлять другие пакеты, перечисленные в списке рекомендаций: справка по командлетам, документация, примеры и тесты.
Существенным недостатком является то, что скрипт внутри модуля должен предоставляться и использоваться как функция.
Сведения о создании модуля см. в статье [Writing a Windows PowerShell Module](http://go.microsoft.com/fwlink/?LinkId=144916) (Написание модуля Windows PowerShell).

Существуют ситуации, когда скрипт улучшает взаимодействие с пользователем, в особенности с конфигурацией DSC.
Мы рекомендуем опубликовать конфигурацию DSC как скрипт с сопутствующим модулем, содержащим документы, примеры и тесты.
Скрипт указывает сопутствующий модуль, используя RequiredModules = @(имя модуля).
Этот подход можно использовать для любого скрипта.

Автономные скрипты, реализующие эти рекомендации, полезны для пользователей.
При публикации скрипта в коллекции PowerShell мы настоятельно рекомендуем предоставить документацию на основе комментариев и ссылку на сайт проекта.

## <a name="provide-a-link-to-a-project-site"></a>Предоставление ссылки на сайт проекта

На сайте проекта издатель может напрямую взаимодействовать с пользователями пакетов коллекции PowerShell.
Пользователи предпочитают использовать пакеты, связанные с сайтом проекта, из-за большего удобства получения информации о пакете.
Многие пакеты в коллекции PowerShell разработаны на GitHub, другие предоставляются организациями, имеющими свои веб-сайты.
Каждый из них можно рассматривать как сайт проекта.

Чтобы добавить ссылку, включите ProjectURI в раздел PSData манифеста следующим образом:

        # A URL to the main website for this project.
        ProjectUri = 'https://github.com/powershell/powershell'

Если указан ProjectURI, коллекция PowerShell будет отображать ссылку на сайт проекта в левой части страницы пакета.

## <a name="tag-your-package-with-the-compatible-pseditions-and-platforms"></a>Тег пакет с помощью совместимых PSEdition(s) и платформ 

Чтобы продемонстрировать пользователям, которые пакеты будут работать с их среды с помощью следующих тегов:

- PSEdition_Desktop: Пакеты, которые совместимы с Windows PowerShell 
- PSEdition_Core: Пакеты, которые совместимы с Powershell Core 
- Windows: Пакетов, совместимых с операционной системой Windows
- Linux: Пакетов, совместимые с ОС Linux 
- MacOS: Пакетов, совместимых с операционной системой Mac

## <a name="include-tests"></a>Включение тестов

Для пользователей очень важно включить тесты с открытым кодом, так как это дает гарантии относительно проверенных элементов. Кроме того, они смогут понять, как работает ваш код. Пользователи также могут убедиться, что они не нарушат исходную функциональность, если изменят код в соответствии с требованиями их среды.

Мы рекомендуем написать тест, чтобы воспользоваться преимуществами тестовой платформы Pester, разработанной специально для PowerShell.
Pester доступен на сайте [GitHub](https://github.com/Pester/Pester), в [коллекции PowerShell](https://www.powershellgallery.com/packages/Pester/) и предоставляется в Windows 10, Windows Server 2016, WMF 5.0 и WMF 5.1.

[Сайт проекта Pester в GitHub](https://github.com/Pester/Pester) содержит отличную документацию по написанию тестов Pester для начинающих и продвинутых пользователей.

Целевые объекты для тестов указаны в [документации по высококачественному модулю ресурсов](https://github.com/PowerShell/DscResources/blob/master/HighQualityModuleGuidelines.md) с рекомендуемым покрытием кода модульных тестов 70 %.

## <a name="include-andor-link-to-license-terms"></a>Включение условий лицензионного соглашения и/или предоставление ссылки на них

Для всех пакетов, опубликованных в коллекции PowerShell, необходимо указать условия лицензии, или же использование пакета должно регулироваться лицензией, представленной в приложении А к [условиям использования](https://www.powershellgallery.com/policies/Terms).
Чтобы указать другую лицензию, лучше всего предоставить на нее ссылку с помощью LicenseURI в PSData.
Пример можно найти в разделе рекомендуемых полей манифеста.

```powershell
PrivateData = @{
    PSData = @{

        # Tags applied to this module. These help with module discovery in online galleries.
        Tags = @('.net','acl','active-directory')

        # A URL to the license for this module.
        LicenseUri = 'http://www.apache.org/licenses/LICENSE-2.0'
```

## <a name="sign-your-code"></a>Подписание кода

Подписывая код, владелец пакета подтверждает свою надежность и гарантирует достоверность опубликованного кода.
Общие сведения о подписании кода см. в [этой статье](http://go.microsoft.com/fwlink/?LinkId=106296).
PowerShell поддерживает проверку подписи кода, используя два основных подхода:

- подписание файлов скрипта;
- подписание модулей каталога.

Подписание файлов PowerShell — это известный подход, гарантирующий, что выполняемый код создан с помощью надежного источника и не изменялся.
Сведения о том, как подписать файлы скрипта PowerShell, рассматриваются в [этой статье](/powershell/module/microsoft.powershell.core/about/about_signing).
В целом подпись можно добавить в любой PS1-файл, который проверяет PowerShell во время загрузки скрипта.
Действия PowerShell можно ограничить с помощью командлетов [политики выполнения](/powershell/module/microsoft.powershell.core/about/about_execution_policies), чтобы обеспечить использование подписанных скриптов.

Функция подписания модулей каталога была добавлена в PowerShell версии 5.1.
Сведения о подписании модулей см. в статье [Командлеты для работы с каталогами](/powershell/wmf/5.1/catalog-cmdlets).
Для подписания каталога создается файл каталога, содержащий значение хэша для каждого файла модуля, после чего подписывается файл.
Командлеты PowerShellGet, такие как Publish-Module, Install-Module, Save-Module и Update-Module, проверят достоверность подписи, а затем подтвердят, что значение хэша каждого пакета соответствует значениям в каталоге.
Если в системе установлена предыдущая версия модуля, в командлете Install-Module будет показано, что заверитель подписи для новой версии совпадает с заверителем для установленной ранее.
Подписание каталога работает с подписанными файлами скрипта, но не заменяет их. PowerShell не выполняет проверку подписи каталога во время загрузки модуля.

## <a name="follow-semver-guidelines-for-versioning"></a>Следуйте рекомендациям SemVer по управлению версиями

[SemVer](http://semver.org/) — это общедоступное соглашение, в котором описаны принципы структурирования и изменения версий для простой интерпретации изменений.
Версия вашего пакета должна быть включена в данные манифеста.

- Она должна соответствовать числовым блокам с 3 сегментами, разделенными точками, как в версии 0.1.1 или 4.11.192.
- Если номер версии начинается с 0, это значит, что пакет еще не готов к использованию в рабочей среде. Версия должна начинаться с 0, только если она является единственной.
- Изменения в первом числе (1.9.9999 на 2.0.0) указывают основные и критические изменения между версиями.
- Изменения во втором числе (1.2 вместо 1.1) указывают на изменения на уровне компонента, например добавление новых командлетов в модуль.
- Изменения в третьем числе указывают некритические изменения, например новые параметры, обновленные примеры или новые тесты.
- При перечислении версий PowerShell отсортирует версии как строки. Поэтому версия 1.01.0 будет считаться больше версии 1.001.0.

PowerShell была создана перед публикацией SemVer, поэтому она поддерживает большинство элементов SemVer, в частности:

- Она не поддерживает предварительные строки в номерах версий. Это удобно, если издателю необходимо доставить предварительную версию новой основной версии после предоставления версии 1.0.0. Эту функцию будет добавлено в будущих выпусках коллекции PowerShell и командлетов PowerShellGet.
- PowerShell и коллекция PowerShell позволяют использовать строки версии с 1, 2 и 4 сегментами. Много предыдущих версий модулей не соответствовали рекомендациям, и выпуски продуктов корпорации Майкрософт включают сведения о построении блоков чисел с 4 сегментами (например, 5.1.14393.1066). С точки зрения управления версиями эти различия игнорируются.

## <a name="test-using-a-local-repository"></a>Тестирование с помощью локального репозитория

Коллекция PowerShell не должна быть целевой для тестирования процесса публикации.
Лучший способ протестировать весь процесс публикации в коллекции PowerShell — настроить и использовать ваш собственный локальный репозиторий.
Это можно сделать несколькими способами:

- Настройте локальный экземпляр коллекции PowerShell с помощью [проекта закрытой коллекции PS](https://github.com/PowerShell/PSPrivateGallery) в Github. Предварительная версия проекта поможет вам создать управляемый экземпляр коллекции PowerShell, который можно использовать для тестов.
- Настройте [внутренний репозиторий Nuget](https://blogs.msdn.microsoft.com/powershell/2014/05/20/setting-up-an-internal-powershellget-repository/). Данный способ более трудоемкий, однако он позволит вам проверить соответствие еще ряду требований (например, проверить использование ключа API и наличие в целевом объекте зависимостей при публикации).
- Настройте общую папку в качестве тестового репозитория. Сделать это несложно, однако, поскольку используется общая папка, указанные выше проверки выполняться не будут. Одно из возможных преимуществ этого способа в том, что общая папка не проверяет (требуемый) ключ API и вы можете использовать тот же ключ, что и для публикации в коллекции PowerShell.

Прибегнув к любому описанному способу, вы сможете использовать Register-PSRepository, чтобы задать новый репозиторий, который используется в свойстве -Repository для Publish-Module.

Еще кое-что о тестировании публикаций: публикуемые в коллекции PowerShell пакеты можно удалить только с помощью специалистов эксплуатационной команды, которые подтвердят, что удаление пакета ни на что не повлияет.
Поэтому мы не поддерживаем использование коллекции PowerShell в качестве целевого объекта тестирования и обязательно свяжемся с любым издателем, который так делает.

## <a name="use-powershellget-to-publish"></a>Публикация с помощью PowerShellGet

Издателям настоятельно рекомендуется использование командлетов Publish-Module и Publish-Script при работе с коллекцией PowerShell.
Благодаря PowerShellGet вам не нужно запоминать важные сведения об установке из коллекции PowerShell и публикации в ней.
В некоторых случаях издатели используют клиент NuGet вместо PowerShellGet или командлеты PackageManagement вместо Publish-Module.
При этом возможно упущение ряда сведений, что приводит к росту обращений в службу поддержки.

При наличии причин, которые делают невозможным использование Publish-Module и Publish-Script, сообщите нам об этом.
Зарегистрируйте вопрос в репозитории GitHub PowerShellGet и укажите причины, побудившие вас выбрать NuGet или PackageManagement.

## <a name="recommended-workflow"></a>Рекомендуемый рабочий процесс

Самый оптимальный подход к разработке и сопровождению пакета, публикуемого в коллекции PowerShell, предполагает следующее:

- Выполните первоначальную стадию разработки на сайте проекта с открытым кодом. Команда разработчиков PowerShell использует Github.
- Используйте отзывы рецензентов и [анализатора скрипта Powershell](https://aka.ms/psscriptanalyzer), чтобы достичь стабильного состояния кода.
- Включите документацию, чтобы другие пользователи узнали, как использовать вашу работу.
- Тестирование публикации с помощью локального репозитория.
- Опубликуйте стабильную версию или альфа-версию в коллекции PowerShell. Не забудьте включить документацию и ссылку на сайт проекта.
- Собирайте отзывы и выполняйте итерацию кода на сайте проекта, а затем публикуйте надежные обновления в коллекцию PowerShell.
- Добавляйте примеры и тесты Pester в свой проект и модуль.
- Определите, хотите ли вы подписать код своего пакета.
- Если вы считаете, что проект готов к использованию в рабочей среде, опубликуйте версию 1.0.0 в коллекцию PowerShell.
- Продолжайте собирать отзывы и выполняйте итерацию кода на основе пользовательского входа.

