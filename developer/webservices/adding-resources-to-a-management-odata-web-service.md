---
title: Добавление ресурсов в OData веб-службы управления | Документация Майкрософт
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: e7445ba8203da304286c591ff513900ad1c244a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62080787"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="19151-102">Добавление ресурсов в веб-службу управления OData</span><span class="sxs-lookup"><span data-stu-id="19151-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="19151-103">В этом примере демонстрируется добавление ресурса к существующей веб-службы OData для управления с помощью конструктора схемы управления OData.</span><span class="sxs-lookup"><span data-stu-id="19151-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="19151-104">[PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) пример создает веб-службы, предоставляющий ресурсы процесса и сервер.</span><span class="sxs-lookup"><span data-stu-id="19151-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="19151-105">В этом примере вы добавите ресурс виртуальной машины (VM) в веб-службу.</span><span class="sxs-lookup"><span data-stu-id="19151-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="19151-106">Необходимые компоненты</span><span class="sxs-lookup"><span data-stu-id="19151-106">Prerequisites</span></span>

<span data-ttu-id="19151-107">В этом разделе предполагается, что вы загрузили и установили [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) пример, как описано в разделе [веб-службы Windows PowerShell](./creating-a-management-odata-web-service.md), и, загрузка и установка завершена [Конструктор схем OData управления](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span><span class="sxs-lookup"><span data-stu-id="19151-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="19151-108">В этом разделе также предполагается, что у вас есть модуль Windows PowerShell Hyper-V, установленных на компьютере, предназначенный для настройки конечной точки Odata для управления.</span><span class="sxs-lookup"><span data-stu-id="19151-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="19151-109">Добавление виртуальной Машины в качестве ресурса в веб-службу</span><span class="sxs-lookup"><span data-stu-id="19151-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="19151-110">Первым делом для импорта схемы из существующей конечной точки OData для управления в конструктор схем.</span><span class="sxs-lookup"><span data-stu-id="19151-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="19151-111">Ниже описано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="19151-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="19151-112">Импорт существующей схемы в конструктор схем</span><span class="sxs-lookup"><span data-stu-id="19151-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="19151-113">Откройте конструктор схем OData управления.</span><span class="sxs-lookup"><span data-stu-id="19151-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="19151-114">Из **файл** меню, выберите **файл** ; **Новый** ; **Файл**.</span><span class="sxs-lookup"><span data-stu-id="19151-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="19151-115">**Новый файл** откроется диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="19151-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="19151-116">Нажмите кнопку **модель управления OData**, а затем нажмите кнопку **откройте**.</span><span class="sxs-lookup"><span data-stu-id="19151-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="19151-117">Щелкните правой кнопкой мыши в главном окне и нажмите кнопку **файл схемы** ; **Импорта**.</span><span class="sxs-lookup"><span data-stu-id="19151-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="19151-118">**Откройте** откроется диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="19151-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="19151-119">Перейдите к папке, предназначенный для настройки веб-службы OData для управления [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) образца.</span><span class="sxs-lookup"><span data-stu-id="19151-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="19151-120">Если вы использовали сценарий Windows PowerShell, в состав этого образца для настройки конечной точки без изменения сценария, эту папку является **C:\inetpub\wwwroot\Modata**.</span><span class="sxs-lookup"><span data-stu-id="19151-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="19151-121">Выберите Schema.mof и нажмите кнопку **откройте**.</span><span class="sxs-lookup"><span data-stu-id="19151-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="19151-122">На этом этапе открыть файлы Schema.mof и Schema.xml в текстовом редакторе и обратите внимание на то, что они содержат сопоставления для процесса и службы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="19151-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="19151-123">Schema.MOF-файл использует [Distributed Management Task Force](https://www.dmtf.org/) standard (DTMF) управляемого объекта (MOF).</span><span class="sxs-lookup"><span data-stu-id="19151-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="19151-124">Файл schema.xml использует схему XML, описанной в [схема сопоставления ресурсов](./resource-mapping-schema.md).</span><span class="sxs-lookup"><span data-stu-id="19151-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="19151-125">Следующая процедура описывается импорт командлетов Hyper-V в для модели схемы.</span><span class="sxs-lookup"><span data-stu-id="19151-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="19151-126">Импорт командлетов в схеме</span><span class="sxs-lookup"><span data-stu-id="19151-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="19151-127">Щелкните правой кнопкой мыши на пустую область окна конструктора схемы и нажмите кнопку **командлеты импорта**.</span><span class="sxs-lookup"><span data-stu-id="19151-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="19151-128">**Мастер импорта командлета** откроется диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="19151-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="19151-129">Убедитесь, что **локального компьютера** выбран и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="19151-130">Убедитесь, что выбран установленных модулей Windows PowerShell и выберите в раскрывающемся списке Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="19151-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="19151-131">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-131">click **Next**.</span></span> <span data-ttu-id="19151-132">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-132">Click **Next**.</span></span>

4. <span data-ttu-id="19151-133">В **существительное командлет** выберите **виртуальной Машины**.</span><span class="sxs-lookup"><span data-stu-id="19151-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="19151-134">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-134">Click **Next**</span></span>

5. <span data-ttu-id="19151-135">В этом примере будет создана привязка только команды Get и Delete с командлетами.</span><span class="sxs-lookup"><span data-stu-id="19151-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="19151-136">Очистить **создать** и **обновление** флажки и убедитесь, что **получить** и **удалить** проверяются флажки.</span><span class="sxs-lookup"><span data-stu-id="19151-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="19151-137">Убедитесь, что `Get-VM` командлет выбран для **получить**и `Remove-VM` командлет выбран для **удалить**.</span><span class="sxs-lookup"><span data-stu-id="19151-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="19151-138">Поскольку метаданные для виртуальной Машины командлеты не содержит тип выходных данных, необходимо выполнить командлет, чтобы указать тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="19151-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="19151-139">Выберите **укажите тип выходных данных** и нажмите кнопку **выполните командлет**.</span><span class="sxs-lookup"><span data-stu-id="19151-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="19151-140">**Запустить командлет** откроется диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="19151-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="19151-141">Нажмите кнопку **Запустить**.</span><span class="sxs-lookup"><span data-stu-id="19151-141">Click **Run**.</span></span> <span data-ttu-id="19151-142">**Тип CLR** заполнится `VirtualMachine` типа.</span><span class="sxs-lookup"><span data-stu-id="19151-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="19151-143">Нажмите кнопку **ОК**, затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="19151-144">По умолчанию выбраны все свойства объекта VirtualMachine.</span><span class="sxs-lookup"><span data-stu-id="19151-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="19151-145">Вы можете очистить все свойства, которые вы не хотите как часть данных, возвращаемых при запросе к ресурсу веб-службы.</span><span class="sxs-lookup"><span data-stu-id="19151-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="19151-146">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-146">Click **Next**.</span></span>

8. <span data-ttu-id="19151-147">Необходимо выбрать хотя бы одно свойство для использования в качестве ключа.</span><span class="sxs-lookup"><span data-stu-id="19151-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="19151-148">Выберите **имя** в списке, а также выберите **Далее**.</span><span class="sxs-lookup"><span data-stu-id="19151-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="19151-149">Следующее окно позволяет сопоставить свойства OData для управления ресурса к свойствам базовых командлетов.</span><span class="sxs-lookup"><span data-stu-id="19151-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="19151-150">Мастер сопоставляет свойства с одинаковыми именами по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="19151-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="19151-151">Например `ComputerName` сопоставляется свойство ресурса `ComputerName` свойство командлетов.</span><span class="sxs-lookup"><span data-stu-id="19151-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="19151-152">Это позволяет указать `ComputerName` свойство в запросе к веб-службе и передается значение, указываемое `Get-VM` командлета.</span><span class="sxs-lookup"><span data-stu-id="19151-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="19151-153">`Id` и `Name` также сопоставляются по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="19151-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="19151-154">Нажмите кнопку **Далее**, затем нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="19151-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="19151-155">Ресурс виртуальной Машины появится в окне конструктора схемы.</span><span class="sxs-lookup"><span data-stu-id="19151-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="19151-156">Можно просмотреть свойства и операции, связанные с ресурсом.</span><span class="sxs-lookup"><span data-stu-id="19151-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="19151-157">После этого вы экспортируете Обновленная схема файлы в виртуальный каталог для веб-службы.</span><span class="sxs-lookup"><span data-stu-id="19151-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="19151-158">Экспорт файлов схемы из конструктора схем</span><span class="sxs-lookup"><span data-stu-id="19151-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="19151-159">Щелкните правой кнопкой мыши на пустую область окна конструктора схемы и нажмите кнопку **файл схемы** ; **Экспорт**.</span><span class="sxs-lookup"><span data-stu-id="19151-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="19151-160">**Сохранить как** откроется диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="19151-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="19151-161">Перейдите в тот же каталог, из которой импортируется MOF-файл.</span><span class="sxs-lookup"><span data-stu-id="19151-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="19151-162">Имя файла, так же, как исходный файл MOF (Schema.mof по умолчанию) и нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="19151-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="19151-163">Убедитесь, что вы хотите перезаписать существующий файл.</span><span class="sxs-lookup"><span data-stu-id="19151-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="19151-164">Несмотря на то, что она не указана явным образом в **Сохранить как** диалоговое окно, этот параметр заменяет файлы Schema.mof и Schema.xml.</span><span class="sxs-lookup"><span data-stu-id="19151-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="19151-165">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="19151-165">Next Steps</span></span>

<span data-ttu-id="19151-166">Новый ресурс виртуальной Машины доступ из веб-службы OData для управления, необходимо обновить файл RbacConfiguration.xml, чтобы разрешить доступ к модуль Windows PowerShell Hyper-V, как описано в разделе [авторизации на основе ролей, Настройка](./configuring-role-based-authorization.md), а также необходимо будет перезапустить веб-службу.</span><span class="sxs-lookup"><span data-stu-id="19151-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>