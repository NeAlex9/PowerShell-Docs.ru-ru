---
ms.date: 06/05/2017
keywords: powershell,командлет
title: Удаление объектов из конвейера (Where-Object)
ms.assetid: 01df8b22-2d22-4e2c-a18d-c004cd3cc284
ms.openlocfilehash: c060b93a3823be26ad6c7757acc633bb4fc2fcfa
ms.sourcegitcommit: 00ff76d7d9414fe585c04740b739b9cf14d711e1
ms.translationtype: MTE95
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2018
ms.locfileid: "53403259"
---
# <a name="removing-objects-from-the-pipeline-where-object"></a>Удаление объектов из конвейера (Where-Object)

В Windows PowerShell часто создается и передается в конвейер большее количество объектов, чем требуется. Чтобы указать свойства конкретного объекта, которые требуется отобразить, можно воспользоваться командлетом **Format**, но это не позволяет решить проблему удаления с экрана всех объектов. Может потребоваться отфильтровать объекты до достижения конца конвейера, чтобы выполнить те или иные действия только с подмножеством объектов, созданных изначально.

В Windows PowerShell есть командлет `Where-Object`, который позволяет протестировать каждый объект в конвейере и передать его дальше, только если он удовлетворяет определенному условию теста. Объекты, не прошедшие проверку, удаляются из конвейера. Условие теста передается в виде значения параметра `Where-Object` **FilterScript**.

### <a name="performing-simple-tests-with-where-object"></a>Выполнение простых проверок с использованием командлета Where-Object

Значение **FilterScript** представляет собой *блок сценария* (одну или несколько команд Windows PowerShell, заключенных в фигурные скобки {}), который возвращает значение True или False. Такие блоки сценариев могут быть очень простыми, но для их создания требуется понимание другой концепции Windows PowerShell, а именно операторов сравнения. Оператор сравнения сравнивает элементы, расположенные с обеих сторон оператора. Запись операторов сравнения начинается знаком "-", после которого следует имя оператора. Основные операторы сравнения работают, как правило, с любыми видами объектов. Более сложные операторы сравнения работают только с текстом или массивами.

> [!NOTE]
> По умолчанию при работе с текстом в Windows PowerShell операторы сравнения нечувствительны к регистру.

Исходя из соображений синтаксического анализа, такие знаки, как "<", ">" и "=", не используются в качестве операторов сравнения. Вместо этого операторы сравнения записываются в буквенной форме. Основные операторы сравнения перечислены в таблице ниже.

|Оператор сравнения|Значение|Пример (возвращает значение True)|
|-----------------------|-----------|--------------------------|
|-eq|равно|1 -eq 1|
|-ne|не равно|1 -ne 2|
|-lt|меньше|1 -lt 2|
|-le|меньше или равно|1 -le 2|
|-gt|больше|2 -gt 1|
|-ge|больше или равно|2 -ge 1|
|-like|сравнение на совпадение с учетом подстановочного знака в тексте|"file.doc" -like "f\*.do?"|
|-notlike|сравнение на несовпадение с учетом подстановочного знака в тексте|"file.doc" -notlike "p\*.doc"|
|-contains|Содержит|1,2,3 -contains 1|
|-notcontains|не содержит|1,2,3 -notcontains 4|

В блоках скриптов командлета Where-Object для обращения к текущему объекту конвейера используется специальная переменная `$_`. Ниже приведен пример использования этой переменной. Если в списке содержатся числа и требуется вернуть только те, которые меньше 3, в командлете Where-Object можно настроить фильтр чисел.

```
PS> 1,2,3,4 | Where-Object -FilterScript {$_ -lt 3}
1
2
```

### <a name="filtering-based-on-object-properties"></a>Фильтрация, основанная на свойствах объектов

Так как переменная `$_` ссылается на текущий объект конвейера, для выполнения проверок можно обратиться к ее свойствам.

Например, в инструментарии WMI можно просмотреть класс Win32_SystemDriver. В какой-то конкретной системе могут содержаться сотни системных драйверов, но для проверки необходим определенный набор системных драйверов — таких, которые запущены в данный момент. Если для просмотра объектов класса Win32_SystemDriver использовать командлет Get-Member (**Get-WmiObject -Class Win32_SystemDriver | Get-Member -MemberType Property**), можно увидеть, что соответствующее свойство State принимает значение Running, когда драйвер запущен. Таким образом, фильтровать системные драйверы и выбирать только запущенные можно с помощью строки:

```powershell
Get-WmiObject -Class Win32_SystemDriver | Where-Object -FilterScript {$_.State -eq 'Running'}
```

В результате будет получен длинный список. Отфильтровать эти драйверы и выбирать только такие, запуск которых выполняется автоматически, можно проверкой значения StartMode:

```
PS> Get-WmiObject -Class Win32_SystemDriver | Where-Object -FilterScript {$_.State -eq "Running"} | Where-Object -FilterScript {$_.StartMode -eq "Auto"}

DisplayName : RAS Asynchronous Media Driver
Name        : AsyncMac
State       : Running
Status      : OK
Started     : True

DisplayName : Audio Stub Driver
Name        : audstub
State       : Running
Status      : OK
Started     : True
```

Результат выполнения этой команды содержит много ненужных сведений, поскольку драйверы, запущенные в данный момент, уже известны. В действительности, из всех сведений на данном этапе требуется только имя и отображаемое имя. Следующая команда включает только эти два свойства, что дает более простые выходные данные:

```
PS> Get-WmiObject -Class Win32_SystemDriver | Where-Object -FilterScript {$_.State -eq "Running"} | Where-Object -FilterScript {$_.StartMode -eq "Manual"} | Format-Table -Property Name,DisplayName

Name                                    DisplayName
----                                    -----------
AsyncMac                                RAS Asynchronous Media Driver
Fdc                                     Floppy Disk Controller Driver
Flpydisk                                Floppy Disk Driver
Gpc                                     Generic Packet Classifier
IpNat                                   IP Network Address Translator
mouhid                                  Mouse HID Driver
MRxDAV                                  WebDav Client Redirector
mssmbios                                Microsoft System Management BIOS Driver
```

Приведенная выше команда содержит два элемента Where-Object, но их можно объединить, используя знак "-" и логический оператор.

```powershell
Get-WmiObject -Class Win32_SystemDriver | Where-Object -FilterScript { ($_.State -eq 'Running') -and ($_.StartMode -eq 'Manual') } | Format-Table -Property Name,DisplayName
```

Стандартные логические операторы перечислены в следующей таблице.

|Логический оператор|Значение|Пример (возвращает значение True)|
|--------------------|-----------|--------------------------|
|-and|Логическое И; возвращает значение True, если оба операнда принимают значение True|(1 -eq 1) -and (2 -eq 2)|
|-or|Логическое ИЛИ; возвращает значение True, если один из операндов принимает значение True|(1 -eq 1) -or (1 -eq 2)|
|-not|Логическое НЕ; изменяет значение (True или False) на противоположное|-not (1 -eq 2)|
|\!|Логическое НЕ; изменяет значение (True или False) на противоположное|\! (1 -eq 2)|
