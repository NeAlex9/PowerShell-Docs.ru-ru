---
ms.date: 12/23/2019
keywords: powershell,командлет
title: Удаление объектов из конвейера (Where-Object)
ms.openlocfilehash: 370e7745341b70c0794352a690d5750d21f53ac2
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "75737191"
---
# <a name="removing-objects-from-the-pipeline-where-object"></a>Удаление объектов из конвейера (Where-Object)

В PowerShell часто создается и передается в конвейер большее количество объектов, чем требуется. Чтобы указать свойства конкретного объекта, которые требуется отобразить, можно воспользоваться командлетом `Format-*`, но это не позволяет решить проблему удаления с экрана всех объектов. Может потребоваться отфильтровать объекты до достижения конца конвейера, чтобы выполнить те или иные действия только с подмножеством объектов, созданных изначально.

В PowerShell есть командлет `Where-Object`, который позволяет протестировать каждый объект в конвейере и передать его дальше, только если он удовлетворяет определенному условию теста. Объекты, не прошедшие проверку, удаляются из конвейера. Условие теста передается в виде значения параметра **FilterScript**.

## <a name="performing-simple-tests-with-where-object"></a>Выполнение простых проверок с использованием командлета Where-Object

Значение **FilterScript** представляет собой *блок сценария* (одну или несколько команд PowerShell, заключенных в фигурные скобки (`{}`)), который возвращает значение True или False. Такие блоки сценариев могут быть очень простыми, но для их создания требуется понимание другой концепции PowerShell, а именно операторов сравнения. Оператор сравнения сравнивает элементы, расположенные с обеих сторон оператора. Запись операторов сравнения начинается знаком дефиса (`-`), после которого следует имя оператора. Основные операторы сравнения работают, как правило, с любыми видами объектов. Более сложные операторы сравнения работают только с текстом или массивами.

> [!NOTE]
> По умолчанию при работе с текстом в PowerShell операторы сравнения нечувствительны к регистру.

Исходя из соображений синтаксического анализа, такие знаки, как `<`, `>` и `=`, не используются в качестве операторов сравнения. Вместо этого операторы сравнения записываются в буквенной форме. Основные операторы сравнения перечислены в таблице ниже.

| Оператор сравнения |                  Значение                   |    Пример (возвращает значение True)    |
| ------------------- | ------------------------------------------ | ---------------------------- |
| -eq                 | равно                                | 1 -eq 1                      |
| -ne                 | не равно                            | 1 -ne 2                      |
| -lt                 | меньше                               | 1 -lt 2                      |
| -le                 | Меньше или равно                   | 1 -le 2                      |
| -gt                 | Больше                            | 2 -gt 1                      |
| -ge                 | Больше или равно                | 2 -ge 1                      |
| -like               | сравнение на совпадение с учетом подстановочного знака в тексте     | "file.doc" -like "f*.do?"    |
| -notlike            | сравнение на несовпадение с учетом подстановочного знака в тексте | "file.doc" -notlike "p*.doc" |
| -contains           | Содержит                                   | 1,2,3 -contains 1            |
| -notcontains        | Не содержит                           | 1,2,3 -notcontains 4         |

В блоках сценариев командлета `Where-Object` для обращения к текущему объекту конвейера используется специальная переменная `$_`. Ниже приведен пример использования этой переменной. Если в списке содержатся числа и требуется вернуть только те, которые меньше 3, в командлете `Where-Object` можно настроить фильтр чисел:

```
1,2,3,4 | Where-Object {$_ -lt 3}
1
2
```

## <a name="filtering-based-on-object-properties"></a>Фильтрация, основанная на свойствах объектов

Так как переменная `$_` ссылается на текущий объект конвейера, для выполнения проверок можно обратиться к ее свойствам.

Например, в инструментарии WMI можно просмотреть класс **Win32_SystemDriver**. В какой-то конкретной системе могут содержаться сотни системных драйверов, но для проверки необходим определенный набор системных драйверов — таких, которые запущены в данный момент. Для класса **Win32_SystemDriver** соответствующим свойством является **State**. Таким образом, фильтровать системные драйверы и выбирать только запущенные можно с помощью строки:

```powershell
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {$_.State -eq 'Running'}
```

В результате будет получен длинный список. Чтобы отфильтровать эти драйверы для выбора только таких, запуск которых выполняется автоматически, можно проверить значение **StartMode**:

```powershell
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {$_.State -eq "Running"} |
    Where-Object {$_.StartMode -eq "Auto"}
```

```Output
DisplayName : RAS Asynchronous Media Driver
Name        : AsyncMac
State       : Running
Status      : OK
Started     : True

DisplayName : Audio Stub Driver
Name        : audstub
State       : Running
Status      : OK
Started     : True
...
```

Результат выполнения этой команды содержит много ненужных сведений, поскольку драйверы, запущенные в данный момент, уже известны.
В действительности, из всех сведений на данном этапе требуется только имя и отображаемое имя. Следующая команда включает только эти два свойства, что дает более простые выходные данные:

```powershell
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {$_.State -eq "Running"} |
    Where-Object {$_.StartMode -eq "Manual"} |
      Format-Table -Property Name,DisplayName
```

```Output
Name              DisplayName
----              -----------
AsyncMac               RAS Asynchronous Media Driver
bindflt                Windows Bind Filter Driver
bowser                 Browser
CompositeBus           Composite Bus Enumerator Driver
condrv                 Console Driver
HdAudAddService        Microsoft 1.1 UAA Function Driver for High Definition Audio Service
HDAudBus               Microsoft UAA Bus Driver for High Definition Audio
HidUsb                 Microsoft HID Class Driver
HTTP                   HTTP Service
igfx                   igfx
IntcDAud               Intel(R) Display Audio
intelppm               Intel Processor Driver
...
```

Приведенная выше команда содержит два элемента `Where-Object`, но их можно объединить в один `Where-Object`, используя знак логический оператор `-and`:

```powershell
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {($_.State -eq 'Running') -and ($_.StartMode -eq 'Manual')} |
    Format-Table -Property Name,DisplayName
```

Стандартные логические операторы перечислены в следующей таблице.

| Логический оператор |                 Значение                  |  Пример (возвращает значение True)  |
| ---------------- | ---------------------------------------- | ------------------------ |
| -and             | Логическое И; возвращает значение True, если оба операнда принимают значение True | (1 -eq 1) -and (2 -eq 2) |
| -or              | Логическое ИЛИ; возвращает значение True, если один из операндов принимает значение True  | (1 -eq 1) -or (1 -eq 2)  |
| -not             | Логическое НЕ; изменяет значение (True или False) на противоположное     | -not (1 -eq 2)           |
| \!               | Логическое НЕ; изменяет значение (True или False) на противоположное     | \! (1 -eq 2)              |
