---
title: Добавление ресурсов в веб-службу OData управления | Документация Майкрософт
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: 52a67bcd9d7bf3e8600ea4302d1fa8970ff9c998
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2019
ms.locfileid: "72359823"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="bb5a1-102">Добавление ресурсов в веб-службу управления OData</span><span class="sxs-lookup"><span data-stu-id="bb5a1-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="bb5a1-103">В этом примере показано, как добавить ресурс в существующую веб-службу OData управления с помощью конструктора схем OData управления.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="bb5a1-104">В примере [псвсролебаседплугинс](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) создается веб-служба, которая предоставляет ресурсы процесса и сервера.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="bb5a1-105">В этом примере вы добавите ресурс виртуальной машины (ВМ) в веб-службу.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="bb5a1-106">Предварительные условия</span><span class="sxs-lookup"><span data-stu-id="bb5a1-106">Prerequisites</span></span>

<span data-ttu-id="bb5a1-107">В этом разделе предполагается, что вы скачали и установили пример [псвсролебаседплугинс](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) , как описано в статье [Создание веб-службы Windows PowerShell](./creating-a-management-odata-web-service.md), а также в том, что вы скачали и установили [Конструктор схемы OData управления](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span><span class="sxs-lookup"><span data-stu-id="bb5a1-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="bb5a1-108">В этом разделе также предполагается, что на компьютере, где настроена конечная точка OData для управления, установлен модуль Windows PowerShell Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="bb5a1-109">Добавление виртуальной машины в качестве ресурса в веб-службу</span><span class="sxs-lookup"><span data-stu-id="bb5a1-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="bb5a1-110">Первым шагом является импорт схемы из существующей конечной точки OData управления в конструктор схем.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="bb5a1-111">В следующей процедуре описывается, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="bb5a1-112">Импорт существующей схемы в конструктор схем</span><span class="sxs-lookup"><span data-stu-id="bb5a1-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="bb5a1-113">Откройте конструктор схем OData управления.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="bb5a1-114">В меню **файл** выберите пункт **файл** . **Создать** ; **Файл**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="bb5a1-115">Откроется диалоговое окно **Создание файла** .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="bb5a1-116">Щелкните **Управление модель OData**и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="bb5a1-117">Щелкните правой кнопкой мыши в главном окне и выберите пункт **файл схемы** . **Импорт**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="bb5a1-118">Откроется диалоговое окно **Открыть** .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="bb5a1-119">Перейдите в папку, в которой вы настроили веб-службу управления OData для примера [псвсролебаседплугинс](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="bb5a1-120">Если вы использовали сценарий Windows PowerShell, предоставленный в этом примере, чтобы настроить конечную точку без изменения скрипта, эта папка называется **к:\инетпуб\ввврут\модата**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="bb5a1-121">Выберите Schema. mof и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="bb5a1-122">На этом этапе откройте файлы Schema. mof и Schema. XML в текстовом редакторе и обратите внимание, что они содержат сопоставления для ресурсов процесса и службы.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="bb5a1-123">Файл Schema. mof использует стандарт [распределенного управления](https://www.dmtf.org/) (DTMF) управляемого объекта Task Force.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="bb5a1-124">Файл Schema. XML использует схему XML, описанную в разделе [схема сопоставления ресурсов](./resource-mapping-schema.md).</span><span class="sxs-lookup"><span data-stu-id="bb5a1-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="bb5a1-125">В следующей процедуре описывается импорт командлетов Hyper-V в модель схемы.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="bb5a1-126">Импорт командлетов в схему</span><span class="sxs-lookup"><span data-stu-id="bb5a1-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="bb5a1-127">Щелкните правой кнопкой мыши пустую область окна конструктора схем и выберите команду **импорт командлетов**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="bb5a1-128">Откроется диалоговое окно **Мастер импорта командлетов** .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="bb5a1-129">Убедитесь, что выбран **локальный компьютер** , и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="bb5a1-130">Убедитесь, что установлен флажок установленные модули Windows PowerShell, и выберите в раскрывающемся списке пункт Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="bb5a1-131">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-131">click **Next**.</span></span> <span data-ttu-id="bb5a1-132">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-132">Click **Next**.</span></span>

4. <span data-ttu-id="bb5a1-133">В списке **существительное командлет** выберите **VM**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="bb5a1-134">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-134">Click **Next**</span></span>

5. <span data-ttu-id="bb5a1-135">В этом примере мы будем привязывать только команды Get и DELETE с командлетами.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="bb5a1-136">Снимите флажки **создать** и **Обновить** и убедитесь, что установлены флажки **Get** и **Delete** .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="bb5a1-137">Убедитесь, что для **Get**выбран командлет `Get-VM`, а для **удаления**выбран командлет `Remove-VM`.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="bb5a1-138">Поскольку метаданные для командлетов виртуальной машины не указывают тип выходных данных, необходимо выполнить командлет, чтобы указать тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="bb5a1-139">Выберите **тип выходных данных** и нажмите кнопку **выполнить командлет**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="bb5a1-140">Откроется диалоговое окно **Запуск командлета** .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="bb5a1-141">Нажмите кнопку **выполнить**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-141">Click **Run**.</span></span> <span data-ttu-id="bb5a1-142">Поле **типа CLR** заполняется типом `VirtualMachine`.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="bb5a1-143">Нажмите кнопку **ОК**, а затем кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="bb5a1-144">По умолчанию выбираются все свойства объекта VirtualMachine.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="bb5a1-145">Можно очистить все свойства, которые не нужны как часть данных, возвращаемых при запросе этого ресурса из веб-службы.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="bb5a1-146">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-146">Click **Next**.</span></span>

8. <span data-ttu-id="bb5a1-147">Необходимо выбрать по меньшей мере одно свойство, которое будет использоваться в качестве ключа.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="bb5a1-148">Выберите **имя** в списке и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="bb5a1-149">Следующее окно позволяет сопоставлять свойства ресурса OData управления со свойствами базовых командлетов.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="bb5a1-150">По умолчанию мастер сопоставляет свойства с одинаковыми именами.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="bb5a1-151">Например, свойство `ComputerName` ресурса сопоставляется со свойством `ComputerName` командлетов.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="bb5a1-152">Это позволяет указать свойство `ComputerName` в запросе к веб-службе и указать значение, передаваемое в командлет `Get-VM`.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="bb5a1-153">`Id` и `Name` также сопоставляются по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="bb5a1-154">Нажмите кнопку **Далее**, а затем кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="bb5a1-155">Теперь ресурс виртуальной машины отображается в окне конструктора схем.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="bb5a1-156">Вы можете проверить свойства и операции, связанные с ресурсом.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="bb5a1-157">Далее предстоит экспортировать обновленные файлы схемы в виртуальный каталог для веб-службы.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="bb5a1-158">Экспорт файлов схемы из конструктора схем</span><span class="sxs-lookup"><span data-stu-id="bb5a1-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="bb5a1-159">Щелкните правой кнопкой мыши пустую область окна конструктора схем и выберите пункт **файл схемы** . **Экспорт**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="bb5a1-160">Откроется диалоговое окно **Сохранить как** .</span><span class="sxs-lookup"><span data-stu-id="bb5a1-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="bb5a1-161">Перейдите в тот же каталог, из которого вы импортировали MOF-файл.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="bb5a1-162">Присвойте файлу имя, совпадающее с исходным MOF-файлом (по умолчанию — Schema. MOF), и нажмите кнопку **сохранить**.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="bb5a1-163">Подтвердите, что вы хотите перезаписать существующий файл.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="bb5a1-164">Хотя это явно не указано в диалоговом окне **Сохранить как** , это заменяет файлы Schema. mof и Schema. XML.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb5a1-165">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="bb5a1-165">Next Steps</span></span>

<span data-ttu-id="bb5a1-166">Прежде чем получить доступ к новому ресурсу виртуальной машины из веб-службы управления OData, необходимо обновить файл Рбакконфигуратион. XML, чтобы разрешить доступ к модулю Windows PowerShell Hyper-V, как описано в разделе [Настройка авторизации на основе ролей](./configuring-role-based-authorization.md), а также необходимо перезапустить веб-службу.</span><span class="sxs-lookup"><span data-stu-id="bb5a1-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>