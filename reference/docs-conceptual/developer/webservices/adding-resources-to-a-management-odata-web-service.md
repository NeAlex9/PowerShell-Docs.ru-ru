---
title: Добавление ресурсов в веб-службу OData управления | Документация Майкрософт
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: 2f6ad8ee9f303d3dea92a633996e9248d2e87a21
ms.sourcegitcommit: 173556307d45d88de31086ce776770547eece64c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83561906"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a>Добавление ресурсов в веб-службу управления OData

В этом примере показано, как добавить ресурс в существующую веб-службу OData управления с помощью конструктора схем OData управления. В примере [псвсролебаседплугинс](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) создается веб-служба, которая предоставляет ресурсы процесса и сервера. В этом примере вы добавите ресурс виртуальной машины (ВМ) в веб-службу.

## <a name="prerequisites"></a>Предварительные условия

В этом разделе предполагается, что вы скачали и установили пример [псвсролебаседплугинс](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) , как описано в статье [Создание веб-службы Windows PowerShell](./creating-a-management-odata-web-service.md), а также в том, что вы скачали и установили [Конструктор схемы OData управления](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner). В этом разделе также предполагается, что на компьютере, где настроена конечная точка OData для управления, установлен модуль Windows PowerShell Hyper-V.

## <a name="adding-vm-as-a-resource-to-the-web-service"></a>Добавление виртуальной машины в качестве ресурса в веб-службу

Первым шагом является импорт схемы из существующей конечной точки OData управления в конструктор схем. В следующей процедуре описывается, как это сделать.

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a>Импорт существующей схемы в конструктор схем

1. Откройте конструктор схем OData управления.

2. В меню **файл** выберите пункт **файл** . **Создать** ; **Файл**. Откроется диалоговое окно **Создание файла** .

3. Щелкните **Управление модель OData**и нажмите кнопку **Открыть**.

4. Щелкните правой кнопкой мыши в главном окне и выберите пункт **файл схемы** . **Импорт**. Откроется диалоговое окно **Открыть** .

5. Перейдите в папку, в которой вы настроили веб-службу управления OData для примера [псвсролебаседплугинс](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) . Если вы использовали сценарий Windows PowerShell, предоставленный в этом примере, чтобы настроить конечную точку без изменения скрипта, эта папка называется **к:\инетпуб\ввврут\модата**. Выберите Schema. mof и нажмите кнопку **Открыть**.

   На этом этапе откройте файлы Schema. mof и Schema. XML в текстовом редакторе и обратите внимание, что они содержат сопоставления для ресурсов процесса и службы. Файл Schema. mof использует стандарт [распределенного управления](https://www.dmtf.org/) (DTMF) управляемого объекта Task Force. Файл Schema. XML использует схему XML, описанную в разделе [схема сопоставления ресурсов](./resource-mapping-schema.md).

   В следующей процедуре описывается импорт командлетов Hyper-V в модель схемы.

#### <a name="importing-cmdlets-into-the-schema"></a>Импорт командлетов в схему

1. Щелкните правой кнопкой мыши пустую область окна конструктора схем и выберите команду **импорт командлетов**. Откроется диалоговое окно **Мастер импорта командлетов** .

2. Убедитесь, что выбран **локальный компьютер** , и нажмите кнопку **Далее**.

3. Убедитесь, что установлен флажок установленные модули Windows PowerShell, и выберите в раскрывающемся списке пункт Hyper-V. Щелкните **Далее**. Нажмите кнопку **Далее**.

4. В списке **существительное командлет** выберите **VM**. Нажмите кнопку **Далее**

5. В этом примере мы будем привязывать только команды Get и DELETE с командлетами. Снимите флажки **создать** и **Обновить** и убедитесь, что установлены флажки **Get** и **Delete** . Убедитесь, что `Get-VM` командлет выбран для **Get**, и `Remove-VM` командлет выбран для **удаления**.

6. Поскольку метаданные для командлетов виртуальной машины не указывают тип выходных данных, необходимо выполнить командлет, чтобы указать тип выходных данных. Выберите **тип выходных данных** и нажмите кнопку **выполнить командлет**. Откроется диалоговое окно **Запуск командлета** . Нажмите кнопку **Запустить**. Поле **типа CLR** заполняется `VirtualMachine` типом. Нажмите кнопку **ОК**, а затем кнопку **Далее**.

7. По умолчанию выбираются все свойства объекта VirtualMachine. Можно очистить все свойства, которые не нужны как часть данных, возвращаемых при запросе этого ресурса из веб-службы. Нажмите кнопку **Далее**.

8. Необходимо выбрать по меньшей мере одно свойство, которое будет использоваться в качестве ключа. Выберите **имя** в списке и нажмите кнопку **Далее**.

9. Следующее окно позволяет сопоставлять свойства ресурса OData управления со свойствами базовых командлетов. По умолчанию мастер сопоставляет свойства с одинаковыми именами. Например, `ComputerName` свойство ресурса сопоставляется со `ComputerName` свойством командлетов.  Это позволяет указать `ComputerName` свойство в запросе к веб-службе и указать значение, которое будет передано в `Get-VM` командлет. `Id`и `Name` также сопоставляются по умолчанию.

   10. Нажмите кнопку **Далее**, а затем кнопку **Готово**.

       Теперь ресурс виртуальной машины отображается в окне конструктора схем. Вы можете проверить свойства и операции, связанные с ресурсом. Далее предстоит экспортировать обновленные файлы схемы в виртуальный каталог для веб-службы.

#### <a name="exporting-schema-files-from-the-schema-designer"></a>Экспорт файлов схемы из конструктора схем

1. Щелкните правой кнопкой мыши пустую область окна конструктора схем и выберите пункт **файл схемы** . **Экспорт**. Откроется диалоговое окно **Сохранить как** .

2. Перейдите в тот же каталог, из которого вы импортировали MOF-файл. Присвойте файлу имя, совпадающее с исходным MOF-файлом (по умолчанию — Schema. MOF), и нажмите кнопку **сохранить**. Подтвердите, что вы хотите перезаписать существующий файл.

   Хотя это явно не указано в диалоговом окне **Сохранить как** , это заменяет файлы Schema. mof и Schema. XML.

## <a name="next-steps"></a>Следующие шаги

Прежде чем получить доступ к новому ресурсу виртуальной машины из веб-службы управления OData, необходимо обновить файл Рбакконфигуратион. XML, чтобы разрешить доступ к модулю Windows PowerShell Hyper-V, как описано в разделе [Настройка авторизации на основе ролей](./configuring-role-based-authorization.md). Кроме того, потребуется перезапустить веб-службу.
