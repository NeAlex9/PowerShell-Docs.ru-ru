---
title: Разработка поставщика Windows PowerShell | Документация Майкрософт
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- providers [PowerShell Programmer's Guide], designing
ms.assetid: 11d20319-cc40-4227-b810-4af33372b182
caps.latest.revision: 10
ms.openlocfilehash: bfb29fd5df87ffa9ae270c18ce8bfb0c59ee6f90
ms.sourcegitcommit: d97b200e7a49315ce6608cd619e3e2fd99193edd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2020
ms.locfileid: "75870665"
---
# <a name="designing-your-windows-powershell-provider"></a>Разработка поставщика Windows PowerShell

Если продукт или конфигурация предоставляет набор сохраненных данных, например базу данных, которую пользователь хочет перемещать или просматривать, следует реализовать поставщик Windows PowerShell. Кроме того, если ваш продукт предоставляет контейнер, даже если он не является многоуровневый, имеет смысл реализовать поставщик Windows PowerShell. Например, может потребоваться реализовать поставщик контейнера Windows PowerShell, если команда командлета Copy, Move, Rename, New или Remove имеет смысл как операция с продуктом или данными конфигурации.

## <a name="windows-powershell-paths-identify-your-provider"></a>Пути Windows PowerShell для указания поставщика

Среда выполнения Windows PowerShell использует пути Windows PowerShell для доступа к соответствующему поставщику Windows PowerShell. Если командлет задает один из этих путей, среда выполнения знает, какой поставщик следует использовать для доступа к связанному хранилищу данных. Эти пути включают в себя пути с указанием диска, пути, определяемые поставщиком, пути прямого доступа поставщика и внутренние пути поставщика. Каждый поставщик Windows PowerShell должен поддерживать один или несколько этих путей.

Дополнительные сведения о путях Windows PowerShell см. в статье как работает Windows PowerShell.

### <a name="defining-a-drive-qualified-path"></a>Определение пути с указанием диска

Чтобы разрешить пользователю доступ к данным, расположенным на физическом диске, поставщик Windows PowerShell должен поддерживать путь, определенный диском. Этот путь начинается с имени диска, за которым следует двоеточие (:), например мидриве: \ абк\бар.

### <a name="defining-a-provider-qualified-path"></a>Определение пути, уточненного поставщиком

Чтобы разрешить среде выполнения Windows PowerShell инициализировать и деинициализировать поставщик, поставщик Windows PowerShell должен поддерживать путь, определенный поставщиком. Например, FileSystem::\\\ункшаре\абк\бар — это определяемый поставщиком путь к поставщику FileSystem, предоставляемому Windows PowerShell.

### <a name="defining-a-provider-direct-path"></a>Определение прямого пути к поставщику

Чтобы разрешить удаленный доступ к поставщику Windows PowerShell, он должен поддерживать прямой путь поставщика для передачи непосредственно поставщику Windows PowerShell для текущего расположения. Например, в реестре поставщик Windows PowerShell может использовать \\\сервер\регкэйпас в качестве прямого пути поставщика.

### <a name="defining-a-provider-internal-path"></a>Определение внутреннего пути поставщика

Чтобы предоставить командлету поставщика доступ к данным с помощью интерфейсов API, отличных от Windows PowerShell, поставщик Windows PowerShell должен поддерживать внутренний путь поставщика. Этот путь указывается после "::" в пути, уточненном поставщиком. Например, внутренний путь поставщика для файловой системы Windows PowerShell Provider — \\\ункшаре\абк\бар.

## <a name="changing-stored-data"></a>Изменение сохраненных данных

При переопределении методов, изменяющих базовое хранилище данных, всегда вызывайте метод [System. Management. Automation. Provider. кмдлетпровидер. вритеитемобжект *](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.WriteItemObject) с самой последней версией элемента, измененного этим методом. Инфраструктура поставщика определяет, нужно ли передавать объект item в конвейер, например, когда пользователь указывает параметр-PassThru. Если получение наиболее актуального элемента является дорогостоящей операцией (с учетом производительности), можно протестировать свойство Context. PassThru, чтобы определить, действительно ли нужно писать получившийся элемент.

## <a name="choose-a-base-class-for-your-provider"></a>Выбор базового класса для поставщика

Windows PowerShell предоставляет ряд базовых классов, которые можно использовать для реализации собственного поставщика Windows PowerShell. При проектировании поставщика выберите базовый класс, описанный в этом разделе, который наиболее подходит для ваших требований.

Каждый базовый класс поставщика Windows PowerShell делает доступным набор командлетов. В этом разделе описываются командлеты, но они не описывают их параметры.

С помощью состояния сеанса среда выполнения Windows PowerShell делает доступными несколько командлетов Location для некоторых поставщиков Windows PowerShell, таких как `Get-Location`, `Set-Location`, `Pop-Location`и `Push-Location` командлеты. Для получения сведений об этих командлетах расположения можно использовать командлет `Get-Help`.

### <a name="cmdletprovider-base-class"></a>Базовый класс Кмдлетпровидер

Класс [System. Management. Automation. Provider. кмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) определяет базовый поставщик Windows PowerShell. Этот класс поддерживает объявление поставщика и предоставляет ряд свойств и методов, доступных для всех поставщиков Windows PowerShell.
Класс вызывается командлетом `Get-PSProvider` для вывода списка всех доступных поставщиков для сеанса.
Реализация этого командлета предоставляется состоянием сеанса.

> [!NOTE]
> Поставщики Windows PowerShell доступны для всех областей языка Windows PowerShell.

### <a name="drivecmdletprovider-base-class"></a>Базовый класс Дривекмдлетпровидер

Класс [System. Management. Automation. Provider. дривекмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.DriveCmdletProvider) определяет поставщик диска Windows PowerShell, который поддерживает операции по добавлению новых дисков, удалению существующих дисков и инициализации дисков по умолчанию. Например, Поставщик FileSystem, предоставляемый Windows PowerShell, инициализирует диски для всех подключенных томов, таких как жесткие диски и дисководы CD/DVD.

Этот класс является производным от базового класса [System. Management. Automation. Provider. кмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) . В следующей таблице перечислены командлеты, предоставляемые этим классом. Помимо перечисленных выше, командлет `Get-PSDrive` (предоставляемый состоянием сеанса) — это связанный командлет, который используется для получения доступных дисков.

|      Командлет      |                             Определение                              |
| ---------------- | ------------------------------------------------------------------- |
| `New-PSDrive`    | Создание нового диска для сеанса и потоковая передача сведений о нем. |
| `Remove-PSDrive` | Удаляет диск из сеанса.                                   |

### <a name="itemcmdletprovider-base-class"></a>Базовый класс Итемкмдлетпровидер

Класс [System. Management. Automation. Provider. итемкмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.ItemCmdletProvider) определяет поставщик элементов Windows PowerShell, который выполняет операции с отдельными элементами хранилища данных и не предполагает использование контейнеров и возможностей навигации. Этот класс является производным от базового класса [System. Management. Automation. Provider. дривекмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.DriveCmdletProvider) . В следующей таблице перечислены командлеты, предоставляемые этим классом.

|     Командлет     |                                                                                                                                                            Определение                                                                                                                                                            |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Clear-Item`   | Очищает текущее содержимое элементов в указанном расположении и заменяет его значением "Clear", заданным поставщиком. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.                                                                                   |
| `Get-Item`     | Извлекает элементы из указанного расположения и передает в поток результирующие объекты.                                                                                                                                                                                                                                                  |
| `Invoke-Item`  | Вызывает действие по умолчанию для элемента по указанному пути.                                                                                                                                                                                                                                                                   |
| `Set-Item`     | Задает элемент в указанном расположении с указанным значением. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.                                                                                                                                                   |
| `Resolve-Path` | Разрешает подстановочные знаки для пути Windows PowerShell и сведения о пути к потокам.                                                                                                                                                                                                                                              |
| `Test-Path`    | Проверяет по указанному пути и возвращает `true`, если он существует, и `false` в противном случае. Этот командлет реализуется для поддержки параметра `IsContainer` для метода [System. Management. Automation. Provider. кмдлетпровидер. вритеитемобжект *](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.WriteItemObject) . |

### <a name="containercmdletprovider-base-class"></a>Базовый класс Контаинеркмдлетпровидер

Класс [System. Management. Automation. Provider. контаинеркмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.ContainerCmdletProvider) определяет поставщик контейнера Windows PowerShell, который предоставляет контейнер для элементов хранилища данных пользователю. Имейте в виду, что поставщик контейнеров Windows PowerShell можно использовать только при наличии одного контейнера (без вложенных контейнеров) с элементами в нем. При наличии вложенных контейнеров необходимо реализовать поставщик навигации Windows PowerShell.

Этот класс является производным от базового класса [System. Management. Automation. Provider. итемкмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.ItemCmdletProvider) . В следующей таблице описаны командлеты, реализуемые этим классом.

|     Командлет      |                                                                        Определение                                                                        |
| --------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Copy-Item`     | Копирует элементы из одного расположения в другое. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`. |
| `Get-Childitem` | Извлекает дочерние элементы в указанном расположении и передает их в поток как объекты.                                                                        |
| `New-Item`      | Создает новые элементы в указанном расположении и осуществляет потоковую передачу результирующего объекта.                                                                           |
| `Remove-Item`   | Удаляет элементы из указанного расположения.                                                                                                               |
| `Rename-Item`   | Переименовывает элемент в указанном расположении. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`. |

### <a name="navigationcmdletprovider-base-class"></a>Базовый класс NavigationCmdletProvider

Класс [System. Management. Automation. Provider. Navigationcmdletprovider](/dotnet/api/System.Management.Automation.Provider.NavigationCmdletProvider) определяет поставщик навигации Windows PowerShell, который выполняет операции для элементов, использующих более одного контейнера. Этот класс является производным от базового класса [System. Management. Automation. Provider. контаинеркмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.ContainerCmdletProvider) . В следующей таблице перечислены командлеты, предоставляемые этим классом.

|    Командлет    |                                                                      Определение                                                                      |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| Объединить-Path | Объединяет два пути в один путь с помощью разделителя, зависящего от поставщика, между путями. Этот командлет осуществляет потоковую передачу строк.                               |
| `Move-Item`  | Перемещает элементы в указанное место. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`. |

Связанный командлет — это базовый командлет Parse-Path, предоставляемый Windows PowerShell. Этот командлет можно использовать для синтаксического анализа пути Windows PowerShell для поддержки параметра `Parent`. Он создает потоковую строку родительского пути.

## <a name="select-provider-interfaces-to-support"></a>Выберите интерфейсы поставщика для поддержки

Помимо наследования от одного из базовых классов Windows PowerShell, поставщик Windows PowerShell может поддерживать другие функциональные возможности путем наследования от одного или нескольких из следующих интерфейсов поставщика. В этом разделе определяются эти интерфейсы и командлеты, поддерживаемые каждым из них. Он не описывает параметры для командлетов, поддерживаемых интерфейсом. Сведения о параметрах командлета доступны в сети с помощью командлетов `Get-Command` и `Get-Help`.

### <a name="icontentcmdletprovider"></a>иконтенткмдлетпровидер

Интерфейс [System. Management. Automation. Provider. иконтенткмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.IContentCmdletProvider) определяет поставщик содержимого, который выполняет операции с содержимым элемента данных. В следующей таблице перечислены командлеты, предоставляемые этим интерфейсом.

|     Командлет      |                                                                                        Определение                                                                                        |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Add-Content`   | Добавляет указанную длину значений к содержимому указанного элемента. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`. |
| `Clear-Content` | Задает для содержимого указанного элемента значение "Clear". Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.               |
| `Get-Content`   | Извлекает содержимое указанных элементов и передает в поток результирующие объекты.                                                                                                         |
| `Set-Content`   | Заменяет существующее содержимое для указанных элементов. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.                     |

### <a name="ipropertycmdletprovider"></a>ипропертикмдлетпровидер

Интерфейс [System. Management. Automation. Provider. ипропертикмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.IPropertyCmdletProvider) определяет свойство поставщика Windows PowerShell, которое выполняет операции со свойствами элементов в хранилище данных. В следующей таблице перечислены командлеты, предоставляемые этим интерфейсом.

> [!NOTE]
> Параметр `Path` в этих командлетах указывает путь к элементу, а не определяет свойство.

|        Командлет        |                                                                                   Определение                                                                                    |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Clear-ItemProperty` | Задает для свойств указанных элементов значение "Clear". Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.      |
| `Get-ItemProperty`   | Извлекает свойства из указанных элементов и передает в поток результирующие объекты.                                                                                                |
| `Set-ItemProperty`   | Задает свойства указанных элементов с указанными значениями. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`. |

### <a name="idynamicpropertycmdletprovider"></a>идинамикпропертикмдлетпровидер

Интерфейс [System. Management. Automation. Provider. идинамикпропертикмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.IDynamicPropertyCmdletProvider) , производный от [System. Management. Automation. Provider. ипропертикмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.IPropertyCmdletProvider), определяет поставщик, указывающий динамические параметры для поддерживаемых командлетов. Поставщик этого типа обрабатывает операции, для которых свойства могут быть определены во время выполнения, например, с новой операцией свойства. Такие операции невозможны для элементов, имеющих статически определенные свойства.
В следующей таблице перечислены командлеты, предоставляемые этим интерфейсом.

|        Командлет         |                                                                                Определение                                                                                |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Copy-ItemProperty`   | Копирует свойство из указанного элемента в другой элемент. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`. |
| `Move-ItemProperty`   | Перемещает свойство из указанного элемента в другой элемент. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.  |
| `New-ItemProperty`    | Создает свойство для указанных элементов и передает в поток результирующие объекты.                                                                                             |
| `Remove-ItemProperty` | Удаляет свойство для указанных элементов.                                                                                                                              |
| `Rename-ItemProperty` | Переименовывает свойство указанных элементов. Этот командлет не передает выходной объект через конвейер, если не указан параметр `PassThru`.                 |

### <a name="isecuritydescriptorcmdletprovider"></a>исекуритидескрипторкмдлетпровидер

Интерфейс [System. Management. Automation. Provider. исекуритидескрипторкмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.ISecurityDescriptorCmdletProvider) добавляет к поставщику функциональные возможности дескриптора безопасности. Этот интерфейс позволяет пользователю получить и задать сведения о дескрипторе безопасности для элемента в хранилище данных. В следующей таблице перечислены командлеты, предоставляемые этим интерфейсом.

|  Командлет   |                                                                                                                                                                                                          Определение                                                                                                                                                                                                          |
| --------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Get-Acl` | Извлекает сведения, содержащиеся в списке управления доступом (ACL), который является частью дескриптора безопасности, используемого для защиты ресурсов операционной системы, например файла или объекта.                                                                                                                                                                                                                                      |
| `Set-Acl` | Задает сведения для ACL. Он представлен в виде экземпляра [System. Security. AccessControl. обжектсекурити](/dotnet/api/System.Security.AccessControl.ObjectSecurity) для элементов, указанных для указанного пути. Этот командлет может задавать сведения о файлах, ключах и подразделах в реестре или любом другом элементе поставщика, если поставщик Windows PowerShell поддерживает настройку сведений о безопасности. |

## <a name="see-also"></a>См. также

[Создание поставщиков Windows PowerShell](./how-to-create-a-windows-powershell-provider.md)

[Как работает Windows PowerShell](/previous-versions/ms714658(v=vs.85))

[Пакет SDK для Windows PowerShell](../windows-powershell-reference.md)