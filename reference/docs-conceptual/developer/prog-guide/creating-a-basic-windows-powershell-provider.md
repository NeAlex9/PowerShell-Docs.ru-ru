---
ms.date: 09/13/2016
ms.topic: reference
title: Создание базового поставщика Windows PowerShell
description: Создание базового поставщика Windows PowerShell
ms.openlocfilehash: 03b5784fd063b5457fc64d92a32e286e3bf9cce4
ms.sourcegitcommit: ba7315a496986451cfc1296b659d73ea2373d3f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "92647506"
---
# <a name="creating-a-basic-windows-powershell-provider"></a><span data-ttu-id="ebd58-103">Создание базового поставщика Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="ebd58-103">Creating a Basic Windows PowerShell Provider</span></span>

<span data-ttu-id="ebd58-104">Этот раздел является отправной точкой для изучения создания поставщика Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ebd58-104">This topic is the starting point for learning how to create a Windows PowerShell provider.</span></span> <span data-ttu-id="ebd58-105">Базовый поставщик, описанный здесь, предоставляет методы для запуска и остановки поставщика, и хотя этот поставщик не предоставляет средств для доступа к хранилищу данных или для получения или установки данных в хранилище данных, он предоставляет базовые функциональные возможности, необходимые для всех поставщиков.</span><span class="sxs-lookup"><span data-stu-id="ebd58-105">The basic provider described here provides methods for starting and stopping the provider, and although this provider does not provide a means to access a data store or to get or set the data in the data store, it does provide the basic functionality that is required by all providers.</span></span>

<span data-ttu-id="ebd58-106">Как упоминалось ранее, базовый поставщик, описанный здесь, реализует методы для запуска и остановки поставщика.</span><span class="sxs-lookup"><span data-stu-id="ebd58-106">As mentioned previously, the basic provider described here implements methods for starting and stopping the provider.</span></span> <span data-ttu-id="ebd58-107">Среда выполнения Windows PowerShell вызывает эти методы для инициализации и деинициализации поставщика.</span><span class="sxs-lookup"><span data-stu-id="ebd58-107">The Windows PowerShell runtime calls these methods to initialize and uninitialize the provider.</span></span>

> [!NOTE]
> <span data-ttu-id="ebd58-108">Образец этого поставщика можно найти в файле AccessDBSampleProvider01.cs, предоставляемом Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ebd58-108">You can find a sample of this provider in the AccessDBSampleProvider01.cs file provided by Windows PowerShell.</span></span>

## <a name="defining-the-windows-powershell-provider-class"></a><span data-ttu-id="ebd58-109">Определение класса поставщика Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="ebd58-109">Defining the Windows PowerShell Provider Class</span></span>

<span data-ttu-id="ebd58-110">Первым шагом в создании поставщика Windows PowerShell является определение его класса .NET.</span><span class="sxs-lookup"><span data-stu-id="ebd58-110">The first step in creating a Windows PowerShell provider is to define its .NET class.</span></span> <span data-ttu-id="ebd58-111">Этот базовый поставщик определяет класс `AccessDBProvider` , производный от базового класса [System. Management. Automation. Provider. кмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) .</span><span class="sxs-lookup"><span data-stu-id="ebd58-111">This basic provider defines a class called `AccessDBProvider` that derives from the [System.Management.Automation.Provider.Cmdletprovider](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) base class.</span></span>

<span data-ttu-id="ebd58-112">Рекомендуется размещать классы поставщиков в `Providers` пространстве имен API, например XXX. PowerShell. Providers.</span><span class="sxs-lookup"><span data-stu-id="ebd58-112">It is recommended that you place your provider classes in a `Providers` namespace of your API namespace, for example, xxx.PowerShell.Providers.</span></span> <span data-ttu-id="ebd58-113">Этот поставщик использует `Microsoft.Samples.PowerShell.Provider` пространство имен, в котором выполняются все примеры поставщика Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ebd58-113">This provider uses the `Microsoft.Samples.PowerShell.Provider` namespace, in which all Windows PowerShell provider samples run.</span></span>

> [!NOTE]
> <span data-ttu-id="ebd58-114">Класс для поставщика Windows PowerShell должен быть явно помечен как открытый.</span><span class="sxs-lookup"><span data-stu-id="ebd58-114">The class for a Windows PowerShell provider must be explicitly marked as public.</span></span> <span data-ttu-id="ebd58-115">Классы, не помеченные как открытые, по умолчанию будут внутренними и не будут найдены средой выполнения Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ebd58-115">Classes not marked as public will default to internal and will not be found by the Windows PowerShell runtime.</span></span>

<span data-ttu-id="ebd58-116">Ниже приведено определение класса для этого базового поставщика:</span><span class="sxs-lookup"><span data-stu-id="ebd58-116">Here is the class definition for this basic provider:</span></span>

:::code language="csharp" source="~/../powershell-sdk-samples/SDK-2.0/csharp/AccessDBProviderSample01/AccessDBProviderSample01.cs" range="23-24":::

<span data-ttu-id="ebd58-117">Непосредственно перед определением класса необходимо объявить атрибут [System. Management. Automation. Provider. кмдлетпровидераттрибуте](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) с синтаксисом [кмдлетпровидер ()].</span><span class="sxs-lookup"><span data-stu-id="ebd58-117">Right before the class definition, you must declare the [System.Management.Automation.Provider.Cmdletproviderattribute](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) attribute, with the syntax [CmdletProvider()].</span></span>

<span data-ttu-id="ebd58-118">При необходимости можно задать ключевые слова атрибутов для дальнейшего объявления класса.</span><span class="sxs-lookup"><span data-stu-id="ebd58-118">You can set attribute keywords to further declare the class if necessary.</span></span> <span data-ttu-id="ebd58-119">Обратите внимание, что объявленный здесь атрибут [System. Management. Automation. Provider. кмдлетпровидераттрибуте](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) содержит два параметра.</span><span class="sxs-lookup"><span data-stu-id="ebd58-119">Notice that the [System.Management.Automation.Provider.Cmdletproviderattribute](/dotnet/api/System.Management.Automation.Provider.CmdletProviderAttribute) attribute declared here includes two parameters.</span></span> <span data-ttu-id="ebd58-120">Первый параметр атрибута указывает понятное по умолчанию имя поставщика, которое пользователь может изменить позже.</span><span class="sxs-lookup"><span data-stu-id="ebd58-120">The first attribute parameter specifies the default-friendly name for the provider, which the user can modify later.</span></span> <span data-ttu-id="ebd58-121">Второй параметр задает определенные возможности Windows PowerShell, которые поставщик предоставляет среде выполнения Windows PowerShell во время обработки команды.</span><span class="sxs-lookup"><span data-stu-id="ebd58-121">The second parameter specifies the Windows PowerShell-defined capabilities that the provider exposes to the Windows PowerShell runtime during command processing.</span></span> <span data-ttu-id="ebd58-122">Возможные значения для возможностей поставщика определяются перечислением [System. Management. Automation. Provider. провидеркапабилитиес](/dotnet/api/System.Management.Automation.Provider.ProviderCapabilities) .</span><span class="sxs-lookup"><span data-stu-id="ebd58-122">The possible values for the provider capabilities are defined by the [System.Management.Automation.Provider.Providercapabilities](/dotnet/api/System.Management.Automation.Provider.ProviderCapabilities) enumeration.</span></span> <span data-ttu-id="ebd58-123">Поскольку этот поставщик является базовым, он не поддерживает никаких возможностей.</span><span class="sxs-lookup"><span data-stu-id="ebd58-123">Because this is a base provider, it supports no capabilities.</span></span>

> [!NOTE]
> <span data-ttu-id="ebd58-124">Полное имя поставщика Windows PowerShell содержит имя сборки и другие атрибуты, определенные Windows PowerShell при регистрации поставщика.</span><span class="sxs-lookup"><span data-stu-id="ebd58-124">The fully qualified name of the Windows PowerShell provider includes the assembly name and other attributes determined by Windows PowerShell upon registration of the provider.</span></span>

## <a name="defining-provider-specific-state-information"></a><span data-ttu-id="ebd58-125">Определение сведений о состоянии Provider-Specific</span><span class="sxs-lookup"><span data-stu-id="ebd58-125">Defining Provider-Specific State Information</span></span>

<span data-ttu-id="ebd58-126">Базовый класс [System. Management. Automation. Provider. кмдлетпровидер](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) и все производные классы считаются без отслеживания состояния, так как среда выполнения Windows PowerShell создает экземпляры поставщика только по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="ebd58-126">The [System.Management.Automation.Provider.Cmdletprovider](/dotnet/api/System.Management.Automation.Provider.CmdletProvider) base class and all derived classes are considered stateless because the Windows PowerShell runtime creates provider instances only as required.</span></span> <span data-ttu-id="ebd58-127">Таким образом, если поставщику требуется полное управление и обслуживание состояния для данных конкретного поставщика, он должен наследовать класс от класса [System. Management. Automation. провидеринфо](/dotnet/api/System.Management.Automation.ProviderInfo) .</span><span class="sxs-lookup"><span data-stu-id="ebd58-127">Therefore, if your provider requires full control and state maintenance for provider-specific data, it must derive a class from the [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) class.</span></span> <span data-ttu-id="ebd58-128">Производный класс должен определить элементы, необходимые для поддержания состояния, чтобы обеспечить доступ к данным, зависящим от поставщика, когда среда выполнения Windows PowerShell вызывает метод [System. Management. Automation. Provider. кмдлетпровидер. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) для инициализации поставщика.</span><span class="sxs-lookup"><span data-stu-id="ebd58-128">Your derived class should define the members necessary to maintain the state so that the provider-specific data can be accessed when the Windows PowerShell runtime calls the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method to initialize the provider.</span></span>

<span data-ttu-id="ebd58-129">Поставщик Windows PowerShell также может поддерживать состояние на основе подключения.</span><span class="sxs-lookup"><span data-stu-id="ebd58-129">A Windows PowerShell provider can also maintain connection-based state.</span></span> <span data-ttu-id="ebd58-130">Дополнительные сведения о поддержке состояния подключения см. [в разделе Создание поставщика диска PowerShell](./creating-a-windows-powershell-drive-provider.md).</span><span class="sxs-lookup"><span data-stu-id="ebd58-130">For more information about maintaining connection state, see [Creating a PowerShell Drive Provider](./creating-a-windows-powershell-drive-provider.md).</span></span>

## <a name="initializing-the-provider"></a><span data-ttu-id="ebd58-131">Инициализация поставщика</span><span class="sxs-lookup"><span data-stu-id="ebd58-131">Initializing the Provider</span></span>

<span data-ttu-id="ebd58-132">Чтобы инициализировать поставщик, среда выполнения Windows PowerShell вызывает метод [System. Management. Automation. Provider. кмдлетпровидер. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) при запуске Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ebd58-132">To initialize the provider, the Windows PowerShell runtime calls the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method when Windows PowerShell is started.</span></span> <span data-ttu-id="ebd58-133">В большинстве случаев поставщик может использовать реализацию по умолчанию этого метода, который просто возвращает объект [System. Management. Automation. провидеринфо](/dotnet/api/System.Management.Automation.ProviderInfo) , описывающий поставщика.</span><span class="sxs-lookup"><span data-stu-id="ebd58-133">For the most part, your provider can use the default implementation of this method, which simply returns the [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object that describes your provider.</span></span> <span data-ttu-id="ebd58-134">Однако в случае, когда необходимо добавить дополнительные сведения об инициализации, следует реализовать собственный метод [System. Management. Automation. Provider. кмдлетпровидер. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) , возвращающий измененную версию объекта [System. Management. Automation. провидеринфо](/dotnet/api/System.Management.Automation.ProviderInfo) , который передается поставщику.</span><span class="sxs-lookup"><span data-stu-id="ebd58-134">However, in the case where you want to add additional initialization information, you should implement your own [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method that returns a modified version of the [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object that is passed to your provider.</span></span> <span data-ttu-id="ebd58-135">Как правило, этот метод должен возвращать предоставленный объект [System. Management. Automation. провидеринфо](/dotnet/api/System.Management.Automation.ProviderInfo) , переданный в него, или измененный объект [System. Management. Automation. провидеринфо](/dotnet/api/System.Management.Automation.ProviderInfo) , который содержит другие сведения об инициализации.</span><span class="sxs-lookup"><span data-stu-id="ebd58-135">In general, this method should return the provided [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object passed to it or a modified [System.Management.Automation.Providerinfo](/dotnet/api/System.Management.Automation.ProviderInfo) object that contains other initialization information.</span></span>

<span data-ttu-id="ebd58-136">Этот базовый поставщик не переопределяет этот метод.</span><span class="sxs-lookup"><span data-stu-id="ebd58-136">This basic provider does not override this method.</span></span> <span data-ttu-id="ebd58-137">Однако следующий код демонстрирует реализацию этого метода по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="ebd58-137">However, the following code shows the default implementation of this method:</span></span>

<!-- TODO!!!: review snippet reference  [!CODE [Msh_samplesaccessdbprov01#accessdbprov01ProviderStart](Msh_samplesaccessdbprov01#accessdbprov01ProviderStart)]  -->

<span data-ttu-id="ebd58-138">Поставщик может поддерживать состояние сведений, относящихся к поставщику, как описано в разделе [Определение состояния данных, зависящего от поставщика](#defining-provider-specific-state-information).</span><span class="sxs-lookup"><span data-stu-id="ebd58-138">The provider can maintain the state of provider-specific information as described in [Defining Provider-specific Data State](#defining-provider-specific-state-information).</span></span> <span data-ttu-id="ebd58-139">В этом случае ваша реализация должна переопределить метод [System. Management. Automation. Provider. кмдлетпровидер. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) , чтобы он возвращал экземпляр производного класса.</span><span class="sxs-lookup"><span data-stu-id="ebd58-139">In this case, your implementation must override the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method to return an instance of the derived class.</span></span>

## <a name="start-dynamic-parameters"></a><span data-ttu-id="ebd58-140">Запуск динамических параметров</span><span class="sxs-lookup"><span data-stu-id="ebd58-140">Start Dynamic Parameters</span></span>

<span data-ttu-id="ebd58-141">Реализация поставщика метода [System. Management. Automation. Provider. кмдлетпровидер. Start \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) может потребовать дополнительных параметров.</span><span class="sxs-lookup"><span data-stu-id="ebd58-141">Your provider implementation of the [System.Management.Automation.Provider.Cmdletprovider.Start\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Start) method might require additional parameters.</span></span> <span data-ttu-id="ebd58-142">В этом случае поставщик должен переопределять метод [System. Management. Automation. Provider. кмдлетпровидер. стартдинамикпараметерс \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.StartDynamicParameters) и возвращать объект со свойствами и полями с атрибутами синтаксического анализа, похожими на класс командлета или объект [System. Management. Automation. рунтимедефинедпараметердиктионари](/dotnet/api/System.Management.Automation.RuntimeDefinedParameterDictionary) .</span><span class="sxs-lookup"><span data-stu-id="ebd58-142">In this case, the provider should override the [System.Management.Automation.Provider.Cmdletprovider.Startdynamicparameters\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.StartDynamicParameters) method and return an object that has properties and fields with parsing attributes similar to a cmdlet class or a [System.Management.Automation.Runtimedefinedparameterdictionary](/dotnet/api/System.Management.Automation.RuntimeDefinedParameterDictionary) object.</span></span>

<span data-ttu-id="ebd58-143">Этот базовый поставщик не переопределяет этот метод.</span><span class="sxs-lookup"><span data-stu-id="ebd58-143">This basic provider does not override this method.</span></span> <span data-ttu-id="ebd58-144">Однако следующий код демонстрирует реализацию этого метода по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="ebd58-144">However, the following code shows the default implementation of this method:</span></span>

<!-- TODO!!!: review snippet reference  [!CODE [Msh_samplesaccessdbprov01#accessdbprov01ProviderDynamicParameters](Msh_samplesaccessdbprov01#accessdbprov01ProviderDynamicParameters)]  -->

## <a name="uninitializing-the-provider"></a><span data-ttu-id="ebd58-145">Отмена инициализации поставщика</span><span class="sxs-lookup"><span data-stu-id="ebd58-145">Uninitializing the Provider</span></span>

<span data-ttu-id="ebd58-146">Чтобы освободить ресурсы, используемые поставщиком Windows PowerShell, поставщик должен реализовать собственный метод [System. Management. Automation. Provider. кмдлетпровидер. останавливают \*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Stop) .</span><span class="sxs-lookup"><span data-stu-id="ebd58-146">To free resources that the Windows PowerShell provider uses, your provider should implement its own [System.Management.Automation.Provider.Cmdletprovider.Stop\*](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.Stop) method.</span></span> <span data-ttu-id="ebd58-147">Этот метод вызывается средой выполнения Windows PowerShell для деинициализации поставщика при закрытии сеанса.</span><span class="sxs-lookup"><span data-stu-id="ebd58-147">This method is called by the Windows PowerShell runtime to uninitialize the provider at the close of a session.</span></span>

<span data-ttu-id="ebd58-148">Этот базовый поставщик не переопределяет этот метод.</span><span class="sxs-lookup"><span data-stu-id="ebd58-148">This basic provider does not override this method.</span></span> <span data-ttu-id="ebd58-149">Однако следующий код демонстрирует реализацию этого метода по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="ebd58-149">However, the following code shows the default implementation of this method:</span></span>

<!-- TODO!!!: review snippet reference  [!CODE [Msh_samplesaccessdbprov01#accessdbprov01ProviderStop](Msh_samplesaccessdbprov01#accessdbprov01ProviderStop)]  -->

## <a name="code-sample"></a><span data-ttu-id="ebd58-150">Образец кода</span><span class="sxs-lookup"><span data-stu-id="ebd58-150">Code Sample</span></span>

<span data-ttu-id="ebd58-151">Полный пример кода см. в разделе [пример кода AccessDbProviderSample01](./accessdbprovidersample01-code-sample.md).</span><span class="sxs-lookup"><span data-stu-id="ebd58-151">For complete sample code, see [AccessDbProviderSample01 Code Sample](./accessdbprovidersample01-code-sample.md).</span></span>

## <a name="testing-the-windows-powershell-provider"></a><span data-ttu-id="ebd58-152">Тестирование поставщика Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="ebd58-152">Testing the Windows PowerShell Provider</span></span>

<span data-ttu-id="ebd58-153">После регистрации поставщика Windows PowerShell в Windows PowerShell можно протестировать его, запустив в командной строке поддерживаемые командлеты.</span><span class="sxs-lookup"><span data-stu-id="ebd58-153">Once your Windows PowerShell provider has been registered with Windows PowerShell, you can test it by running the supported cmdlets on the command line.</span></span> <span data-ttu-id="ebd58-154">Для этого базового поставщика запустите новую оболочку и `Get-PSProvider` с помощью командлета извлеките список поставщиков и убедитесь в наличии поставщика акцессдб.</span><span class="sxs-lookup"><span data-stu-id="ebd58-154">For this basic provider, run the new shell and use the `Get-PSProvider` cmdlet to retrieve the list of providers and ensure that the AccessDb provider is present.</span></span>

```powershell
Get-PSProvider
```

<span data-ttu-id="ebd58-155">Отображаются следующие результаты:</span><span class="sxs-lookup"><span data-stu-id="ebd58-155">The following output appears:</span></span>

```Output
Name                 Capabilities                  Drives
----                 ------------                  ------
AccessDb             None                          {}
Alias                ShouldProcess                 {Alias}
Environment          ShouldProcess                 {Env}
FileSystem           Filter, ShouldProcess         {C, Z}
Function             ShouldProcess                 {function}
Registry             ShouldProcess                 {HKLM, HKCU}
```

## <a name="see-also"></a><span data-ttu-id="ebd58-156">См. также:</span><span class="sxs-lookup"><span data-stu-id="ebd58-156">See Also</span></span>

[<span data-ttu-id="ebd58-157">Создание поставщиков Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="ebd58-157">Creating Windows PowerShell Providers</span></span>](./how-to-create-a-windows-powershell-provider.md)

[<span data-ttu-id="ebd58-158">Разработка поставщика Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="ebd58-158">Designing Your Windows PowerShell Provider</span></span>](./designing-your-windows-powershell-provider.md)
