---
ms.date: 09/13/2016
ms.topic: reference
title: Запрос на подтверждение от командлетов
description: Запрос на подтверждение от командлетов
ms.openlocfilehash: fd869d50b185cb4d38269640df58ec284a32da50
ms.sourcegitcommit: ba7315a496986451cfc1296b659d73ea2373d3f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "92646414"
---
# <a name="requesting-confirmation-from-cmdlets"></a><span data-ttu-id="35106-103">Запрос на подтверждение от командлетов</span><span class="sxs-lookup"><span data-stu-id="35106-103">Requesting Confirmation from Cmdlets</span></span>

<span data-ttu-id="35106-104">Командлеты должны запрашивать подтверждение, когда они собирается внести изменения в систему, которая находится за пределами среды Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="35106-104">Cmdlets should request confirmation when they are about to make a change to the system that is outside of the Windows PowerShell environment.</span></span> <span data-ttu-id="35106-105">Например, если командлет собирается добавить учетную запись пользователя или приостанавливает процесс, командлет должен потребовать подтверждения от пользователя перед тем, как оно будет продолжено.</span><span class="sxs-lookup"><span data-stu-id="35106-105">For example, if a cmdlet is about to add a user account or stop a process, the cmdlet should require confirmation from the user before it proceeds.</span></span> <span data-ttu-id="35106-106">Напротив, если командлет собирается изменить переменную Windows PowerShell, командлету не требуется требовать подтверждения.</span><span class="sxs-lookup"><span data-stu-id="35106-106">In contrast, if a cmdlet is about to change a Windows PowerShell variable, the cmdlet does not need to require confirmation.</span></span>

<span data-ttu-id="35106-107">Чтобы сделать запрос на подтверждение, командлет должен указать, что он поддерживает запросы на подтверждение, и он должен вызвать методы [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) и [System. Management. Automation. командлет. ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) (необязательные) для отображения сообщения запроса подтверждения.</span><span class="sxs-lookup"><span data-stu-id="35106-107">In order to make a confirmation request, the cmdlet must indicate that it supports confirmation requests, and it must call the [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) and [System.Management.Automation.Cmdlet.ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) (optional) methods to display a confirmation request message.</span></span>

## <a name="supporting-confirmation-requests"></a><span data-ttu-id="35106-108">Поддержка запросов на подтверждение</span><span class="sxs-lookup"><span data-stu-id="35106-108">Supporting Confirmation Requests</span></span>

<span data-ttu-id="35106-109">Для поддержки запросов на подтверждение командлет должен задать `SupportsShouldProcess` для параметра атрибута командлета значение `true` .</span><span class="sxs-lookup"><span data-stu-id="35106-109">To support confirmation requests, the cmdlet must set the `SupportsShouldProcess` parameter of the Cmdlet attribute to `true`.</span></span> <span data-ttu-id="35106-110">Это включает `Confirm` `WhatIf` параметры командлета и, предоставляемые Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="35106-110">This enables the `Confirm` and `WhatIf` cmdlet parameters that are provided by Windows PowerShell.</span></span> <span data-ttu-id="35106-111">`Confirm`Параметр позволяет пользователю контролировать, отображается ли запрос подтверждения.</span><span class="sxs-lookup"><span data-stu-id="35106-111">The `Confirm` parameter allows the user to control whether the confirmation request is displayed.</span></span> <span data-ttu-id="35106-112">`WhatIf`Параметр позволяет пользователю определить, должен ли командлет отображать сообщение или выполнить его действие.</span><span class="sxs-lookup"><span data-stu-id="35106-112">The `WhatIf` parameter allows the user to determine whether the cmdlet should display a message or perform its action.</span></span> <span data-ttu-id="35106-113">Не добавляйте `Confirm` `WhatIf` Параметры и в командлет вручную.</span><span class="sxs-lookup"><span data-stu-id="35106-113">Do not manually add the `Confirm` and `WhatIf` parameters to a cmdlet.</span></span>

<span data-ttu-id="35106-114">В следующем примере показано объявление атрибута командлета, которое поддерживает запросы на подтверждение.</span><span class="sxs-lookup"><span data-stu-id="35106-114">The following example shows a Cmdlet attribute declaration that supports confirmation requests.</span></span>

```csharp
[Cmdlet(VerbsDiagnostic.Test, "RequestConfirmationTemplate1",
        SupportsShouldProcess = true)]
```

## <a name="calling-the-confirmation-request-methods"></a><span data-ttu-id="35106-115">Вызов методов запроса подтверждения</span><span class="sxs-lookup"><span data-stu-id="35106-115">Calling the Confirmation request methods</span></span>

<span data-ttu-id="35106-116">В коде командлета вызовите метод [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) перед операцией, которая изменяет систему.</span><span class="sxs-lookup"><span data-stu-id="35106-116">In the cmdlet code, call the [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) method before the operation that changes the system is performed.</span></span> <span data-ttu-id="35106-117">Разработайте командлет таким образом, чтобы, если вызов возвращает значение `false` , операция не выполняется, а командлет обрабатывает следующую операцию.</span><span class="sxs-lookup"><span data-stu-id="35106-117">Design the cmdlet so that if the call returns a value of `false`, the operation is not performed, and the cmdlet processes the next operation.</span></span>

## <a name="calling-the-shouldcontinue-method"></a><span data-ttu-id="35106-118">Вызов метода ShouldContinue</span><span class="sxs-lookup"><span data-stu-id="35106-118">Calling the ShouldContinue Method</span></span>

<span data-ttu-id="35106-119">Большинство командлетов запрашивают подтверждение, используя только метод [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) .</span><span class="sxs-lookup"><span data-stu-id="35106-119">Most cmdlets request confirmation using only the [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) method.</span></span> <span data-ttu-id="35106-120">Однако в некоторых случаях может потребоваться дополнительное подтверждение.</span><span class="sxs-lookup"><span data-stu-id="35106-120">However, some cases might require additional confirmation.</span></span> <span data-ttu-id="35106-121">В этих случаях дополнит вызов метода [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) , вызвав метод [System. Management. Automation. командлет. ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) .</span><span class="sxs-lookup"><span data-stu-id="35106-121">For these cases, supplement the [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) call with a call to the [System.Management.Automation.Cmdlet.ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) method.</span></span> <span data-ttu-id="35106-122">Это позволяет командлету или поставщику более точно контролировать область действия **Да для всех** ответов на запрос подтверждения.</span><span class="sxs-lookup"><span data-stu-id="35106-122">This allows the cmdlet or provider to more finely control the scope of the **Yes to all** response to the confirmation prompt.</span></span>

<span data-ttu-id="35106-123">Если командлет вызывает метод [System. Management. Automation. командлет. ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) , командлет также должен предоставить `Force` параметр Switch.</span><span class="sxs-lookup"><span data-stu-id="35106-123">If a cmdlet calls the [System.Management.Automation.Cmdlet.ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) method, the cmdlet must also provide a `Force` switch parameter.</span></span> <span data-ttu-id="35106-124">Если пользователь указывает `Force` , когда пользователь вызывает командлет, командлет должен по-прежнему вызывать метод [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess), но не должен обходить вызов [System. Management. Automation. командлет. ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue).</span><span class="sxs-lookup"><span data-stu-id="35106-124">If the user specifies `Force` when the user invokes the cmdlet, the cmdlet should still call [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess), but it should bypass the call to [System.Management.Automation.Cmdlet.ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue).</span></span>

<span data-ttu-id="35106-125">[System. Management. Automation. командлет. ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) будет вызывать исключение при вызове из неинтерактивной среды, в которой пользователю не удается получить запрос.</span><span class="sxs-lookup"><span data-stu-id="35106-125">[System.Management.Automation.Cmdlet.ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue) will throw an exception when it is called from a non-interactive environment where the user cannot be prompted.</span></span> <span data-ttu-id="35106-126">Добавление `Force` параметра гарантирует, что команда будет по-прежнему выполняться при ее вызове в неинтерактивной среде.</span><span class="sxs-lookup"><span data-stu-id="35106-126">Adding a `Force` parameter ensures that the command can still be performed when it is invoked in a non-interactive environment.</span></span>

<span data-ttu-id="35106-127">В следующем примере показано, как вызвать [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) и [System. Management. Automation. командлет. ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue).</span><span class="sxs-lookup"><span data-stu-id="35106-127">The following example shows how to call [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) and [System.Management.Automation.Cmdlet.ShouldContinue](/dotnet/api/System.Management.Automation.Cmdlet.ShouldContinue).</span></span>

```csharp
if (ShouldProcess (...) )
{
  if (Force || ShouldContinue(...))
  {
     // Add code that performs the operation.
  }
}
```

<span data-ttu-id="35106-128">Поведение вызова [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) может различаться в зависимости от среды, в которой вызывается командлет.</span><span class="sxs-lookup"><span data-stu-id="35106-128">The behavior of a [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) call can vary depending on the environment in which the cmdlet is invoked.</span></span> <span data-ttu-id="35106-129">Использование описанных выше правил поможет обеспечить согласованность командлета с другими командлетами независимо от среды размещения.</span><span class="sxs-lookup"><span data-stu-id="35106-129">Using the previous guidelines will help ensure that the cmdlet behaves consistently with other cmdlets, regardless of the host environment.</span></span>

<span data-ttu-id="35106-130">Пример вызова метода [System. Management. Automation. командлета. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) см. [в разделе как запросить подтверждения](./how-to-request-confirmations.md).</span><span class="sxs-lookup"><span data-stu-id="35106-130">For an example of calling the [System.Management.Automation.Cmdlet.ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) method, see [How to Request Confirmations](./how-to-request-confirmations.md).</span></span>

## <a name="specify-the-impact-level"></a><span data-ttu-id="35106-131">Укажите уровень влияния</span><span class="sxs-lookup"><span data-stu-id="35106-131">Specify the Impact Level</span></span>

<span data-ttu-id="35106-132">При создании командлета укажите уровень влияния (серьезность) изменения.</span><span class="sxs-lookup"><span data-stu-id="35106-132">When you create the cmdlet, specify the impact level (the severity) of the change.</span></span> <span data-ttu-id="35106-133">Для этого задайте `ConfirmImpact` для параметра атрибута командлета значение высокий, средний или низкий.</span><span class="sxs-lookup"><span data-stu-id="35106-133">To do this, set the value of the `ConfirmImpact` parameter of the Cmdlet attribute to High, Medium, or Low.</span></span> <span data-ttu-id="35106-134">Можно указать значение `ConfirmImpact` только в том случае, если также указать `SupportsShouldProcess` параметр для командлета.</span><span class="sxs-lookup"><span data-stu-id="35106-134">You can specify a value for `ConfirmImpact` only when you also specify the `SupportsShouldProcess` parameter for the cmdlet.</span></span>

<span data-ttu-id="35106-135">Для большинства командлетов не нужно явно указывать `ConfirmImpact` .</span><span class="sxs-lookup"><span data-stu-id="35106-135">For most cmdlets, you do not have to explicitly specify `ConfirmImpact`.</span></span>  <span data-ttu-id="35106-136">Вместо этого используйте параметр по умолчанию, который является средним.</span><span class="sxs-lookup"><span data-stu-id="35106-136">Instead, use the default setting of the parameter, which is Medium.</span></span> <span data-ttu-id="35106-137">Если задано значение `ConfirmImpact` высокий, операция будет подтверждена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="35106-137">If you set `ConfirmImpact` to High, the operation will be confirmed by default.</span></span> <span data-ttu-id="35106-138">Зарезервируйте этот параметр для критических действий, таких как переформатирование тома жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="35106-138">Reserve this setting for highly disruptive actions, such as reformatting a hard-disk volume.</span></span>

## <a name="calling-non-confirmation-methods"></a><span data-ttu-id="35106-139">Вызов методов без подтверждения</span><span class="sxs-lookup"><span data-stu-id="35106-139">Calling Non-Confirmation Methods</span></span>

<span data-ttu-id="35106-140">Если командлет или поставщик должен отправить сообщение, но не запрашивать подтверждение, он может вызвать следующие три метода.</span><span class="sxs-lookup"><span data-stu-id="35106-140">If the cmdlet or provider must send a message but not request confirmation, it can call the following three methods.</span></span> <span data-ttu-id="35106-141">Избегайте использования метода [System. Management. Automation. командлет. WriteObject](/dotnet/api/System.Management.Automation.Cmdlet.WriteObject) для отправки сообщений этих типов, так как выходные данные [System. Management. Automation. командлет. WriteObject](/dotnet/api/System.Management.Automation.Cmdlet.WriteObject) запутанной с обычными выходными данными командлета или поставщика, что затрудняет написание сценариев.</span><span class="sxs-lookup"><span data-stu-id="35106-141">Avoid using the [System.Management.Automation.Cmdlet.WriteObject](/dotnet/api/System.Management.Automation.Cmdlet.WriteObject) method to send messages of these types because [System.Management.Automation.Cmdlet.WriteObject](/dotnet/api/System.Management.Automation.Cmdlet.WriteObject) output is intermingled with the normal output of your cmdlet or provider, which makes script writing difficult.</span></span>

- <span data-ttu-id="35106-142">Для предупреждения пользователя и продолжения операции командлет или поставщик может вызвать метод [System. Management. Automation. командлет. вритеварнинг](/dotnet/api/System.Management.Automation.Cmdlet.WriteWarning) .</span><span class="sxs-lookup"><span data-stu-id="35106-142">To caution the user and continue with the operation, the cmdlet or provider can call the [System.Management.Automation.Cmdlet.WriteWarning](/dotnet/api/System.Management.Automation.Cmdlet.WriteWarning) method.</span></span>

- <span data-ttu-id="35106-143">Чтобы предоставить дополнительные сведения, которые пользователь может получить с помощью `Verbose` параметра, командлет или поставщик может вызвать метод [System. Management. Automation. командлет. вритевербосе](/dotnet/api/System.Management.Automation.Cmdlet.WriteVerbose) .</span><span class="sxs-lookup"><span data-stu-id="35106-143">To provide additional information that the user can retrieve using the `Verbose` parameter, the cmdlet or provider can call the [System.Management.Automation.Cmdlet.WriteVerbose](/dotnet/api/System.Management.Automation.Cmdlet.WriteVerbose) method.</span></span>

- <span data-ttu-id="35106-144">Чтобы предоставить сведения на уровне отладки для других разработчиков или для поддержки продукта, командлет или поставщик может вызвать метод [System. Management. Automation. командлет. вритедебуг](/dotnet/api/System.Management.Automation.Cmdlet.WriteDebug) .</span><span class="sxs-lookup"><span data-stu-id="35106-144">To provide debugging-level detail for other developers or for product support, the cmdlet or provider can call the [System.Management.Automation.Cmdlet.WriteDebug](/dotnet/api/System.Management.Automation.Cmdlet.WriteDebug) method.</span></span> <span data-ttu-id="35106-145">Пользователь может получить эти сведения с помощью `Debug` параметра.</span><span class="sxs-lookup"><span data-stu-id="35106-145">The user can retrieve this information using the `Debug` parameter.</span></span>

<span data-ttu-id="35106-146">Командлеты и поставщики сначала вызывают следующие методы, чтобы запросить подтверждение, прежде чем они попытаются выполнить операцию, которая изменяет систему за пределами Windows PowerShell:</span><span class="sxs-lookup"><span data-stu-id="35106-146">Cmdlets and providers first call the following methods to request confirmation before they attempt to perform an operation that changes a system outside of Windows PowerShell:</span></span>

- [<span data-ttu-id="35106-147">System. Management. Automation. командлет. ShouldProcess</span><span class="sxs-lookup"><span data-stu-id="35106-147">System.Management.Automation.Cmdlet.Shouldprocess</span></span>](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess)

- [<span data-ttu-id="35106-148">System. Management. Automation. Provider. Кмдлетпровидер. ShouldProcess</span><span class="sxs-lookup"><span data-stu-id="35106-148">System.Management.Automation.Provider.Cmdletprovider.Shouldprocess</span></span>](/dotnet/api/System.Management.Automation.Provider.CmdletProvider.ShouldProcess)

<span data-ttu-id="35106-149">Это можно сделать, вызвав метод [System. Management. Automation. командлет. ShouldProcess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) , который предлагает пользователю подтвердить операцию в зависимости от того, как пользователь вызвал команду.</span><span class="sxs-lookup"><span data-stu-id="35106-149">They do so by calling the [System.Management.Automation.Cmdlet.Shouldprocess](/dotnet/api/System.Management.Automation.Cmdlet.ShouldProcess) method, which prompts the user to confirm the operation based on how the user invoked the command.</span></span>

## <a name="see-also"></a><span data-ttu-id="35106-150">См. также</span><span class="sxs-lookup"><span data-stu-id="35106-150">See Also</span></span>

[<span data-ttu-id="35106-151">Запись командлета Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="35106-151">Writing a Windows PowerShell Cmdlet</span></span>](./writing-a-windows-powershell-cmdlet.md)
