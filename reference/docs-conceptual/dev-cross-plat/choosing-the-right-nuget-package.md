---
title: Выбор подходящего пакета NuGet PowerShell для проекта .NET
description: Наряду с исполняемыми пакетами, опубликованными в каждом выпуске PowerShell, группа разработчиков PowerShell также предоставляет несколько пакетов, доступных в NuGet. Эти пакеты позволяют ориентироваться на PowerShell как платформу API в .NET.
ms.date: 06/25/2020
ms.custom: rjmholt
ms.openlocfilehash: 39369ed872faa76ad2c41d813da5e0a98cf1c078
ms.sourcegitcommit: d0461273abb6db099c5e784ef00f57fd551be4a6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2020
ms.locfileid: "85795320"
---
# <a name="choosing-the-right-powershell-nuget-package-for-your-net-project"></a><span data-ttu-id="cbfba-104">Выбор подходящего пакета NuGet PowerShell для проекта .NET</span><span class="sxs-lookup"><span data-stu-id="cbfba-104">Choosing the right PowerShell NuGet package for your .NET project</span></span>

<span data-ttu-id="cbfba-105">Наряду с исполняемыми пакетами `pwsh`, опубликованными в каждом выпуске PowerShell, группа разработчиков PowerShell также предоставляет несколько пакетов, доступных в [NuGet][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-105">Alongside the `pwsh` executable packages published with each PowerShell release, the PowerShell team also maintains several packages available on [NuGet][].</span></span> <span data-ttu-id="cbfba-106">Эти пакеты позволяют ориентироваться на PowerShell как платформу API в .NET.</span><span class="sxs-lookup"><span data-stu-id="cbfba-106">These packages allow targeting PowerShell as an API platform in .NET.</span></span>

<span data-ttu-id="cbfba-107">Как приложение .NET, которое предоставляет API и ожидает загрузки библиотек .NET, реализуя собственные двоичные модули, PowerShell должен быть доступен в виде пакета NuGet.</span><span class="sxs-lookup"><span data-stu-id="cbfba-107">As a .NET application that provides APIs and expects to load .NET libraries implementing its own (binary modules), it's essential that PowerShell be available in the form of a NuGet package.</span></span>

<span data-ttu-id="cbfba-108">В настоящее время существует несколько пакетов NuGet, которые обеспечивают некоторое представление контактной зоны API PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-108">Currently there are several NuGet packages that provide some representation of the PowerShell API surface area.</span></span> <span data-ttu-id="cbfba-109">Не всегда ясно, какой пакет использовать с определенным проектом.</span><span class="sxs-lookup"><span data-stu-id="cbfba-109">Which package to use with a particular project hasn't always been made clear.</span></span> <span data-ttu-id="cbfba-110">В этой статье рассказывается о нескольких распространенных сценариях для проектов .NET, предназначенных для PowerShell, и о том, как выбрать подходящий пакет NuGet для проекта .NET, ориентированного на PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-110">This article sheds some light on a few common scenarios for PowerShell-targeting .NET projects and how to choose the right NuGet package to target for your PowerShell-oriented .NET project.</span></span>

## <a name="hosting-vs-referencing"></a><span data-ttu-id="cbfba-111">Размещение и ссылки</span><span class="sxs-lookup"><span data-stu-id="cbfba-111">Hosting vs referencing</span></span>

<span data-ttu-id="cbfba-112">В некоторых проектах .NET разработчики пишут код для загрузки в уже существующую среду выполнения PowerShell (например, `pwsh`, `powershell.exe`, интегрированная консоль PowerShell или ISE), а некоторые проекты запускаются в PowerShell в виде отдельных приложений.</span><span class="sxs-lookup"><span data-stu-id="cbfba-112">Some .NET projects seek to write code to be loaded into a pre-existing PowerShell runtime (such as `pwsh`, `powershell.exe`, the PowerShell Integrated Console or the ISE), while others want to run PowerShell in their own applications.</span></span>

- <span data-ttu-id="cbfba-113">**Ссылка** используется в случаях, когда проект (обычно это модуль) должен загружаться в PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-113">**Referencing** is for when a project, usually a module, is intended to be loaded into PowerShell.</span></span>
  <span data-ttu-id="cbfba-114">Его необходимо скомпилировать с помощью API, предоставляемых PowerShell, чтобы с ним можно было взаимодействовать, но реализация PowerShell предоставляется процессом PowerShell, который загружает проект.</span><span class="sxs-lookup"><span data-stu-id="cbfba-114">It must be compiled against the APIs that PowerShell provides in order to interact with it, but the PowerShell implementation is supplied by the PowerShell process loading it in.</span></span> <span data-ttu-id="cbfba-115">Для ссылки проект может использовать [базовые сборки][] или фактические сборки среды выполнения в качестве целевого объекта компиляции, но он не должен публиковать их в своей сборке.</span><span class="sxs-lookup"><span data-stu-id="cbfba-115">For referencing, a project can use [reference assemblies][] or the actual runtime assemblies as a compilation target, but must ensure that it does not publish any of these with its build.</span></span>
- <span data-ttu-id="cbfba-116">**Размещение** используется, когда проекту нужна собственная реализация PowerShell (обычно если это отдельное приложение, которое должно выполняться с PowerShell).</span><span class="sxs-lookup"><span data-stu-id="cbfba-116">**Hosting** is when a project needs its own implementation of PowerShell, usually because it is a standalone application that needs to run PowerShell.</span></span> <span data-ttu-id="cbfba-117">В этом случае нельзя использовать чистые базовые сборки.</span><span class="sxs-lookup"><span data-stu-id="cbfba-117">In this case, pure reference assemblies cannot be used.</span></span> <span data-ttu-id="cbfba-118">Вместо этого проект будет зависеть от конкретной реализации PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-118">Instead, a concrete PowerShell implementation must be depended upon.</span></span> <span data-ttu-id="cbfba-119">Поскольку необходимо использовать конкретную реализацию PowerShell, для размещения требуется выбрать определенную версию PowerShell. Одно ведущее приложение не может быть предназначено для нескольких целевых версий PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-119">Because a concrete PowerShell implementation must be used, a specific version of PowerShell must be chosen for hosting; a single host application cannot multi-target PowerShell versions.</span></span>

### <a name="publishing-projects-that-target-powershell-as-a-reference"></a><span data-ttu-id="cbfba-120">Публикация проектов для PowerShell в виде ссылки</span><span class="sxs-lookup"><span data-stu-id="cbfba-120">Publishing projects that target PowerShell as a reference</span></span>

> [!NOTE]
> <span data-ttu-id="cbfba-121">В этой статье под **публикацией** мы подразумеваем выполнение `dotnet publish`, в результате которого библиотека .NET помещается в каталог со всеми зависимостями, готовая к развертыванию в определенной среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="cbfba-121">We use the term **publish** in this article to refer to running `dotnet publish`, which places a .NET library into a directory with all of its dependencies, ready for deployment to a particular runtime.</span></span>

<span data-ttu-id="cbfba-122">Чтобы предотвратить публикацию зависимостей проекта, которые используются только как базовые целевые объекты при компиляции, рекомендуется задать [атрибут PrivateAssets][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-122">In order to prevent publishing project dependencies that are just being used as compilation reference targets, it is recommended to set the [PrivateAssets attribute][]:</span></span>

```xml
<PackageReference Include="PowerShellStandard.Library" Version="5.1.0.0" PrivateAssets="all" />
```

<span data-ttu-id="cbfba-123">Если вы забудете сделать это и используете базовую сборку в качестве целевого объекта, могут возникнуть проблемы, связанные с использованием реализации базовой сборки по умолчанию вместо фактической реализации.</span><span class="sxs-lookup"><span data-stu-id="cbfba-123">If you forget to do this and use a reference assembly as your target, you may see issues related to using the reference assembly's default implementation instead of the actual implementation.</span></span> <span data-ttu-id="cbfba-124">Может возникнуть исключение `NullReferenceException`, так как базовые сборки часто используют макет реализации API, просто возвращая `null`.</span><span class="sxs-lookup"><span data-stu-id="cbfba-124">This may take the form of a `NullReferenceException`, since reference assemblies often mock the implementation API by simply returning `null`.</span></span>

## <a name="key-kinds-of-powershell-targeting-net-projects"></a><span data-ttu-id="cbfba-125">Основные типы проектов .NET для PowerShell</span><span class="sxs-lookup"><span data-stu-id="cbfba-125">Key kinds of PowerShell-targeting .NET projects</span></span>

<span data-ttu-id="cbfba-126">Хотя PowerShell может быть встроен в любую библиотеку или приложение .NET, некоторые сценарии использования API PowerShell более популярны.</span><span class="sxs-lookup"><span data-stu-id="cbfba-126">While any .NET library or application can embed PowerShell, there are some common scenarios that use PowerShell APIs:</span></span>

- <span data-ttu-id="cbfba-127">**Реализация двоичного модуля PowerShell**</span><span class="sxs-lookup"><span data-stu-id="cbfba-127">**Implementing a PowerShell binary module**</span></span>

  <span data-ttu-id="cbfba-128">Двоичные модули PowerShell — это библиотеки .NET, загружаемые с помощью PowerShell, которые должны реализовывать API PowerShell как типы [PSCmdlet][] или [CmdletProvider][], чтобы предоставить доступ к командлетам или поставщикам соответственно.</span><span class="sxs-lookup"><span data-stu-id="cbfba-128">PowerShell binary modules are .NET libraries loaded by PowerShell that must implement PowerShell APIs like the [PSCmdlet][] or [CmdletProvider][] types in order to expose cmdlets or providers respectively.</span></span> <span data-ttu-id="cbfba-129">Так как они загружены, модули стараются выполнить компиляцию по ссылкам на PowerShell без публикации его в сборке.</span><span class="sxs-lookup"><span data-stu-id="cbfba-129">Because they are loaded in, modules seek to compile against references to PowerShell without publishing it in their build.</span></span> <span data-ttu-id="cbfba-130">Часто модули предназначены для нескольких версий и платформ PowerShell, в идеале требуя минимум дискового пространства, сложных действий или повторной реализации.</span><span class="sxs-lookup"><span data-stu-id="cbfba-130">It's also common for modules to want to support multiple PowerShell versions and platforms, ideally with a minimum of overhead of disk space, complexity, or repeated implementation.</span></span> <span data-ttu-id="cbfba-131">Дополнительные сведения о модулях см. в разделе [about_Modules][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-131">See [about_Modules][] for more information about modules.</span></span>

- <span data-ttu-id="cbfba-132">**Реализация узла PowerShell**</span><span class="sxs-lookup"><span data-stu-id="cbfba-132">**Implementing a PowerShell Host**</span></span>

  <span data-ttu-id="cbfba-133">Узел PowerShell предоставляет уровень взаимодействия для среды выполнения PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-133">A PowerShell Host provides an interaction layer for the PowerShell runtime.</span></span> <span data-ttu-id="cbfba-134">Это определенная форма _размещения_, в которой [PSHost][] реализован в качестве нового пользовательского интерфейса для PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-134">It is a specific form of _hosting_, where a [PSHost][] is implemented as a new user interface to PowerShell.</span></span> <span data-ttu-id="cbfba-135">Например, PowerShell ConsoleHost предоставляет пользовательский интерфейс терминала для исполняемых файлов PowerShell, а узел служб редактора PowerShell и узел ISE предоставляют встроенный в редактор частично графический пользовательский интерфейс на основе PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-135">For example, the PowerShell ConsoleHost provides a terminal user interface for PowerShell executables, while the PowerShell Editor Services Host and the ISE Host both provide an editor-integrated partially graphical user interface around PowerShell.</span></span> <span data-ttu-id="cbfba-136">Хотя вы можете загрузить узел в существующий процесс PowerShell, обычно он представлен как автономная реализация PowerShell, распространяющая подсистему PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-136">While it's possible to load a host onto an existing PowerShell process, it's much more common for a host implementation to act as a standalone PowerShell implementation that redistributes the PowerShell engine.</span></span>

- <span data-ttu-id="cbfba-137">**Вызов PowerShell из другого приложения .NET**</span><span class="sxs-lookup"><span data-stu-id="cbfba-137">**Calling into PowerShell from another .NET application**</span></span>

  <span data-ttu-id="cbfba-138">Как и в любом другом приложении, PowerShell можно вызывать как подпроцесс для выполнения рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="cbfba-138">As with any application, PowerShell can be called as a subprocess to run workloads.</span></span> <span data-ttu-id="cbfba-139">В приложениях .NET можно также вызвать PowerShell внутри процесса для возврата полных объектов .NET для использования в вызывающем приложении.</span><span class="sxs-lookup"><span data-stu-id="cbfba-139">However, as a .NET application, it's also possible to invoke PowerShell in-process to get back full .NET objects for use within the calling application.</span></span> <span data-ttu-id="cbfba-140">Это более общая форма _размещения_, в которой приложение содержит собственную реализацию PowerShell для внутреннего использования.</span><span class="sxs-lookup"><span data-stu-id="cbfba-140">This is a more general form of _hosting_, where the application holds its own PowerShell implementation for internal use.</span></span> <span data-ttu-id="cbfba-141">Например, это может быть служба или управляющая программа, выполняющая PowerShell для управления состоянием компьютера или веб-приложением, которое запускает PowerShell по запросу, чтобы управлять облачными развертываниями или выполнять другие задачи.</span><span class="sxs-lookup"><span data-stu-id="cbfba-141">Examples of this might be a service or daemon running PowerShell to manage machine state or a web application that runs PowerShell on request to do something like manage cloud deployments.</span></span>

- <span data-ttu-id="cbfba-142">**Модульное тестирование модулей PowerShell из .NET**</span><span class="sxs-lookup"><span data-stu-id="cbfba-142">**Unit testing PowerShell modules from .NET**</span></span>

  <span data-ttu-id="cbfba-143">Хотя модули и другие библиотеки, предназначенные для предоставления функциональных возможностей PowerShell, должны тестироваться главным образом в PowerShell (мы рекомендуем [Pester][]), иногда необходимо выполнить модульные тесты API, написанные для модуля PowerShell, в .NET.</span><span class="sxs-lookup"><span data-stu-id="cbfba-143">While modules and other libraries designed to expose functionality to PowerShell should be primarily tested from PowerShell (we recommend [Pester][]), sometimes it's necessary to unit test APIs written for a PowerShell module from .NET.</span></span> <span data-ttu-id="cbfba-144">В этой ситуации код модуля пытается выбрать несколько версий PowerShell, а тестирование должно выполняться в конкретных реализациях.</span><span class="sxs-lookup"><span data-stu-id="cbfba-144">This situation involves the module code trying to target a number of PowerShell versions, while testing should run it on specific, concrete implementations.</span></span>

## <a name="powershell-nuget-packages-at-a-glance"></a><span data-ttu-id="cbfba-145">Краткий обзор пакетов NuGet для PowerShell</span><span class="sxs-lookup"><span data-stu-id="cbfba-145">PowerShell NuGet packages at a glance</span></span>

<span data-ttu-id="cbfba-146">В этой статье рассматриваются следующие пакеты NuGet, которые предоставляют API-интерфейсы PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-146">In this article, we'll cover the following NuGet packages that expose PowerShell APIs:</span></span>

- <span data-ttu-id="cbfba-147">[PowerShellStandard.Library][] — базовая сборка, позволяющая создавать одну сборку, которую можно загрузить несколькими средами выполнения PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-147">[PowerShellStandard.Library][], a reference assembly that enables building a single assembly that can be loaded by multiple PowerShell runtimes.</span></span>
- <span data-ttu-id="cbfba-148">[Microsoft.PowerShell.SDK][] — способ назначения и повторного размещения всего пакета SDK для PowerShell</span><span class="sxs-lookup"><span data-stu-id="cbfba-148">[Microsoft.PowerShell.SDK][], the way to target and rehost the whole PowerShell SDK</span></span>
- <span data-ttu-id="cbfba-149">Пакет [System.Management.Automation][] — основная среда выполнения PowerShell и реализация ядра, которые могут быть полезны в минимальных размещенных реализациях и сценариях нацеливания на конкретные версии.</span><span class="sxs-lookup"><span data-stu-id="cbfba-149">The [System.Management.Automation][] package, the core PowerShell runtime and engine implementation, that can be useful in minimal hosted implementations and for version-specific targeting scenarios.</span></span>
- <span data-ttu-id="cbfba-150">**Базовые сборки Windows PowerShell** — это способ назначения и эффективного повторного размещения Windows PowerShell (PowerShell версии 5.1 и более ранних).</span><span class="sxs-lookup"><span data-stu-id="cbfba-150">The **Windows PowerShell reference assemblies**, the way to target and effectively rehost Windows PowerShell (PowerShell versions 5.1 and below).</span></span>

> [!NOTE]
> <span data-ttu-id="cbfba-151">Пакет [PowerShell NuGet][] не входит в библиотеку .NET, но предоставляет реализацию глобального средства PowerShell dotnet.</span><span class="sxs-lookup"><span data-stu-id="cbfba-151">The [PowerShell NuGet][] package is not a .NET library package at all, but instead provides the PowerShell dotnet global tool implementation.</span></span> <span data-ttu-id="cbfba-152">Он не должен использоваться проектами, так как предоставляет только исполняемый файл.</span><span class="sxs-lookup"><span data-stu-id="cbfba-152">This should not be used by any projects, since it only provides an executable.</span></span>

## <a name="powershellstandardlibrary"></a><span data-ttu-id="cbfba-153">PowerShellStandard.Library</span><span class="sxs-lookup"><span data-stu-id="cbfba-153">PowerShellStandard.Library</span></span>

<span data-ttu-id="cbfba-154">Стандартная библиотека PowerShell — это базовая сборка, которая фиксирует пересечение API PowerShell версий 7, 6 и 5.1.</span><span class="sxs-lookup"><span data-stu-id="cbfba-154">The PowerShell Standard library is a reference assembly that captures the intersection of the APIs of PowerShell versions 7, 6 and 5.1.</span></span> <span data-ttu-id="cbfba-155">Она предоставляет поверхность API, проверенную во время компиляции, для компиляции кода .NET, позволяя нацеливать проекты .NET на версии 7, 6 и 5.1 без риска вызвать отсутствующий API.</span><span class="sxs-lookup"><span data-stu-id="cbfba-155">This provides a compile-time-checked API surface to compile .NET code against, allowing .NET projects to target PowerShell versions 7, 6 and 5.1 without risking calling an API that won't be there.</span></span>

<span data-ttu-id="cbfba-156">PowerShell Standard используется для написания модулей PowerShell или другого кода, предназначенного для запуска только после его загрузки в процесс PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-156">PowerShell Standard is intended for writing PowerShell modules, or other code only intended to be run after loading it into a PowerShell process.</span></span> <span data-ttu-id="cbfba-157">Так как это базовая сборка, PowerShell Standard не содержит саму реализацию и не предоставляет функциональные возможности для автономных приложений.</span><span class="sxs-lookup"><span data-stu-id="cbfba-157">Because it is a reference assembly, PowerShell Standard contains no implementation itself, so provides no functionality for standalone applications.</span></span>

### <a name="using-powershell-standard-with-different-net-runtimes"></a><span data-ttu-id="cbfba-158">Использование PowerShell Standard с разными средами выполнения .NET</span><span class="sxs-lookup"><span data-stu-id="cbfba-158">Using PowerShell Standard with different .NET runtimes</span></span>

<span data-ttu-id="cbfba-159">PowerShell Standard предназначен для целевой среды выполнения [.NET Standard 2.0][], которая предоставляет общую контактную зону, совместно используемую .NET Framework и .NET Core.</span><span class="sxs-lookup"><span data-stu-id="cbfba-159">PowerShell Standard targets the [.NET Standard 2.0][] target runtime, which is a façade runtime designed to provide a common surface area shared by .NET Framework and .NET Core.</span></span> <span data-ttu-id="cbfba-160">Это позволяет выбрать одну среду выполнения в качестве целевой, чтобы создать одну сборку, которая будет работать с несколькими версиями PowerShell. Но существуют некоторые ограничения.</span><span class="sxs-lookup"><span data-stu-id="cbfba-160">This allows targeting a single runtime to produce a single assembly that will work with multiple PowerShell versions, but has the following consequences:</span></span>

- <span data-ttu-id="cbfba-161">Для загрузки модуля или библиотеки в PowerShell необходима версия не ниже .NET 4.6.1; .NET 4.6 и .NET 4.5.2 не поддерживают .NET Standard.</span><span class="sxs-lookup"><span data-stu-id="cbfba-161">The PowerShell loading the module or library must be running a minimum of .NET 4.6.1; .NET 4.6 and .NET 4.5.2 do not support .NET Standard.</span></span> <span data-ttu-id="cbfba-162">Обратите внимание, что новая версия Windows PowerShell не означает более новую версию .NET Framework. Windows PowerShell 5.1 может работать на платформе .NET 4.5.2.</span><span class="sxs-lookup"><span data-stu-id="cbfba-162">Note that a newer Windows PowerShell version does not mean a newer .NET Framework version; Windows PowerShell 5.1 may run on .NET 4.5.2.</span></span>
- <span data-ttu-id="cbfba-163">Чтобы работать с PowerShell на .NET Framework 4.7.1 или более ранней версии, требуется реализация .NET 4.6.1 [NETStandard.Library][], которая предоставляет netstandard.dll и другие сборки оболочек совместимости в более ранних версиях .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cbfba-163">In order to work with a PowerShell running .NET Framework 4.7.1 or below, the .NET 4.6.1 [NETStandard.Library][] implementation is required to provide the netstandard.dll and other shim assemblies in older .NET Framework versions.</span></span>

<span data-ttu-id="cbfba-164">PowerShell 6+ предоставляет собственные сборки оболочек совместимости для перенаправления типов из .NET Framework 4.6.1 (и более поздних версий) в .NET Core.</span><span class="sxs-lookup"><span data-stu-id="cbfba-164">PowerShell 6+ provides its own shim assemblies for type forwarding from .NET Framework 4.6.1 (and above) to .NET Core.</span></span> <span data-ttu-id="cbfba-165">Это означает, что, пока модуль использует только API, существующие в .NET Core, PowerShell 6+ может загрузить и запустить его, если он создан для .NET Framework 4.6.1 (целевой объект среды выполнения `net461`).</span><span class="sxs-lookup"><span data-stu-id="cbfba-165">This means that as long as a module uses only APIs that exist in .NET Core, PowerShell 6+ can load and run it when it has been built for .NET Framework 4.6.1 (the `net461` runtime target).</span></span>

<span data-ttu-id="cbfba-166">То есть для двоичных модулей, использующих PowerShell Standard для нацеливания на несколько версий PowerShell с одной опубликованной библиотекой DLL, существует два варианта.</span><span class="sxs-lookup"><span data-stu-id="cbfba-166">This means that binary modules using PowerShell Standard to target multiple PowerShell versions with a single published DLL have two options:</span></span>

1. <span data-ttu-id="cbfba-167">Публикация сборки, созданной для целевой среды выполнения `net461`.</span><span class="sxs-lookup"><span data-stu-id="cbfba-167">Publishing an assembly built for the `net461` target runtime.</span></span> <span data-ttu-id="cbfba-168">Сюда входит:</span><span class="sxs-lookup"><span data-stu-id="cbfba-168">This involves:</span></span>
   - <span data-ttu-id="cbfba-169">публикация проекта для среды выполнения `net461`;</span><span class="sxs-lookup"><span data-stu-id="cbfba-169">Publishing the project for the `net461` runtime</span></span>
   - <span data-ttu-id="cbfba-170">компиляция в среде выполнения `netstandard2.0` (без использования выходных данных сборки), чтобы все используемые API также существовали в .NET Core.</span><span class="sxs-lookup"><span data-stu-id="cbfba-170">Also compiling against the `netstandard2.0` runtime (without using its build output) to ensure that all APIs used are also present in .NET Core.</span></span>

1. <span data-ttu-id="cbfba-171">Публикация сборки, созданной для целевой среды выполнения `netstandard2.0`.</span><span class="sxs-lookup"><span data-stu-id="cbfba-171">Publishing an assembly build for the `netstandard2.0` target runtime.</span></span> <span data-ttu-id="cbfba-172">Для этого требуется:</span><span class="sxs-lookup"><span data-stu-id="cbfba-172">This requires:</span></span>
   - <span data-ttu-id="cbfba-173">публикация проекта для среды выполнения `netstandard2.0`;</span><span class="sxs-lookup"><span data-stu-id="cbfba-173">Publishing the project for the `netstandard2.0` runtime</span></span>
   - <span data-ttu-id="cbfba-174">получение зависимостей `net461` NETStandard.Library и копирование их в расположение публикации сборки, чтобы исправлять сборку с учетом перенаправления типов в .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cbfba-174">Taking the `net461` dependencies of NETStandard.Library and copying them into the project assembly's publish location so that the assembly is type-forwarded corrected in .NET Framework.</span></span>

<span data-ttu-id="cbfba-175">Для создания модулей или библиотек PowerShell, предназначенных для более ранних версий .NET Framework, лучше выбрать несколько сред выполнения .NET.</span><span class="sxs-lookup"><span data-stu-id="cbfba-175">To build PowerShell modules or libraries targeting older .NET Framework versions, it may be preferable to target multiple .NET runtimes.</span></span> <span data-ttu-id="cbfba-176">При этом будет опубликована сборка для каждой целевой среды выполнения и во время загрузки модуля нужно будет загрузить подходящую сборку (например, с небольшим PSM1-файлом в качестве корневого модуля).</span><span class="sxs-lookup"><span data-stu-id="cbfba-176">This will publish an assembly for each target runtime, and the correct assembly will need to be loaded at module load time (for example with a small psm1 as the root module).</span></span>

### <a name="testing-powershell-standard-projects-in-net"></a><span data-ttu-id="cbfba-177">Тестирование проектов PowerShell Standard в .NET</span><span class="sxs-lookup"><span data-stu-id="cbfba-177">Testing PowerShell Standard projects in .NET</span></span>

<span data-ttu-id="cbfba-178">При тестировании модуля в средствах выполнения тестов .NET, таких как xUnit, помните, что проверки времени компиляции имеют ограничения.</span><span class="sxs-lookup"><span data-stu-id="cbfba-178">When it comes to testing your module in .NET test runners like xUnit, remember that compile-time checks can only go so far.</span></span> <span data-ttu-id="cbfba-179">Модуль необходимо протестировать на соответствующих платформах PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-179">You must test your module against the relevant PowerShell platforms.</span></span>

<span data-ttu-id="cbfba-180">Для тестирования API, созданных на основе PowerShell Standard в .NET, следует добавить `Microsoft.Powershell.SDK` как зависимость тестирования с .NET Core (с набором версий, соответствующим нужной версии PowerShell), и соответствующие базовые сборки Windows PowerShell с .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cbfba-180">To test APIs built against PowerShell Standard in .NET, you should add `Microsoft.Powershell.SDK` as a testing dependency with .NET Core (with the version set to match the desired PowerShell version), and the appropriate Windows PowerShell reference assemblies with .NET Framework.</span></span>

<span data-ttu-id="cbfba-181">Дополнительные сведения о PowerShell Standard и его использовании для написания двоичного модуля, работающего в нескольких версиях PowerShell, см. в [этой записи блога][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-181">For more information on PowerShell Standard and using it to write a binary module that works in multiple PowerShell versions, see [this blog post][].</span></span> <span data-ttu-id="cbfba-182">См. также раздел [репозиторий PowerShell Standard][] на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="cbfba-182">Also see the [PowerShell Standard repository][] on GitHub.</span></span>

## <a name="microsoftpowershellsdk"></a><span data-ttu-id="cbfba-183">Microsoft.PowerShell.SDK</span><span class="sxs-lookup"><span data-stu-id="cbfba-183">Microsoft.PowerShell.SDK</span></span>

<span data-ttu-id="cbfba-184">`Microsoft.PowerShell.SDK` — это метапакет, который объединяет все компоненты пакета SDK PowerShell в один пакет NuGet.</span><span class="sxs-lookup"><span data-stu-id="cbfba-184">`Microsoft.PowerShell.SDK` is a meta-package that pulls together all of the components of the PowerShell SDK into a single NuGet package.</span></span> <span data-ttu-id="cbfba-185">Автономное приложение .NET может использовать Microsoft.PowerShell.SDK для запуска произвольных функций PowerShell, не завися от внешних установок или библиотек PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-185">A self-contained .NET application can use Microsoft.PowerShell.SDK to run arbitrary PowerShell functionality without depending on any external PowerShell installations or libraries.</span></span>

> [!NOTE]
> <span data-ttu-id="cbfba-186">Пакет SDK PowerShell ссылается на все пакеты компонентов, которые составляют PowerShell и которые можно использовать для разработки в .NET с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-186">The PowerShell SDK just refers to all the component packages that make up PowerShell, and which can be used for .NET development with PowerShell.</span></span>

<span data-ttu-id="cbfba-187">Заданная версия `Microsoft.Powershell.SDK` содержит конкретную реализацию той же версии приложения PowerShell. Версия 7.0 содержит реализацию PowerShell 7.0, и выполнение команд или скриптов в этой версии будет во многом аналогично их выполнению в PowerShell 7.0.</span><span class="sxs-lookup"><span data-stu-id="cbfba-187">A given `Microsoft.Powershell.SDK` version contains the concrete implementation of the same version of the PowerShell application; version 7.0 contains the implementation of PowerShell 7.0 and running commands or scripts with it will largely behave like running them in PowerShell 7.0.</span></span>

<span data-ttu-id="cbfba-188">Выполнение команд PowerShell из пакета SDK происходит почти так же, как и в `pwsh`, с небольшими отличиями.</span><span class="sxs-lookup"><span data-stu-id="cbfba-188">Running PowerShell commands from the SDK is mostly, but not totally, the same as running them from `pwsh`.</span></span> <span data-ttu-id="cbfba-189">Например, [Start-Job][] в данный момент зависит от исполняемого файла `pwsh` и не будет работать с `Microsoft.Powershell.SDK` по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="cbfba-189">For example, [Start-Job][] currently depends on the `pwsh` executable being available, and so will not work with `Microsoft.Powershell.SDK` by default.</span></span>

<span data-ttu-id="cbfba-190">Нацеливание на `Microsoft.Powershell.SDK` из приложения .NET позволяет обеспечить интеграцию со всеми сборками реализации PowerShell, такими как `System.Management.Automation`, `Microsoft.PowerShell.Management` и другие сборки модулей.</span><span class="sxs-lookup"><span data-stu-id="cbfba-190">Targeting `Microsoft.Powershell.SDK` from a .NET application allows you to integrate with all of PowerShell's implementation assemblies, such as `System.Management.Automation`, `Microsoft.PowerShell.Management`, and other module assemblies.</span></span>

<span data-ttu-id="cbfba-191">При публикации приложения, нацеленного на `Microsoft.Powershell.SDK`, будут включены все эти сборки, а также все зависимости, необходимые для PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-191">Publishing an application targeting `Microsoft.Powershell.SDK` will include all these assemblies, and any dependencies PowerShell requires.</span></span> <span data-ttu-id="cbfba-192">Также будут включены другие ресурсы, требуемые для сборки PowerShell, такие как манифесты модулей для модулей `Microsoft.PowerShell.*` и каталог `ref`, необходимый для [Add-Type][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-192">It will also include other assets that PowerShell required in its build, such as the module manifests for `Microsoft.PowerShell.*` modules and the `ref` directory required by [Add-Type][].</span></span>

<span data-ttu-id="cbfba-193">Учитывая полноту пакета `Microsoft.Powershell.SDK`, он лучше всего подходит для следующих целей.</span><span class="sxs-lookup"><span data-stu-id="cbfba-193">Given the completeness of `Microsoft.Powershell.SDK`, it's best suited for:</span></span>

- <span data-ttu-id="cbfba-194">Реализация узлов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-194">Implementation of PowerShell hosts.</span></span>
- <span data-ttu-id="cbfba-195">Тестирование xUnit для библиотек, предназначенных для базовых сборок PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-195">xUnit testing of libraries targeting PowerShell reference assemblies.</span></span>
- <span data-ttu-id="cbfba-196">Вызов PowerShell в процессе из приложения .NET.</span><span class="sxs-lookup"><span data-stu-id="cbfba-196">Invoking PowerShell in-process from a .NET application.</span></span>

<span data-ttu-id="cbfba-197">`Microsoft.PowerShell.SDK` также может использоваться как базовый целевой объект, если проект .NET предназначен для использования в качестве модуля или иным образом загружается PowerShell, но зависит от API, имеющихся только в определенной версии PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-197">`Microsoft.PowerShell.SDK` may also be used as a reference target when a .NET project is intended to be used as a module or otherwise loaded by PowerShell, but depends on APIs only present in a particular version of PowerShell.</span></span> <span data-ttu-id="cbfba-198">Обратите внимание, что сборку, опубликованную для конкретной версии `Microsoft.PowerShell.SDK`, можно безопасно загружать и использовать только в этой версии PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-198">Note that an assembly published against a specific version of `Microsoft.PowerShell.SDK` will only be safe to load and use in that version of PowerShell.</span></span> <span data-ttu-id="cbfba-199">Чтобы использовать несколько версий PowerShell с конкретными API, требуется несколько сборок, каждая из которых нацелена на собственную версию `Microsoft.Powershell.SDK`.</span><span class="sxs-lookup"><span data-stu-id="cbfba-199">To target multiple PowerShell versions with specific APIs, multiple builds are required, each targeting their own version of `Microsoft.Powershell.SDK`.</span></span>

> [!NOTE]
> <span data-ttu-id="cbfba-200">Пакет SDK PowerShell доступен только для PowerShell версии 6 и выше.</span><span class="sxs-lookup"><span data-stu-id="cbfba-200">The PowerShell SDK is only available for PowerShell versions 6 and up.</span></span> <span data-ttu-id="cbfba-201">Чтобы обеспечить эквивалентную функциональность в Windows PowerShell, используйте базовые сборки Windows PowerShell, описанные ниже.</span><span class="sxs-lookup"><span data-stu-id="cbfba-201">To provide equivalent functionality with Windows PowerShell, use the Windows PowerShell reference assemblies described below.</span></span>

## <a name="systemmanagementautomation"></a><span data-ttu-id="cbfba-202">System.Management.Automation</span><span class="sxs-lookup"><span data-stu-id="cbfba-202">System.Management.Automation</span></span>

<span data-ttu-id="cbfba-203">Пакет `System.Management.Automation` является основой пакета SDK для PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-203">The `System.Management.Automation` package is the heart of the PowerShell SDK.</span></span> <span data-ttu-id="cbfba-204">Он существует в NuGet в основном в качестве ресурса для `Microsoft.Powershell.SDK`.</span><span class="sxs-lookup"><span data-stu-id="cbfba-204">It exists on NuGet, primarily, as an asset for `Microsoft.Powershell.SDK` to pull in.</span></span> <span data-ttu-id="cbfba-205">Однако его также можно использовать непосредственно в качестве пакета для небольших сценариев размещения и модулей для конкретных версий.</span><span class="sxs-lookup"><span data-stu-id="cbfba-205">However, it can also be used directly as a package for smaller hosting scenarios and version-targeting modules.</span></span>

<span data-ttu-id="cbfba-206">В частности, пакет `System.Management.Automation` может быть предпочтительным источником функций PowerShell в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="cbfba-206">Specifically, the `System.Management.Automation` package may be a preferable provider of PowerShell functionality when:</span></span>

- <span data-ttu-id="cbfba-207">Вы хотите использовать только функции языка PowerShell (в пространстве имен `System.Management.Automation.Language`), такие как средства синтаксического анализа PowerShell, AST и API посетителя AST (например, для статического анализа PowerShell).</span><span class="sxs-lookup"><span data-stu-id="cbfba-207">You're only looking to use PowerShell language functionality (in the `System.Management.Automation.Language` namespace) like the PowerShell parser, AST, and AST visitor APIs (for example for static analysis of PowerShell).</span></span>
- <span data-ttu-id="cbfba-208">Вам нужно выполнить только определенные команды из модуля `Microsoft.PowerShell.Core` и вы можете выполнять их в состоянии сеанса, созданного с помощью фабричного метода [CreateDefault2][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-208">You only wish to execute specific commands from the `Microsoft.PowerShell.Core` module and can execute them in a session state created with the [CreateDefault2][] factory method.</span></span>

<span data-ttu-id="cbfba-209">Кроме того, `System.Management.Automation` полезно использовать в качестве базовой сборки в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="cbfba-209">Additionally, `System.Management.Automation` is a useful reference assembly when:</span></span>

- <span data-ttu-id="cbfba-210">Вы хотите ориентироваться на API, которые находятся только в определенной версии PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-210">You wish to target APIs that are only present within a specific PowerShell version</span></span>
- <span data-ttu-id="cbfba-211">Вы не будете зависеть от типов вне сборки `System.Management.Automation` (например, типов, экспортированных командлетами в модули `Microsoft.PowerShell.*`).</span><span class="sxs-lookup"><span data-stu-id="cbfba-211">You won't be depending on types occurring outside the `System.Management.Automation` assembly (for example, types exported by cmdlets in `Microsoft.PowerShell.*` modules).</span></span>

## <a name="windows-powershell-reference-assemblies"></a><span data-ttu-id="cbfba-212">Базовые сборки Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="cbfba-212">Windows PowerShell reference assemblies</span></span>

<span data-ttu-id="cbfba-213">Для PowerShell версии 5.1 и более ранних версий (Windows PowerShell) пакет SDK для реализации PowerShell отсутствует, так как реализация Windows PowerShell является частью Windows.</span><span class="sxs-lookup"><span data-stu-id="cbfba-213">For PowerShell versions 5.1 and older (Windows PowerShell), there is no SDK to provide an implementation of PowerShell, since Windows PowerShell's implementation is a part of Windows.</span></span>

<span data-ttu-id="cbfba-214">Вместо этого базовые сборки Windows PowerShell предоставляют ссылки на базовые целевые объекты и способ повторного размещения Windows PowerShell, выполняя те же задачи, что и пакет SDK для PowerShell в версиях 6 и более поздних.</span><span class="sxs-lookup"><span data-stu-id="cbfba-214">Instead, the Windows PowerShell reference assemblies provide both reference targets and a way to rehost Windows PowerShell, acting the same as the PowerShell SDK does for versions 6 and up.</span></span>

<span data-ttu-id="cbfba-215">Базовые сборки Windows PowerShell не различаются по версиям, но имеют разные пакеты для каждой версии Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-215">Rather than being differentiated by version, Windows PowerShell reference assemblies have a different package for each version of Windows PowerShell:</span></span>

- [<span data-ttu-id="cbfba-216">PowerShell 5.1</span><span class="sxs-lookup"><span data-stu-id="cbfba-216">PowerShell 5.1</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.5.ReferenceAssemblies/)
- [<span data-ttu-id="cbfba-217">PowerShell 4</span><span class="sxs-lookup"><span data-stu-id="cbfba-217">PowerShell 4</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.4.ReferenceAssemblies/)
- [<span data-ttu-id="cbfba-218">PowerShell 3</span><span class="sxs-lookup"><span data-stu-id="cbfba-218">PowerShell 3</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.3.ReferenceAssemblies/)

<span data-ttu-id="cbfba-219">Сведения о том, как использовать базовые сборки Windows PowerShell, можно найти в разделе о [пакете SDK Windows PowerShell][].</span><span class="sxs-lookup"><span data-stu-id="cbfba-219">Information on how to use the Windows PowerShell reference assemblies can be found in the [Windows PowerShell SDK][].</span></span>

## <a name="real-world-examples-using-these-nuget-packages"></a><span data-ttu-id="cbfba-220">Реальные примеры использования пакетов NuGet</span><span class="sxs-lookup"><span data-stu-id="cbfba-220">Real-world examples using these NuGet packages</span></span>

<span data-ttu-id="cbfba-221">Различные проекты инструментов PowerShell предназначены для различных пакетов NuGet PowerShell в зависимости от их потребностей.</span><span class="sxs-lookup"><span data-stu-id="cbfba-221">Different PowerShell tooling projects target different PowerShell NuGet packages depending on their needs.</span></span> <span data-ttu-id="cbfba-222">Ниже приведены некоторые основные примеры.</span><span class="sxs-lookup"><span data-stu-id="cbfba-222">Listed here are some notable examples.</span></span>

### <a name="psreadline"></a><span data-ttu-id="cbfba-223">PSReadLine</span><span class="sxs-lookup"><span data-stu-id="cbfba-223">PSReadLine</span></span>

<span data-ttu-id="cbfba-224">[PSReadLine][] — модуль PowerShell, который предоставляет большую часть возможностей консоли PowerShell, ориентирован на PowerShell Standard в качестве зависимости, а не определенной версии PowerShell, а в его файле [CSPROJ][] указана среда выполнения .NET `net461`.</span><span class="sxs-lookup"><span data-stu-id="cbfba-224">[PSReadLine][], the PowerShell module that provides much of PowerShell's rich console experience, targets PowerShell Standard as a dependency rather than a specific PowerShell version, and targets the `net461` .NET runtime in its [csproj][].</span></span>

<span data-ttu-id="cbfba-225">PowerShell 6+ предоставляет собственные сборки оболочек совместимости, благодаря которым библиотека DLL, предназначенная для среды выполнения `net461`, работает без настройки при загрузке (путем перенаправления привязки к .`mscorlib.dll` NET Framework в соответствующую сборку .NET Core).</span><span class="sxs-lookup"><span data-stu-id="cbfba-225">PowerShell 6+ supplies its own shim assemblies that allow a DLL targeting the `net461` runtime to "just work" when loaded in (by redirecting binding to .NET Framework's `mscorlib.dll` to the relevant .NET Core assembly).</span></span>

<span data-ttu-id="cbfba-226">Это значительно упрощает макет и доставку модулей PSReadLine, так как PowerShell Standard гарантирует, что только используемые API будут присутствовать как в PowerShell 5.1, так и в PowerShell 6 и более поздних версий, а модуль будет поставлять только одну сборку.</span><span class="sxs-lookup"><span data-stu-id="cbfba-226">This simplifies PSReadLine's module layout and delivery significantly, since PowerShell Standard ensures the only APIs used will be present in both PowerShell 5.1 and PowerShell 6+, while also allowing the module to ship with only a single assembly.</span></span>

<span data-ttu-id="cbfba-227">Но при выборе .NET 4.6.1 в качестве целевой платформы Windows PowerShell на .NET 4.5.2 и .NET 4.6 не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="cbfba-227">The .NET 4.6.1 target does mean that Windows PowerShell running on .NET 4.5.2 and .NET 4.6 is not supported though.</span></span>

### <a name="powershell-editor-services"></a><span data-ttu-id="cbfba-228">Службы редактора PowerShell</span><span class="sxs-lookup"><span data-stu-id="cbfba-228">PowerShell Editor Services</span></span>

<span data-ttu-id="cbfba-229">[Службы редактора PowerShell][] (PSES) — это серверная часть для [расширения PowerShell][] для [Visual Studio Code][] и, по сути, представляет собой модуль PowerShell, который загружается исполняемым файлом PowerShell, а затем берет контроль над процессом для повторного размещения PowerShell внутри себя, при этом предоставляя возможности протокола языковой службы и адаптера отладки.</span><span class="sxs-lookup"><span data-stu-id="cbfba-229">[PowerShell Editor Services][] (PSES) is the backend for the [PowerShell extension][] for [Visual Studio Code][], and is actually a form of PowerShell module that gets loaded by a PowerShell executable and then takes over that process to rehost PowerShell within itself while also providing Language Service Protocol and Debug Adapter features.</span></span>

<span data-ttu-id="cbfba-230">PSES предоставляет конкретные целевые объекты реализации для `netcoreapp2.1`, чтобы выбрать PowerShell 6+ в качестве целевой платформы (так как среда выполнения `netcoreapp3.1` PowerShell 7 имеет обратную совместимость), и `net461` для Windows PowerShell 5.1, но содержит большую часть логики во второй сборке, ориентированной на `netstandard2.0` и PowerShell Standard.</span><span class="sxs-lookup"><span data-stu-id="cbfba-230">PSES provides concrete implementation targets for `netcoreapp2.1` to target PowerShell 6+ (since PowerShell 7's `netcoreapp3.1` runtime is backwards compatible) and `net461` to target Windows PowerShell 5.1, but contains most of its logic in a second assembly that targets `netstandard2.0` and PowerShell Standard.</span></span> <span data-ttu-id="cbfba-231">Это позволяет извлекать зависимости, необходимые для платформ .NET Core и .NET Framework, при этом упростить большую часть базы кода, скрывая ее за единообразной абстракцией.</span><span class="sxs-lookup"><span data-stu-id="cbfba-231">This allows it to pull in dependencies required for .NET Core and .NET Framework platforms, while still simplifying most of the codebase behind a uniform abstraction.</span></span>

<span data-ttu-id="cbfba-232">Поскольку служба PSES создана на основе PowerShell Standard, для тестирования требуется реализация среды выполнения PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-232">Because it is built against PowerShell Standard, PSES requires a runtime implementation of PowerShell in order to be tested correctly.</span></span> <span data-ttu-id="cbfba-233">Для этого тесты [xUnit PSES][] используют `Microsoft.PowerShell.SDK` и `Microsoft.PowerShell.5.ReferenceAssemblies`, чтобы предоставить реализацию PowerShell в тестовой среде.</span><span class="sxs-lookup"><span data-stu-id="cbfba-233">To do this, [PSES's xUnit][] tests pull in `Microsoft.PowerShell.SDK` and `Microsoft.PowerShell.5.ReferenceAssemblies` in order to provide a PowerShell implementation in the test environment.</span></span>

<span data-ttu-id="cbfba-234">Как и в случае с PSReadLine, PSES не поддерживает .NET 4.6 и более ранних версий, но [выполняет проверку][] во время выполнения перед вызовом API, который может вызвать аварийное завершение в средах выполнения .NET Framework более ранней версии.</span><span class="sxs-lookup"><span data-stu-id="cbfba-234">As with PSReadLine, PSES cannot support .NET 4.6 and below, but it [performs a check][] at runtime before calling any of the APIs that could cause a crash on the lower .NET Framework runtimes.</span></span>

### <a name="psscriptanalyzer"></a><span data-ttu-id="cbfba-235">PSScriptAnalyzer</span><span class="sxs-lookup"><span data-stu-id="cbfba-235">PSScriptAnalyzer</span></span>

<span data-ttu-id="cbfba-236">[PSScriptAnalyzer][], анализатор кода для PowerShell, должен быть нацелен на синтаксические элементы, представленные только в определенных версиях PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-236">[PSScriptAnalyzer][], the linter for PowerShell, must target syntactic elements only introduced in certain versions of PowerShell.</span></span> <span data-ttu-id="cbfba-237">Поскольку распознавание этих синтаксических элементов выполняется путем реализации [AstVisitor2][], невозможно использовать PowerShell Standard, а также реализовать методы посетителей AST для новых синтаксисов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-237">Because recognition of these syntactic elements is accomplished by implementing an [AstVisitor2][], it's not possible to use PowerShellStandard and also implement AST visitor methods for newer PowerShell syntaxes.</span></span>

<span data-ttu-id="cbfba-238">Вместо этого PSScriptAnalyzer [ориентируется на каждую версию PowerShell][] в качестве конфигурации сборки и создает отдельную библиотеку DLL для каждой из них.</span><span class="sxs-lookup"><span data-stu-id="cbfba-238">Instead, PSScriptAnalyzer [targets each PowerShell version][] as a build configuration, and produces a separate DLL for each of them.</span></span> <span data-ttu-id="cbfba-239">Это увеличивает размер сборки и сложность, но дает следующие преимущества.</span><span class="sxs-lookup"><span data-stu-id="cbfba-239">This increases build size and complexity, but allows:</span></span>

- <span data-ttu-id="cbfba-240">Нацеливание на API для конкретной версии.</span><span class="sxs-lookup"><span data-stu-id="cbfba-240">Version-specific API targeting</span></span>
- <span data-ttu-id="cbfba-241">Функции, зависящие от версии, реализуются практически без затрат в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="cbfba-241">Version-specific functionality to be implemented with essentially no runtime cost</span></span>
- <span data-ttu-id="cbfba-242">Общая поддержка Windows PowerShell вплоть до .NET Framework 4.5.2.</span><span class="sxs-lookup"><span data-stu-id="cbfba-242">Total support for Windows PowerShell all the way down to .NET Framework 4.5.2</span></span>

## <a name="summary"></a><span data-ttu-id="cbfba-243">Сводка</span><span class="sxs-lookup"><span data-stu-id="cbfba-243">Summary</span></span>

<span data-ttu-id="cbfba-244">В этой статье мы рассмотрели и обсудили пакеты NuGet, доступные при реализации проекта .NET, который использует PowerShell, а также области их применения.</span><span class="sxs-lookup"><span data-stu-id="cbfba-244">In this article, we've listed and discussed the NuGet packages available to target when implementing a .NET project that uses PowerShell, and the reasons you might have for using one over another.</span></span>

<span data-ttu-id="cbfba-245">Если вы перешли сразу к сводке, ознакомьтесь со следующими рекомендациями.</span><span class="sxs-lookup"><span data-stu-id="cbfba-245">If you've skipped to the summary, some broad recommendations are:</span></span>

- <span data-ttu-id="cbfba-246">**Модули** PowerShell должны компилироваться в PowerShell Standard, если им требуются только API, общие для разных версий PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-246">PowerShell **modules** should compile against PowerShell Standard if they only require APIs common to different PowerShell versions.</span></span>
- <span data-ttu-id="cbfba-247">**Узлы и приложения** PowerShell, для которых требуется внутреннее выполнение PowerShell, должны ориентироваться на пакет SDK PowerShell для PowerShell 6+ или соответствующие базовые сборки Windows PowerShell для Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cbfba-247">PowerShell **hosts and applications** that need to run PowerShell internally should target the PowerShell SDK for PowerShell 6+ or the relevant Windows PowerShell reference assemblies for Windows PowerShell.</span></span>
- <span data-ttu-id="cbfba-248">Модули PowerShell, которым требуются **API для конкретных версий**, должны ориентироваться на пакет SDK PowerShell или базовые сборки Windows PowerShell для требуемых версий PowerShell, используя их в качестве базовых сборок (то есть не публикуя зависимости PowerShell).</span><span class="sxs-lookup"><span data-stu-id="cbfba-248">PowerShell modules that need **version-specific APIs** should target the PowerShell SDK or Windows PowerShell reference assemblies for the required PowerShell versions, using them as reference assemblies (that is, not publishing the PowerShell dependencies).</span></span>

<!--link references -->

[.NET Standard 2.0]: /dotnet/standard/net-standard
[.NET Standard 2.0]: /dotnet/standard/net-standard
[about_Modules]: /powershell/module/microsoft.powershell.core/about/about_modules
[Add-Type]: /powershell/module/microsoft.powershell.utility/add-type
[AstVisitor2]: /dotnet/api/system.management.automation.language.astvisitor2
[CmdletProvider]: /dotnet/api/system.management.automation.provider.cmdletprovider
[CreateDefault2]: /dotnet/api/system.management.automation.runspaces.initialsessionstate.createdefault2
[csproj]: https://github.com/PowerShell/PSReadLine/blob/master/PSReadLine/PSReadLine.csproj
[Microsoft.PowerShell.SDK]: https://www.nuget.org/packages/Microsoft.PowerShell.SDK/
[NETStandard.Library]: https://www.nuget.org/packages/NETStandard.Library/
[NuGet]: https://www.nuget.org/
[выполняет проверку]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[performs a check]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[Pester]: https://github.com/Pester/Pester
[Службы редактора PowerShell]: https://github.com/PowerShell/PowerShellEditorServices/
[PowerShell Editor Services]: https://github.com/PowerShell/PowerShellEditorServices/
[Расширение PowerShell]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[PowerShell extension]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[NuGet PowerShell]: https://www.nuget.org/packages/PowerShell/
[PowerShell NuGet]: https://www.nuget.org/packages/PowerShell/
[репозиторий PowerShell Standard]: https://github.com/PowerShell/PowerShellStandard
[PowerShell Standard repository]: https://github.com/PowerShell/PowerShellStandard
[PowerShellStandard.Library]: https://www.nuget.org/packages/PowerShellStandard.Library/
[PSCmdlet]: /dotnet/api/system.management.automation.pscmdlet
[PSES xUnit]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSES's xUnit]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSHost]: /dotnet/api/system.management.automation.host.pshost
[атрибут PrivateAssets]: /dotnet/core/tools/csproj#packagereference
[PrivateAssets attribute]: /dotnet/core/tools/csproj#packagereference
[PSReadLine]: https://github.com/PowerShell/PSReadLine
[PSScriptAnalyzer]: https://github.com/powershell/psscriptanalyzer
[базовые сборки]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[reference assemblies]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[Start-Job]: /powershell/module/microsoft.powershell.core/start-job
[System.Management.Automation]: https://www.nuget.org/packages/System.Management.Automation/
[ориентируется на каждую версию PowerShell]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[targets each PowerShell version]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[эту запись блога]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[this blog post]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[Visual Studio Code]: https://code.visualstudio.com/
[Пакет SDK для Windows PowerShell]: /powershell/scripting/developer/windows-powershell
[Windows PowerShell SDK]: /powershell/scripting/developer/windows-powershell
