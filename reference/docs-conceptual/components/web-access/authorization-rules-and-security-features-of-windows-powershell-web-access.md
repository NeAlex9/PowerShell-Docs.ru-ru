---
ms.date: 06/27/2017
keywords: powershell,командлет
title: Правила авторизации и средства безопасности Windows PowerShell Web Access
ms.openlocfilehash: c426b8cfb10829241ba244a5d840c91e1de9f66e
ms.sourcegitcommit: debd2b38fb8070a7357bf1a4bf9cc736f3702f31
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2019
ms.locfileid: "62058426"
---
# <a name="authorization-rules-and-security-features-of-windows-powershell-web-access"></a><span data-ttu-id="5da31-103">Правила авторизации и средства безопасности Windows PowerShell Web Access</span><span class="sxs-lookup"><span data-stu-id="5da31-103">Authorization Rules and Security Features of Windows PowerShell Web Access</span></span>

<span data-ttu-id="5da31-104">Обновлено: 24 июня 2013 г.</span><span class="sxs-lookup"><span data-stu-id="5da31-104">Updated: June 24, 2013</span></span>

<span data-ttu-id="5da31-105">Область применения: Windows Server 2012 R2, Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="5da31-105">Applies To: Windows Server 2012 R2, Windows Server 2012</span></span>

<span data-ttu-id="5da31-106">Windows PowerShell Web Access в Windows Server 2012 R2 и Windows Server 2012 имею ограничительную модель безопасности.</span><span class="sxs-lookup"><span data-stu-id="5da31-106">Windows PowerShell Web Access in Windows Server 2012 R2 and Windows Server 2012 has a restrictive security model.</span></span> <span data-ttu-id="5da31-107">Пользователям необходимо явно предоставить доступ, прежде чем они смогут входить в шлюз Windows PowerShell Web Access и использовать веб-консоль Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5da31-107">Users must explicitly be granted access before they can sign in to the Windows PowerShell Web Access gateway and use the web-based Windows PowerShell console.</span></span>

## <a name="configuring-authorization-rules-and-site-security"></a><span data-ttu-id="5da31-108">Настройка правил авторизации и безопасности сайта</span><span class="sxs-lookup"><span data-stu-id="5da31-108">Configuring authorization rules and site security</span></span>

<span data-ttu-id="5da31-109">После установки Windows PowerShell Web Access и настройки шлюза пользователи могут открывать страницу входа в браузере, но они не могут выполнить вход, пока администратор Windows PowerShell Web Access не предоставит им доступ в явном виде.</span><span class="sxs-lookup"><span data-stu-id="5da31-109">After Windows PowerShell Web Access is installed and the gateway is configured, users can open the sign-in page in a browser, but they cannot sign in until the Windows PowerShell Web Access administrator grants users access explicitly.</span></span> <span data-ttu-id="5da31-110">Управление доступом в Windows PowerShell Web Access осуществляется с помощью набора командлетов Windows PowerShell, описанных в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="5da31-110">'Windows PowerShell Web Access' access control is managed by using the set of Windows PowerShell cmdlets described in the following table.</span></span> <span data-ttu-id="5da31-111">Нет соответствующего графического пользовательского интерфейса для добавления правил авторизации или управления ими.</span><span class="sxs-lookup"><span data-stu-id="5da31-111">There is no comparable GUI for adding or managing authorization rules.</span></span>
<span data-ttu-id="5da31-112">См. раздел [Командлеты Windows PowerShell Web Access](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps).</span><span class="sxs-lookup"><span data-stu-id="5da31-112">See [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps).</span></span>

<span data-ttu-id="5da31-113">Администратор может определить `{0-n}` правил проверки подлинности для Windows PowerShell Web Access или не определять их.</span><span class="sxs-lookup"><span data-stu-id="5da31-113">Administrators can define `{0-n}` authentication rules for Windows PowerShell Web Access.</span></span> <span data-ttu-id="5da31-114">Безопасность по умолчанию является ограничивающей, а не разрешающей. Отсутствие правил проверки подлинности означает, что ни один пользователь не имеет доступа к чему-либо.</span><span class="sxs-lookup"><span data-stu-id="5da31-114">The default security is restrictive rather than permissive; zero authentication rules means no users have access to anything.</span></span>

<span data-ttu-id="5da31-115">Командлеты [Add-PswaAuthorizationRule](/powershell/module/powershellwebaccess/add-pswaauthorizationrule?view=winserver2012r2-ps) и [Test-PswaAuthorizationRule](/powershell/module/powershellwebaccess/test-pswaauthorizationrule?view=winserver2012r2-ps) в Windows Server 2012 R2 включают параметр Credential, который позволяет вам добавлять правила авторизации Windows PowerShell Web Access и тестировать их с удаленного компьютера или в активном сеансе Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-115">[Add-PswaAuthorizationRule](/powershell/module/powershellwebaccess/add-pswaauthorizationrule?view=winserver2012r2-ps) and [Test-PswaAuthorizationRule](/powershell/module/powershellwebaccess/test-pswaauthorizationrule?view=winserver2012r2-ps) in Windows Server 2012 R2 include a Credential parameter that allows you to add and test Windows PowerShell Web Access authorization rules from a remote computer, or from within an active Windows PowerShell Web Access session.</span></span> <span data-ttu-id="5da31-116">Как и при работе с другими командлетами Windows PowerShell, которые имеют параметр Credential, вы можете указать объект PSCredential в качестве значения этого параметра.</span><span class="sxs-lookup"><span data-stu-id="5da31-116">As with other Windows PowerShell cmdlets that have a Credential parameter, you can specify a PSCredential object as the value of the parameter.</span></span> <span data-ttu-id="5da31-117">Чтобы создать объект PSCredential, содержащий учетные данные, которые требуется передать на удаленный компьютер, выполните командлет [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential).</span><span class="sxs-lookup"><span data-stu-id="5da31-117">To create a PSCredential object that contains credentials you want to pass to a remote computer, run the [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) cmdlet.</span></span>

<span data-ttu-id="5da31-118">Правила проверки подлинности Windows PowerShell Web Access — это правила белого списка.</span><span class="sxs-lookup"><span data-stu-id="5da31-118">Windows PowerShell Web Access authentication rules are whitelist rules.</span></span> <span data-ttu-id="5da31-119">Каждое правило является определением разрешенных подключений между пользователями, целевыми компьютерами и конкретными [конфигурациями сеансов](/powershell/module/microsoft.powershell.core/about/about_session_configurations?view=powershell-5.1) Windows PowerShell (которые также называют конечными точками или _пространствами выполнения_) на указанных конечных компьютерах.</span><span class="sxs-lookup"><span data-stu-id="5da31-119">Each rule is a definition of an allowed connection between users, target computers, and particular Windows PowerShell [session configurations](/powershell/module/microsoft.powershell.core/about/about_session_configurations?view=powershell-5.1) (also referred to as endpoints or _runspaces_) on specified target computers.</span></span>
<span data-ttu-id="5da31-120">Понятие **пространств выполнения** рассматривается в статье, посвященной [началу использования пространств выполнения PowerShell](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)</span><span class="sxs-lookup"><span data-stu-id="5da31-120">For an explanation on **runspaces** see [Beginning Use of PowerShell Runspaces](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5da31-121">Для получения доступа пользователю требуется, чтобы удовлетворялось хотя бы одно правило.</span><span class="sxs-lookup"><span data-stu-id="5da31-121">A user needs only one rule to be true to get access.</span></span> <span data-ttu-id="5da31-122">Если пользователю предоставлен доступ с веб-консоли к одному компьютеру либо с полными языковыми правами, либо доступ только к командлетам удаленного управления Windows PowerShell, пользователь может войти (или перескочить) на другие компьютеры, подключенные к первому целевому компьютеру.</span><span class="sxs-lookup"><span data-stu-id="5da31-122">If a user is given access to one computer with either full language access or access only to Windows PowerShell remote management cmdlets, from the web-based console, the user can log on (or hop) to other computers that are connected to the first target computer.</span></span> <span data-ttu-id="5da31-123">Самым безопасным способом настройки Windows PowerShell Web Access является предоставление пользователям доступа только к ограниченным конфигурациям сеансов, в которых им разрешается выполнять только конкретные задачи, требующие удаленного выполнения.</span><span class="sxs-lookup"><span data-stu-id="5da31-123">The most secure way to configure Windows PowerShell Web Access is to allow users access only to constrained session configurations that allow them to accomplish specific tasks that they normally need to perform remotely.</span></span>

<span data-ttu-id="5da31-124">Командлеты, упоминаемые в разделе [Командлеты Windows PowerShell Web Access](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps), позволяют создать набор правил доступа, которые используются для авторизации пользователя, подключающегося к шлюзу Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-124">The cmdlets referenced in [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps) allow to create a set of access rules which are used to authorize a user on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="5da31-125">Правила отличаются от списков управления доступом на целевом компьютере и обеспечивают дополнительный уровень безопасности при доступе через Интернет.</span><span class="sxs-lookup"><span data-stu-id="5da31-125">The rules are different from the access control lists (ACLs) on the destination computer, and provide an additional layer of security for web access.</span></span> <span data-ttu-id="5da31-126">Дополнительные сведения о безопасности приводятся в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="5da31-126">More details about security are described in the following section.</span></span>

<span data-ttu-id="5da31-127">Если пользователи не могут пройти какой-либо из предшествующих уровней безопасности, они получают универсальное сообщение "отказ в доступе" в окнах своих браузеров.</span><span class="sxs-lookup"><span data-stu-id="5da31-127">If users cannot pass any of the preceding security layers, they receive a generic 'access denied' message in their browser windows.</span></span> <span data-ttu-id="5da31-128">Хотя подробные сведения о безопасности записываются в журнал на сервере шлюза, конечным пользователям не предоставляется информация о том, сколько уровней безопасности они прошли или на каком уровне был получен отказ на вход или авторизацию.</span><span class="sxs-lookup"><span data-stu-id="5da31-128">Although security details are logged on the gateway server, end users are not shown information about how many security layers they passed, or at which layer the sign-in or authentication failure occurred.</span></span>

<span data-ttu-id="5da31-129">Дополнительные сведения о настройке правил авторизации см. в разделе [Настройка правил авторизации](#configuring-authorization-rules-and-site-security) в этой статье.</span><span class="sxs-lookup"><span data-stu-id="5da31-129">For more information about configuring authorization rules, see [configuring authorization rules](#configuring-authorization-rules-and-site-security) in this topic.</span></span>

### <a name="security"></a><span data-ttu-id="5da31-130">Безопасность</span><span class="sxs-lookup"><span data-stu-id="5da31-130">Security</span></span>

<span data-ttu-id="5da31-131">В модели безопасности Windows PowerShell Web Access имеется четыре уровня между пользователем веб-консоли и целевым компьютером.</span><span class="sxs-lookup"><span data-stu-id="5da31-131">The Windows PowerShell Web Access security model has four layers between an end user of the web-based console, and a target computer.</span></span> <span data-ttu-id="5da31-132">Администраторы Windows PowerShell Web Access могут добавлять уровни безопасности с помощью дополнительной настройки в диспетчере служб IIS.</span><span class="sxs-lookup"><span data-stu-id="5da31-132">Windows PowerShell Web Access administrators can add security layers through additional configuration in the IIS Manager console.</span></span> <span data-ttu-id="5da31-133">Дополнительные сведения о настройке безопасности веб-сайтов в консоли диспетчера служб IIS см. в статье [Настройка безопасности веб-сервера (IIS 7)](https://technet.microsoft.com/library/cc731278).</span><span class="sxs-lookup"><span data-stu-id="5da31-133">For more information about securing websites in the IIS Manager console, see [Configure Web Server Security (IIS7)](https://technet.microsoft.com/library/cc731278).</span></span>

<span data-ttu-id="5da31-134">Дополнительные рекомендации для IIS и сведения о предотвращении атак типа "отказ в доступе" см. в статье [Рекомендации по предотвращению атак типа "отказ в доступе"](https://technet.microsoft.com/library/cc750213).</span><span class="sxs-lookup"><span data-stu-id="5da31-134">For more information about IIS best practices and preventing denial-of-service attacks, see [Best Practices for Preventing DoS/Denial of Service Attacks](https://technet.microsoft.com/library/cc750213).</span></span>
<span data-ttu-id="5da31-135">Администратор также может купить дополнительное розничное программное обеспечение для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="5da31-135">An administrator can also buy and install additional retail authentication software.</span></span>

<span data-ttu-id="5da31-136">В следующей таблице описаны четыре уровня безопасности между конечными пользователями и целевыми компьютерами.</span><span class="sxs-lookup"><span data-stu-id="5da31-136">The following table describes the four layers of security between end users and target computers.</span></span>

|<span data-ttu-id="5da31-137">Уровень</span><span class="sxs-lookup"><span data-stu-id="5da31-137">Level</span></span>|<span data-ttu-id="5da31-138">Уровень</span><span class="sxs-lookup"><span data-stu-id="5da31-138">Layer</span></span>|
|-|-|
|<span data-ttu-id="5da31-139">1</span><span class="sxs-lookup"><span data-stu-id="5da31-139">1</span></span>|[<span data-ttu-id="5da31-140">средства безопасности веб-сервера iis</span><span class="sxs-lookup"><span data-stu-id="5da31-140">iis web server security features</span></span>](#iis-web-server-security-features)|
|<span data-ttu-id="5da31-141">2</span><span class="sxs-lookup"><span data-stu-id="5da31-141">2</span></span>|[<span data-ttu-id="5da31-142">проверка подлинности шлюза windows powershell web access на основе форм</span><span class="sxs-lookup"><span data-stu-id="5da31-142">windows powershell web access forms-based gateway authentication</span></span>](#windows-powershell-web-access-forms-based-gateway-authentication)|
|<span data-ttu-id="5da31-143">3</span><span class="sxs-lookup"><span data-stu-id="5da31-143">3</span></span>|[<span data-ttu-id="5da31-144">правила авторизации windows powershell web access</span><span class="sxs-lookup"><span data-stu-id="5da31-144">windows powershell web access authorization rules</span></span>](#windows-powershell-web-access-authorization-rules)|
|<span data-ttu-id="5da31-145">4</span><span class="sxs-lookup"><span data-stu-id="5da31-145">4</span></span>|[<span data-ttu-id="5da31-146">проверка подлинности на целевом компьютере и правила авторизации</span><span class="sxs-lookup"><span data-stu-id="5da31-146">target authentication and authorization rules</span></span>](#target-authentication-and-authorization-rules)|

<span data-ttu-id="5da31-147">Подробные сведения о каждом уровне можно найти в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="5da31-147">Detailed information about each layer can be found under the following headings:</span></span>

#### <a name="iis-web-server-security-features"></a><span data-ttu-id="5da31-148">Средства безопасности веб-сервера IIS</span><span class="sxs-lookup"><span data-stu-id="5da31-148">IIS Web Server security features</span></span>

<span data-ttu-id="5da31-149">Пользователи Windows PowerShell Web Access всегда должны указывать имя пользователя и пароль для проверки подлинности своих учетных записей на шлюзе.</span><span class="sxs-lookup"><span data-stu-id="5da31-149">Windows PowerShell Web Access users must always provide a user name and password to authenticate their accounts on the gateway.</span></span> <span data-ttu-id="5da31-150">Тем не менее администраторы Windows PowerShell Web Access могут также включать или отключать дополнительную проверку подлинности сертификата клиента (см. раздел [Установка и использование Windows PowerShell Web Access](install-and-use-windows-powershell-web-access.md), в котором рассказывается о включении тестового сертификата и последующей настройке подлинного сертификата).</span><span class="sxs-lookup"><span data-stu-id="5da31-150">However, Windows PowerShell Web Access administrators can also turn optional client certificate authentication on or off, see [install and use windows powershell web access](install-and-use-windows-powershell-web-access.md) to enable a test certificate and, later, how to configure a genuine certificate).</span></span>

<span data-ttu-id="5da31-151">Дополнительный компонент сертификата клиента, который является частью конфигурации веб-сервера (IIS), требует, чтобы конечные пользователи имели действительный сертификат клиента в дополнение к имени пользователя и паролю.</span><span class="sxs-lookup"><span data-stu-id="5da31-151">The optional client certificate feature requires end users to have a valid client certificate, in addition to their user names and passwords, and is part of Web Server (IIS) configuration.</span></span> <span data-ttu-id="5da31-152">Когда уровень сертификата клиента включен, на странице входа Windows PowerShell Web Access выводится приглашение пользователям предоставить действительные сертификаты перед проверкой их учетных данных для входа.</span><span class="sxs-lookup"><span data-stu-id="5da31-152">When the client certificate layer is enabled, the Windows PowerShell Web Access sign-in page prompts users to provide valid certificates before their sign-in credentials are evaluated.</span></span> <span data-ttu-id="5da31-153">При проверке подлинности сертификата клиента автоматически проверяется наличие сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="5da31-153">Client certificate authentication automatically checks for the client certificate.</span></span> <span data-ttu-id="5da31-154">Если действительный сертификат не обнаружен, Windows PowerShell Web Access информирует пользователя о необходимости предоставить сертификат.</span><span class="sxs-lookup"><span data-stu-id="5da31-154">If a valid certificate is not found, Windows PowerShell Web Access informs users, so they can provide the certificate.</span></span> <span data-ttu-id="5da31-155">Если действительный сертификат клиента обнаружен, Windows PowerShell Web Access открывает страницу входа для ввода имени пользователя и пароля.</span><span class="sxs-lookup"><span data-stu-id="5da31-155">If a valid client certificate is found, Windows PowerShell Web Access opens the sign-in page for users to provide their user names and passwords.</span></span>

<span data-ttu-id="5da31-156">Это один из примеров дополнительных параметров безопасности, которые предоставляет веб-сервер IIS.</span><span class="sxs-lookup"><span data-stu-id="5da31-156">This is one example of additional security settings that are offered by IIS Web Server.</span></span> <span data-ttu-id="5da31-157">Дополнительные сведения о других средствах безопасности IIS см. в статье [Configure Web Server Security (IIS 7)](https://technet.microsoft.com/library/cc731278) (Настройка безопасности веб-сервера (IIS 7)).</span><span class="sxs-lookup"><span data-stu-id="5da31-157">For more information about other IIS security features, see [Configure Web Server Security (IIS 7)](https://technet.microsoft.com/library/cc731278).</span></span>

#### <a name="windows-powershell-web-access-forms-based-gateway-authentication"></a><span data-ttu-id="5da31-158">Проверка подлинности шлюза Windows PowerShell Web Access на основании форм</span><span class="sxs-lookup"><span data-stu-id="5da31-158">Windows PowerShell Web Access forms-based gateway authentication</span></span>

<span data-ttu-id="5da31-159">Страница входа Windows PowerShell Web Access требует указать набор учетных данных (имя пользователя и пароль) и предлагает возможность указать другие учетные данные для целевого компьютера.</span><span class="sxs-lookup"><span data-stu-id="5da31-159">The Windows PowerShell Web Access sign-in page requires a set of credentials (user name and password) and offers users the option of providing different credentials for the target computer.</span></span>
<span data-ttu-id="5da31-160">Если пользователь не предоставил дополнительные учетные данные, основные имя пользователя и пароль, использованные для подключения к шлюзу, также используются для подключения к целевому компьютеру.</span><span class="sxs-lookup"><span data-stu-id="5da31-160">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="5da31-161">Подлинность требуемых учетных данных проверяется на шлюзе Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-161">The required credentials are authenticated on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="5da31-162">Эти учетные данные должны представлять действительные учетные записи пользователей на локальном сервере шлюза Windows PowerShell Web Access или в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="5da31-162">These credentials must be valid user accounts on either the local Windows PowerShell Web Access gateway server, or in Active Directory.</span></span>

#### <a name="windows-powershell-web-access-authorization-rules"></a><span data-ttu-id="5da31-163">Правила авторизации Windows PowerShell Web Access</span><span class="sxs-lookup"><span data-stu-id="5da31-163">Windows PowerShell Web Access authorization rules</span></span>

<span data-ttu-id="5da31-164">После проверки подлинности пользователя на шлюзе Windows PowerShell Web Access проверяет правила авторизации, чтобы удостовериться, что у пользователя имеется доступ к целевому компьютеру.</span><span class="sxs-lookup"><span data-stu-id="5da31-164">After a user is authenticated at the gateway, Windows PowerShell Web Access checks authorization rules to verify if the user has access to the requested target computer.</span></span> <span data-ttu-id="5da31-165">После успешной авторизации учетные данные пользователя передаются на целевой компьютер.</span><span class="sxs-lookup"><span data-stu-id="5da31-165">After successful authorization, the user's credentials are passed along to the target computer.</span></span>

<span data-ttu-id="5da31-166">Эти правила проверяются только после проверки подлинности пользователя на шлюзе и перед проверкой подлинности пользователя на целевом компьютере.</span><span class="sxs-lookup"><span data-stu-id="5da31-166">These rules are evaluated only after a user has been authenticated by the gateway, and before a user can be authenticated on a target computer.</span></span>

#### <a name="target-authentication-and-authorization-rules"></a><span data-ttu-id="5da31-167">Проверка подлинности на целевом компьютере и правила авторизации</span><span class="sxs-lookup"><span data-stu-id="5da31-167">Target authentication and authorization rules</span></span>

<span data-ttu-id="5da31-168">Конечным уровнем безопасности Windows PowerShell Web Access является собственная конфигурация безопасности целевого компьютера.</span><span class="sxs-lookup"><span data-stu-id="5da31-168">The final layer of security for Windows PowerShell Web Access is the target computer's own security configuration.</span></span> <span data-ttu-id="5da31-169">Пользователи должны иметь достаточные права доступа, настроенные на целевом компьютере, а также в правилах авторизации Windows PowerShell Web Access, чтобы выполнять веб-консоль Windows PowerShell, которая взаимодействует с целевым компьютером через Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-169">Users must have the appropriate access rights configured on the target computer, and also in the Windows PowerShell Web Access authorization rules, to run a Windows PowerShell web-based console that affects a target computer through Windows PowerShell Web Access.</span></span>

<span data-ttu-id="5da31-170">Этот уровень обеспечивает такие же механизмы безопасности, как и при проверке попыток подключения, когда пользователь пытается создать удаленный сеанс Windows PowerShell с целевым компьютером из Windows PowerShell, выполняя командлет [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) или [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession).</span><span class="sxs-lookup"><span data-stu-id="5da31-170">This layer offers the same security mechanisms that would evaluate connection attempts if users tried to create a remote Windows PowerShell session to a target computer from within Windows PowerShell by running the [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) or [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) cmdlets.</span></span>

<span data-ttu-id="5da31-171">По умолчанию Windows PowerShell Web Access использует основное имя пользователя и пароль для проверки подлинности и на шлюзе, и на целевом компьютере.</span><span class="sxs-lookup"><span data-stu-id="5da31-171">By default, Windows PowerShell Web Access uses the primary user name and password for authentication on both the gateway and the target computer.</span></span> <span data-ttu-id="5da31-172">На веб-странице входа в разделе **Дополнительные параметры подключения** пользователям предлагается возможность указать другие учетные данные для целевого компьютера, если они требуются.</span><span class="sxs-lookup"><span data-stu-id="5da31-172">The web-based sign-in page, in a section titled **Optional connection settings**, offers users the option of providing different credentials for the target computer, if they are required.</span></span> <span data-ttu-id="5da31-173">Если пользователь не предоставил дополнительные учетные данные, основные имя пользователя и пароль, использованные для подключения к шлюзу, также используются для подключения к целевому компьютеру.</span><span class="sxs-lookup"><span data-stu-id="5da31-173">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="5da31-174">Правила авторизации можно использовать, чтобы разрешить доступ пользователей к конкретным конфигурациям сеанса.</span><span class="sxs-lookup"><span data-stu-id="5da31-174">Authorization rules can be used to allow users access to a particular session configuration.</span></span> <span data-ttu-id="5da31-175">Вы можете создать _ограниченные пространства выполнения_ или конфигурации сеансов для Windows PowerShell Web Access и разрешить конкретным пользователям подключаться только к определенным конфигурациям сеанса при входе в Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-175">You can create _restricted runspaces_ or session configurations for Windows PowerShell Web Access, and allow specific users to connect only to specific session configurations when they sign in to Windows PowerShell Web Access.</span></span> <span data-ttu-id="5da31-176">Можно использовать списки управления доступом, чтобы определить, какие пользователи имеют доступ к конкретным конечным точкам, и далее ограничить доступ к конечной точке с помощью правил авторизации, описанных в данном разделе.</span><span class="sxs-lookup"><span data-stu-id="5da31-176">You can use access control lists (ACLs) to determine which users have access to specific endpoints, and further restrict access to the endpoint for a specific set of users by using authorization rules described in this section.</span></span> <span data-ttu-id="5da31-177">Дополнительные сведения об ограничении доступа к пространствам выполнения см. в статье, посвященной [созданию ограниченных пространств выполнения](https://msdn.microsoft.com/library/dn614668).</span><span class="sxs-lookup"><span data-stu-id="5da31-177">For more information about restricted runspaces, see [Creating a constrained runspace](https://msdn.microsoft.com/library/dn614668).</span></span>

### <a name="configuring-authorization-rules"></a><span data-ttu-id="5da31-178">Настройка правил авторизации</span><span class="sxs-lookup"><span data-stu-id="5da31-178">Configuring authorization rules</span></span>

<span data-ttu-id="5da31-179">Администраторам, вероятно, могут потребоваться для пользователей Windows PowerShell Web Access такие же правила авторизации, как и те, что определены в их среде для удаленного управления Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5da31-179">Administrators likely want the same authorization rule for Windows PowerShell Web Access users that is already defined in their environment for Windows PowerShell remote management.</span></span> <span data-ttu-id="5da31-180">В первой процедуре в этом разделе описано, как добавить правило авторизации для безопасности, предоставляющее одному пользователю доступ и регистрацию для управления одним компьютером в пределах единственной конфигурации сеанса.</span><span class="sxs-lookup"><span data-stu-id="5da31-180">The first procedure in this section describes how to add a secure authorization rule that grants access to one user, signing in to manage one computer, and within a single session configuration.</span></span> <span data-ttu-id="5da31-181">Во второй процедуре описано, как удалить правило авторизации, которое больше не требуется.</span><span class="sxs-lookup"><span data-stu-id="5da31-181">The second procedure describes how to remove an authorization rule that is no longer needed.</span></span>

<span data-ttu-id="5da31-182">Если вы планируете использовать настраиваемые конфигурации сеансов, чтобы разрешить определенным пользователям работать только в ограниченных пространствах выполнения в Windows PowerShell Web Access, создайте эти конфигурации, прежде чем добавить правила авторизации, которые на них ссылаются.</span><span class="sxs-lookup"><span data-stu-id="5da31-182">If you plan to use custom session configurations to allow specific users to work only within restricted runspaces in Windows PowerShell Web Access, create your custom session configurations before you add authorization rules that refer to them.</span></span> <span data-ttu-id="5da31-183">Командлеты Windows PowerShell Web Access нельзя использовать для создания настраиваемых конфигураций сеансов.</span><span class="sxs-lookup"><span data-stu-id="5da31-183">You cannot use the Windows PowerShell Web Access cmdlets to create custom session configurations.</span></span> <span data-ttu-id="5da31-184">Дополнительные сведения о создании настраиваемых конфигураций сеансов см. в разделе [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span><span class="sxs-lookup"><span data-stu-id="5da31-184">For more information about creating custom session configurations, see [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

<span data-ttu-id="5da31-185">Командлеты Windows PowerShell Web Access поддерживают единственный подстановочный знак — звездочку (\*).</span><span class="sxs-lookup"><span data-stu-id="5da31-185">Windows PowerShell Web Access cmdlets support one wildcard character, an asterisk ( \* ).</span></span> <span data-ttu-id="5da31-186">Подстановочные знаки в строковых значениях не поддерживаются; используйте одну звездочку для свойства (пользователи, компьютеры или конфигурации сеанса).</span><span class="sxs-lookup"><span data-stu-id="5da31-186">Wildcard characters within strings are not supported; use a single asterisk per property (users, computers, or session configurations).</span></span>

> [!NOTE]
> <span data-ttu-id="5da31-187">Другие способы использования правил авторизации для предоставления доступа пользователям и обеспечения безопасности среды Windows PowerShell Web Access см. в разделе [Другие примеры сценария правил авторизации](#other-authorization-rule-scenario-examples) этой статьи.</span><span class="sxs-lookup"><span data-stu-id="5da31-187">For more ways you can use authorization rules to grant access to users and help secure the Windows PowerShell Web Access environment, see [other authorization rule scenario examples](#other-authorization-rule-scenario-examples) in this topic.</span></span>

#### <a name="to-add-a-restrictive-authorization-rule"></a><span data-ttu-id="5da31-188">Добавление ограничивающего правила авторизации</span><span class="sxs-lookup"><span data-stu-id="5da31-188">To add a restrictive authorization rule</span></span>

1. <span data-ttu-id="5da31-189">Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.</span><span class="sxs-lookup"><span data-stu-id="5da31-189">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="5da31-190">На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.</span><span class="sxs-lookup"><span data-stu-id="5da31-190">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>

   - <span data-ttu-id="5da31-191">На **начальном экране** Windows щелкните правой кнопкой мыши **Windows PowerShell**, а затем выберите команду **Запустить от имени администратора**.</span><span class="sxs-lookup"><span data-stu-id="5da31-191">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

2. <span data-ttu-id="5da31-192">**Необязательный шаг** для ограничения пользовательского доступа путем использования конфигураций сеансов:</span><span class="sxs-lookup"><span data-stu-id="5da31-192">**Optional step** For restricting user access by using session configurations:</span></span>

   <span data-ttu-id="5da31-193">убедитесь, что конфигурации сеансов, которые требуется использовать в правилах, уже существуют.</span><span class="sxs-lookup"><span data-stu-id="5da31-193">Verify that the session configurations that you want to use, already exist in your rules .</span></span>

   <span data-ttu-id="5da31-194">В противном случае выполните инструкции по созданию конфигураций сеансов, приведенные в статье [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span><span class="sxs-lookup"><span data-stu-id="5da31-194">If they have not yet been created, use instructions for creating session configurations in [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

3. <span data-ttu-id="5da31-195">Это правило авторизации разрешает конкретному пользователю доступ к одному сетевому компьютеру, к которому обычно требуется доступ, с доступом к конкретной конфигурации сеанса, область которого соответствует потребностям пользовательских сценариев и командлетов.</span><span class="sxs-lookup"><span data-stu-id="5da31-195">This authorization rule allows a specific user access to one computer on the network to which they typically have access, with access to a specific session configuration that is scoped to the user'™s typical scripting and cmdlet needs.</span></span> <span data-ttu-id="5da31-196">Введите следующую команду и нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="5da31-196">Type the following, and then press **Enter**.</span></span>

   ```
   Add-PswaAuthorizationRule -UserName <domain\user | computer\user> `
      -ComputerName <computer_name> -ConfigurationName <session_configuration_name>
   ```

   - <span data-ttu-id="5da31-197">В следующем примере пользователю с именем _JSmith_ в домене _Contoso_ предоставляется доступ для управления компьютером _Contoso\_214_ и использования конфигурации сеанса с именем _NewAdminsOnly_.</span><span class="sxs-lookup"><span data-stu-id="5da31-197">In the following example, a user named _JSmith_ in the _Contoso_ domain is granted access to manage the computer _Contoso_214_, and use a session configuration named _NewAdminsOnly_.</span></span>

   ```powershell
   Add-PswaAuthorizationRule -UserName 'Contoso\JSmith' `
      -ComputerName Contoso_214 -ConfigurationName NewAdminsOnly
   ```

4. <span data-ttu-id="5da31-198">Убедитесь, что правило создано путем выполнения командлета **Get-PswaAuthorizationRule** или `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>`.</span><span class="sxs-lookup"><span data-stu-id="5da31-198">Verify that the rule has been created by running either the **Get-PswaAuthorizationRule** cmdlet, or `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>`.</span></span>
   <span data-ttu-id="5da31-199">Например, `Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214`.</span><span class="sxs-lookup"><span data-stu-id="5da31-199">For example, `Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214`.</span></span>

#### <a name="to-remove-an-authorization-rule"></a><span data-ttu-id="5da31-200">Удаление правила авторизации</span><span class="sxs-lookup"><span data-stu-id="5da31-200">To remove an authorization rule</span></span>

1. <span data-ttu-id="5da31-201">Если сеанс Windows PowerShell еще не открыт, см. шаг 1 процедуры [Добавление ограничивающего правила авторизации](#to-add-a-restrictive-authorization-rule) в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="5da31-201">If a Windows PowerShell session is not already open, see step 1 of [to add a restrictive authorization rule](#to-add-a-restrictive-authorization-rule) in this section.</span></span>

2. <span data-ttu-id="5da31-202">Введите следующую команду и нажмите клавишу **ВВОД**, где *ИД правила* представляет уникальный идентификатор правила, которое требуется удалить.</span><span class="sxs-lookup"><span data-stu-id="5da31-202">Type the following, and then press **Enter**, where *rule ID* represents the unique ID number of the rule that you want to remove.</span></span>

   ```
   Remove-PswaAuthorizationRule -ID <rule ID>
   ```

   <span data-ttu-id="5da31-203">Если вы не знаете идентификатор, но знаете понятное имя удаляемого правила, вы можете получить имя правила и передать его в командлет `Remove-PswaAuthorizationRule` для удаления этого правила, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="5da31-203">Alternatively, if you do not know the ID number, but know the friendly name of the rule you want to remove, you can get the name of the rule, and pipe it to the `Remove-PswaAuthorizationRule` cmdlet to remove the rule, as shown in the following example:</span></span>

   ```
   Get-PswaAuthorizationRule `
      -RuleName <rule-name> | Remove-PswaAuthorizationRule
   ```

> [!NOTE]
> <span data-ttu-id="5da31-204">При попытке удалить указанное правило авторизации запрос на подтверждение удаления не выводится. Правило удаляется при нажатии клавиши **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="5da31-204">You are not prompted to confirm whether you want to delete the specified authorization rule; the rule is deleted when you press **Enter**.</span></span> <span data-ttu-id="5da31-205">Убедитесь, что действительно необходимо удалить правило авторизации, перед выполнением командлета `Remove-PswaAuthorizationRule`.</span><span class="sxs-lookup"><span data-stu-id="5da31-205">Be sure that you want to remove the authorization rule before running the `Remove-PswaAuthorizationRule` cmdlet.</span></span>

#### <a name="other-authorization-rule-scenario-examples"></a><span data-ttu-id="5da31-206">Другие примеры сценария правил авторизации</span><span class="sxs-lookup"><span data-stu-id="5da31-206">Other authorization rule scenario examples</span></span>

<span data-ttu-id="5da31-207">Каждый сеанс Windows PowerShell использует конфигурацию сеанса. Если конфигурация не указана, Windows PowerShell по умолчанию использует встроенную конфигурацию сеанса Windows PowerShell с именем Microsoft.PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5da31-207">Every Windows PowerShell session uses a session configuration; if one is not specified for a session, Windows PowerShell uses the default, built-in Windows PowerShell session configuration, called Microsoft.PowerShell.</span></span> <span data-ttu-id="5da31-208">Конфигурация сеанса по умолчанию включает все командлеты, доступные на компьютере.</span><span class="sxs-lookup"><span data-stu-id="5da31-208">The default session configuration includes all cmdlets that are available on a computer.</span></span> <span data-ttu-id="5da31-209">Администраторы могут ограничить доступ ко всем компьютерам, определив конфигурацию сеанса с ограниченным пространством выполнения (ограниченный набор командлетов и задач, которые могут выполнять конечные пользователи).</span><span class="sxs-lookup"><span data-stu-id="5da31-209">Administrators can restrict access to all computers by defining a session configuration with a restricted runspace (a limited range of cmdlets and tasks that their end users could perform).</span></span> <span data-ttu-id="5da31-210">Пользователь, которому к одному компьютеру предоставлен либо полный языковый доступ, либо доступ только на удаленное управление командлетами Windows PowerShell, может подключаться к другим компьютерам, подключенным к первому компьютеру.</span><span class="sxs-lookup"><span data-stu-id="5da31-210">A user who is granted access to one computer with either full language access or only the Windows PowerShell remote management cmdlets can connect to other computers that are connected to the first computer.</span></span> <span data-ttu-id="5da31-211">Определение ограниченного пространства выполнения может предотвратить доступ пользователей к другим компьютерам из разрешенного пространства выполнения Windows PowerShell. Это повышает безопасность среды Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-211">Defining a restricted runspace can prevent users from accessing other computers from their allowed Windows PowerShell runspace, and improves the security of your Windows PowerShell Web Access environment.</span></span> <span data-ttu-id="5da31-212">Конфигурацию сеанса можно распространить (с помощью групповой политики) на все компьютеры, которые администраторы хотят сделать доступными через Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-212">The session configuration can be distributed (by using Group Policy) to all computers that administrators want to make accessible through Windows PowerShell Web Access.</span></span> <span data-ttu-id="5da31-213">Дополнительные сведения о конфигурациях сеансов см. в разделе [about_Session_Configurations](https://technet.microsoft.com/library/dd819508.aspx).</span><span class="sxs-lookup"><span data-stu-id="5da31-213">For more information about session configurations, see [about_Session_Configurations](https://technet.microsoft.com/library/dd819508.aspx).</span></span> <span data-ttu-id="5da31-214">Ниже приводятся примеры такого сценария.</span><span class="sxs-lookup"><span data-stu-id="5da31-214">The following are some examples of this scenario.</span></span>

- <span data-ttu-id="5da31-215">Администратор создает конечную точку с именем **PswaEndpoint** с ограниченным пространством выполнения.</span><span class="sxs-lookup"><span data-stu-id="5da31-215">An administrator creates an endpoint, called **PswaEndpoint**, with a restricted runspace.</span></span> <span data-ttu-id="5da31-216">Затем администратор создает правило, `*,*,PswaEndpoint`, и распространяет конечную точку на все компьютеры.</span><span class="sxs-lookup"><span data-stu-id="5da31-216">Then, the administrator creates a rule, `*,*,PswaEndpoint`, and distributes the endpoint to other computers.</span></span> <span data-ttu-id="5da31-217">Правило разрешает всем пользователям доступ ко всем компьютерам с конечной точкой **PswaEndpoint**.</span><span class="sxs-lookup"><span data-stu-id="5da31-217">The rule allows all users to access all computers with the endpoint **PswaEndpoint**.</span></span>
  <span data-ttu-id="5da31-218">Если это правило авторизации является единственным в наборе правил, компьютеры без этой конечной точки будут недоступными.</span><span class="sxs-lookup"><span data-stu-id="5da31-218">If this is the only authorization rule defined in the rule set, computers without that endpoint would not be accessible.</span></span>

- <span data-ttu-id="5da31-219">Администратор создает конечную точку с именем **PswaEndpoint** и хочет ограничить доступ конкретными пользователями.</span><span class="sxs-lookup"><span data-stu-id="5da31-219">The administrator created an endpoint with a restricted runspace called **PswaEndpoint**,and wants to restrict access to specific users.</span></span> <span data-ttu-id="5da31-220">Администратор создает группу пользователей с именем **Level1Support** и определяет следующее правило: **Level1Support,\*,PswaEndpoint**.</span><span class="sxs-lookup"><span data-stu-id="5da31-220">The administrator creates a group of users called **Level1Support**, and defines the following rule: **Level1Support,\*,PswaEndpoint**.</span></span> <span data-ttu-id="5da31-221">Правило предоставляет всем пользователям из группы **Level1Support** доступ ко всем компьютерам с конфигурацией **PswaEndpoint**.</span><span class="sxs-lookup"><span data-stu-id="5da31-221">The rule grants any users in the group **Level1Support** access to all computers with the **PswaEndpoint** configuration.</span></span> <span data-ttu-id="5da31-222">Аналогичным образом доступ может быть ограничен конкретным набором компьютеров.</span><span class="sxs-lookup"><span data-stu-id="5da31-222">Similarly, access can be restricted to a specific set of computers.</span></span>

- <span data-ttu-id="5da31-223">Некоторые администраторы предоставляют одним пользователям больше прав доступа, чем другим.</span><span class="sxs-lookup"><span data-stu-id="5da31-223">Some administrators provide certain users more access than others.</span></span> <span data-ttu-id="5da31-224">Например, администратор создает две группы пользователей — **Admins** и **BasicSupport**.</span><span class="sxs-lookup"><span data-stu-id="5da31-224">For example, an administrator creates two user groups, **Admins** and **BasicSupport**.</span></span> <span data-ttu-id="5da31-225">Администратор также создает конечную точку с ограниченным пространством выполнения с именем **PswaEndpoint**, а затем определяет два следующих правила: **Admins,\*,\*** и **BasicSupport,\*,PswaEndpoint**.</span><span class="sxs-lookup"><span data-stu-id="5da31-225">The administrator also creates an endpoint with a restricted runspace called **PswaEndpoint**, and defines the following two rules: **Admins,\*,\*** and **BasicSupport,\*,PswaEndpoint**.</span></span> <span data-ttu-id="5da31-226">Первое правило предоставляет всем пользователям в группе **Admins** доступ ко всем компьютерам, а второе правило предоставляет всем пользователям в группе **BasicSupport** доступ только к компьютерам с **PswaEndpoint**.</span><span class="sxs-lookup"><span data-stu-id="5da31-226">The first rule provides all users in the **Admin** group access to all computers, and the second rule provides all users in the **BasicSupport** group access only to those computers with **PswaEndpoint**.</span></span>

- <span data-ttu-id="5da31-227">Администратор настроил частную тестовую среду и хочет разрешить всем авторизованным сетевым пользователям доступ ко всем компьютерам в сети, к которым они обычно имеют доступ, с доступом ко всем конфигурациям сеансов, к которым они обычно имеют доступ.</span><span class="sxs-lookup"><span data-stu-id="5da31-227">An administrator has set up a private test environment, and wants to allow all authorized network users access to all computers on the network to which they typically have access, with access to all session configurations to which they typically have access.</span></span> <span data-ttu-id="5da31-228">Поскольку это частная тестовая среда, администратор создает правило авторизации, которое не является безопасным.</span><span class="sxs-lookup"><span data-stu-id="5da31-228">Because this is a private test environment, the administrator creates an authorization rule that is not secure.</span></span> <span data-ttu-id="5da31-229">Администратор выполняет командлет `Add-PswaAuthorizationRule * * *`, в котором подстановочный знак **\*** используется, чтобы представлять всех пользователей, все компьютеры и все конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5da31-229">- The administrator runs the cmdlet `Add-PswaAuthorizationRule * * *`, which uses the wildcard character **\*** to represent all users, all computers, and all configurations.</span></span> <span data-ttu-id="5da31-230">Это правило эквивалентно следующему: `Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`.</span><span class="sxs-lookup"><span data-stu-id="5da31-230">- This rule is the equivalent of the following: `Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`.</span></span>

  > [!NOTE]
  > <span data-ttu-id="5da31-231">Это правило не рекомендуется к использованию в безопасной среде. В нем обходится уровень безопасности, предоставляемый Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-231">This rule is not recommended in a secure environment, and bypasses the authorization rule layer of security provided by Windows PowerShell Web Access.</span></span>

- <span data-ttu-id="5da31-232">Администратор должен разрешить пользователям подключаться к конечным компьютерам в среде, включающей и рабочие группы, и домены, где компьютеры рабочей группы иногда используются для подключения к конечным компьютерам в доменах, а компьютеры в доменах иногда используются для подключения к конечным компьютерам в рабочих группах.</span><span class="sxs-lookup"><span data-stu-id="5da31-232">An administrator must allow users to connect to target computers in an environment that includes both workgroups and domains, where workgroup computers are occasionally used to connect to target computers in domains, and computers in domains are occasionally used to connect to target computers in workgroups.</span></span> <span data-ttu-id="5da31-233">У администратора есть сервер шлюза *PswaServer* в рабочей группе, а конечный компьютер *srv1.contoso.com* находится в домене.</span><span class="sxs-lookup"><span data-stu-id="5da31-233">The administrator has a gateway server, *PswaServer*, in a workgroup; and target computer *srv1.contoso.com* is in a domain.</span></span> <span data-ttu-id="5da31-234">Пользователь *Олег* зарегистрирован как авторизованный локальный пользователь на сервере шлюза в рабочей группе и на конечном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5da31-234">User *Chris* is an authorized local user on both the workgroup gateway server and the target computer.</span></span> <span data-ttu-id="5da31-235">Его имя пользователя на сервере рабочей группы — *chrisLocal*, а на конечном компьютере — *contoso\\chris*.</span><span class="sxs-lookup"><span data-stu-id="5da31-235">His user name on the workgroup server is *chrisLocal*; and his user name on the target computer is *contoso\\chris*.</span></span> <span data-ttu-id="5da31-236">Чтобы разрешить Олегу доступ к srv1.contoso.com, администратор добавляет следующее правило.</span><span class="sxs-lookup"><span data-stu-id="5da31-236">To authorize access to srv1.contoso.com for Chris, the administrator adds the following rule.</span></span>

```powershell
Add-PswaAuthorizationRule -userName PswaServer\chrisLocal `
   -computerName srv1.contoso.com -configurationName Microsoft.PowerShell
```

<span data-ttu-id="5da31-237">В предыдущем примере правила выполняется проверка подлинности учетной записи Олега на сервере шлюза, а затем авторизация его доступа к *srv1*.</span><span class="sxs-lookup"><span data-stu-id="5da31-237">The preceding rule example authenticates Chris on the gateway server, and then authorizes his access to *srv1*.</span></span> <span data-ttu-id="5da31-238">На странице входа Chris должен предоставить второй набор учетных данных в разделе **Дополнительные параметры подключения** (*contoso\\chris*).</span><span class="sxs-lookup"><span data-stu-id="5da31-238">On the sign-in page, Chris must provide a second set of credentials in the **Optional connection settings** area (*contoso\\chris*).</span></span> <span data-ttu-id="5da31-239">Сервер шлюза использует дополнительный набор учетных данных для проверки подлинности учетной записи Chris на конечном компьютере *srv1.contoso.com*.</span><span class="sxs-lookup"><span data-stu-id="5da31-239">The gateway server uses the additional set of credentials to authenticate him on the target computer, *srv1.contoso.com*.</span></span>

<span data-ttu-id="5da31-240">В предыдущем сценарии Windows PowerShell Web Access устанавливает подключение к конечному компьютеру, только если указанные ниже действия успешно выполнены и разрешены по крайней мере одним правилом авторизации.</span><span class="sxs-lookup"><span data-stu-id="5da31-240">In the preceding scenario, Windows PowerShell Web Access establishes a successful connection to the target computer only after the following have been successful, and allowed by at least one authorization rule.</span></span>

1. <span data-ttu-id="5da31-241">Проверка подлинности на сервере шлюза рабочей группы путем добавления имени пользователя в формате *имя_сервера*\\*имя_пользователя* в правило авторизации.</span><span class="sxs-lookup"><span data-stu-id="5da31-241">Authentication on the workgroup gateway server by adding a user name in the format *server_name*\\*user_name* to the authorization rule</span></span>

2. <span data-ttu-id="5da31-242">Проверка подлинности на конечном компьютере при помощи альтернативных учетных данных, введенных на странице входа, в разделе **Дополнительные параметры подключения**.</span><span class="sxs-lookup"><span data-stu-id="5da31-242">Authentication on the target computer by using alternate credentials provided on the sign-in page, in the **Optional connection settings** area</span></span>

   > [!NOTE]
   > <span data-ttu-id="5da31-243">Если шлюз и конечные компьютеры находятся в разных рабочих группах или доменах, то должно быть установлено отношение доверия между двумя компьютерами рабочей группы, между двумя доменами или между рабочей группой и доменом.</span><span class="sxs-lookup"><span data-stu-id="5da31-243">If gateway and target computers are in different workgroups or domains, a trust relationship must be established between the two workgroup computers, the two domains, or between the workgroup and the domain.</span></span> <span data-ttu-id="5da31-244">Это отношение нельзя настроить при помощи командлетов правил авторизации Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-244">This relationship cannot be configured by using Windows PowerShell Web Access authorization rule cmdlets.</span></span> <span data-ttu-id="5da31-245">Правила авторизации не определяют отношение доверия между компьютерами. Они только разрешают пользователям подключаться к определенным конечным компьютерам и конфигурациям сеансов.</span><span class="sxs-lookup"><span data-stu-id="5da31-245">Authorization rules do not define a trust relationship between computers; they can only authorize users to connect to specific target computers and session configurations.</span></span> <span data-ttu-id="5da31-246">Дополнительные сведения о настройке отношения доверия между разными доменами см. в статье о [создании отношений доверия между доменами и лесами](https://technet.microsoft.com/library/cc794775.aspx).</span><span class="sxs-lookup"><span data-stu-id="5da31-246">For more information about how to configure a trust relationship between different domains, see [Creating Domain and Forest Trusts](https://technet.microsoft.com/library/cc794775.aspx).</span></span>
   > <span data-ttu-id="5da31-247">Дополнительные сведения о добавлении компьютеров рабочей группы в список надежных узлов см. в разделе [Удаленное управление при помощи диспетчера сервера](https://technet.microsoft.com/library/dd759202.aspx).</span><span class="sxs-lookup"><span data-stu-id="5da31-247">For more information about how to add workgroup computers to a trusted hosts list, see [Remote Management with Server Manager](https://technet.microsoft.com/library/dd759202.aspx).</span></span>

### <a name="using-a-single-set-of-authorization-rules-for-multiple-sites"></a><span data-ttu-id="5da31-248">Использование одного набора правил авторизации для нескольких сайтов</span><span class="sxs-lookup"><span data-stu-id="5da31-248">Using a single set of authorization rules for multiple sites</span></span>

<span data-ttu-id="5da31-249">Правила авторизации сохраняются в XML-файле.</span><span class="sxs-lookup"><span data-stu-id="5da31-249">Authorization rules are stored in an XML file.</span></span> <span data-ttu-id="5da31-250">По умолчанию путь к XML-файлу имеет вид `$env:windir\Web\PowershellWebAccess\data\AuthorizationRules.xml`.</span><span class="sxs-lookup"><span data-stu-id="5da31-250">By default, the path name of the XML file is `$env:windir\Web\PowershellWebAccess\data\AuthorizationRules.xml`.</span></span>

<span data-ttu-id="5da31-251">Путь к XML-файлу правил авторизации сохраняется в файле **powwa.config** в папке `$env:windir\Web\PowershellWebAccess\data`.</span><span class="sxs-lookup"><span data-stu-id="5da31-251">The path to the authorization rules XML file is stored in the **powwa.config** file, which is found in `$env:windir\Web\PowershellWebAccess\data`.</span></span> <span data-ttu-id="5da31-252">Администратор может легко изменить ссылку на путь по умолчанию в файле **powwa.config** соответственно своим параметрам и требованиям.</span><span class="sxs-lookup"><span data-stu-id="5da31-252">The administrator has the flexibility to change the reference to the default path in **powwa.config** to suit preferences or requirements.</span></span> <span data-ttu-id="5da31-253">Возможность изменения расположения файла администратором позволяет нескольким шлюзам Windows PowerShell Web Access использовать одни и те же правила авторизации, если требуется такая конфигурация.</span><span class="sxs-lookup"><span data-stu-id="5da31-253">Allowing the administrator to change the location of the file lets multiple Windows PowerShell Web Access gateways use the same authorization rules, if such a configuration is desired.</span></span>

## <a name="session-management"></a><span data-ttu-id="5da31-254">Управление сеансом</span><span class="sxs-lookup"><span data-stu-id="5da31-254">Session management</span></span>

<span data-ttu-id="5da31-255">По умолчанию Windows PowerShell Web Access позволяет пользователю открывать не больше трех сеансов одновременно.</span><span class="sxs-lookup"><span data-stu-id="5da31-255">By default, Windows PowerShell Web Access limits a user to three sessions at one time.</span></span> <span data-ttu-id="5da31-256">Вы можете отредактировать файл **web.config** веб-приложения в диспетчере служб IIS, чтобы поддерживать другое количество сеансов на пользователя.</span><span class="sxs-lookup"><span data-stu-id="5da31-256">You can edit the web application's **web.config** file in IIS Manager to support a different number of sessions per user.</span></span> <span data-ttu-id="5da31-257">Путь к файлу **web.config** имеет вид `$env:windir\Web\PowerShellWebAccess\wwwroot\Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5da31-257">The path to the **web.config** file is `$env:windir\Web\PowerShellWebAccess\wwwroot\Web.config`.</span></span>

<span data-ttu-id="5da31-258">По умолчанию веб-сервер IIS настраивается на перезапуск пула приложений, если был изменен любой параметр.</span><span class="sxs-lookup"><span data-stu-id="5da31-258">By default, IIS Web Server is configured to restart the application pool if any settings are edited.</span></span> <span data-ttu-id="5da31-259">Например, пул приложений перезапускается, если были внесены изменения в файл **web.config**.</span><span class="sxs-lookup"><span data-stu-id="5da31-259">For example, the application pool is restarted if changes are made to the **web.config** file.</span></span> <span data-ttu-id="5da31-260">>Так как **Windows PowerShell Web Access** использует состояния сеансов в памяти, пользователи, вошедшие в сеансы **Windows PowerShell Web Access**, теряют свои сеансы при перезапуске пула приложений.</span><span class="sxs-lookup"><span data-stu-id="5da31-260">>Because **Windows PowerShell Web Access** uses in-memory session states, >users signed in to **Windows PowerShell Web Access** sessions lose their sessions when the application pool is restarted.</span></span>

### <a name="setting-default-parameters-on-the-sign-in-page"></a><span data-ttu-id="5da31-261">Установка параметров по умолчанию на странице входа</span><span class="sxs-lookup"><span data-stu-id="5da31-261">Setting default parameters on the sign-in page</span></span>

<span data-ttu-id="5da31-262">Если шлюз Windows PowerShell Web Access работает под управлением Windows Server 2012 R2, вы можете настроить значения по умолчанию для параметров, которые отображаются на странице входа в Windows PowerShell Web Access.</span><span class="sxs-lookup"><span data-stu-id="5da31-262">If your Windows PowerShell Web Access gateway is running on Windows Server 2012 R2, you can configure default values for the settings that are displayed on the Windows PowerShell Web Access sign-in page.</span></span> <span data-ttu-id="5da31-263">Вы можете настроить значения в файле **web.config**, описанном в предыдущем абзаце.</span><span class="sxs-lookup"><span data-stu-id="5da31-263">You can configure values in the **web.config** file that is described in the preceding paragraph.</span></span> <span data-ttu-id="5da31-264">Значения по умолчанию для параметров на странице входа находятся в разделе **appSettings** файла web.config, ниже приведен пример раздела **appSettings**.</span><span class="sxs-lookup"><span data-stu-id="5da31-264">Default values for the sign-in page settings are found in the **appSettings** section of the web.config file; the following is an example of the **appSettings** section.</span></span> <span data-ttu-id="5da31-265">Допустимые значения для многих из этих параметров такие же, как для соответствующих параметров командлета [New-PSSession](https://technet.microsoft.com/library/hh849717.aspx) в Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5da31-265">Valid values for many of these settings are the same as those for the corresponding parameters of the [New-PSSession](https://technet.microsoft.com/library/hh849717.aspx) cmdlet in Windows PowerShell.</span></span>

<span data-ttu-id="5da31-266">Например, ключ `defaultApplicationName`, как показано в следующем блоке кода, является значением привилегированной переменной **$PSSessionApplicationName**.</span><span class="sxs-lookup"><span data-stu-id="5da31-266">For example, the `defaultApplicationName` key, as shown in the following code block, is the value of the **$PSSessionApplicationName** preference variable on the target computer.</span></span>

```xml
  <appSettings>
      <add key="maxSessionsAllowedPerUser" value="3"/>
      <add key="defaultPortNumber" value="5985"/>
      <add key="defaultSSLPortNumber" value="5986"/>
      <add key="defaultApplicationName" value="WSMAN"/>
      <add key="defaultUseSslSelection" value="0"/>
      <add key="defaultAuthenticationType" value="0"/>
      <add key="defaultAllowRedirection" value="0"/>
      <add key="defaultConfigurationName" value="Microsoft.PowerShell"/>
  </appSettings>
```

### <a name="time-outs-and-unplanned-disconnections"></a><span data-ttu-id="5da31-267">Время ожидания и незапланированные отключения</span><span class="sxs-lookup"><span data-stu-id="5da31-267">Time-outs and unplanned disconnections</span></span>

<span data-ttu-id="5da31-268">Время ожидания сеанса Windows PowerShell Web Access истекло. В Windows PowerShell Web Access под управлением Windows Server 2012 сообщение о времени ожидания отображается для вошедших пользователей после 15 минут отсутствия активности в сеансе.</span><span class="sxs-lookup"><span data-stu-id="5da31-268">Windows PowerShell Web Access sessions time out. In Windows PowerShell Web Access running on Windows Server 2012, A time-out message is displayed to signed-in users after 15 minutes of session inactivity.</span></span> <span data-ttu-id="5da31-269">Если пользователь не отвечает в пределах пяти минут после вывода сообщения о времени ожидания, сеанс заканчивается и пользователь выводится из системы. Вы можете изменить значения времени ожидания для сеанса в параметрах веб-сайта в диспетчере служб IIS.</span><span class="sxs-lookup"><span data-stu-id="5da31-269">If the user does not respond within five minutes after the time-out message is displayed, the session is ended, and the user is signed out. You can change time-out periods for sessions in the website settings in IIS Manager.</span></span>

<span data-ttu-id="5da31-270">В Windows PowerShell Web Access, работающему под управлением Windows Server 2012 R2, время ожидания сеансов по умолчанию истекает через 20 минут бездействия.</span><span class="sxs-lookup"><span data-stu-id="5da31-270">In Windows PowerShell Web Access running on Windows Server 2012 R2, sessions time out, by default, after 20 minutes of inactivity.</span></span> <span data-ttu-id="5da31-271">Если пользователи отключаются от сеансов в веб-консоли в результате сетевых ошибок или других незапланированных завершений работы или сбоев, а не потому, что они сами закрыли свои сеансы, сеансы Windows PowerShell Web Access продолжают выполнение, оставаясь подключенными к целевым компьютерам, пока не истечет время ожидания на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="5da31-271">If users are disconnected from sessions in the web-based console because of network errors or other unplanned shutdowns or failures, and not because they have closed the sessions themselves, the Windows PowerShell Web Access sessions continue to run, connected to target computers, until the time-out period on the client side lapses.</span></span> <span data-ttu-id="5da31-272">Сеанс отключается после истечения либо 20 минут, установленных по умолчанию, либо времени ожидания, заданного администратором шлюза, в зависимости от того, какой период короче.</span><span class="sxs-lookup"><span data-stu-id="5da31-272">The session is disconnected after either the default 20 minutes, or after the time-out period specified by the gateway administrator, whichever is shorter.</span></span>

<span data-ttu-id="5da31-273">Если сервер шлюза работает под управлением Windows Server 2012 R2, Windows PowerShell Web Access предоставляет пользователям возможность повторного подключения к сохраненным сеансам позднее, но, когда сеанс был отключен из-за сетевых ошибок, незапланированного завершения работы или другого сбоя, пользователи не смогут увидеть сохраненные сеансы и повторно к ним подключиться, пока не истечет время ожидания, заданное администратором шлюза.</span><span class="sxs-lookup"><span data-stu-id="5da31-273">If the gateway server is running Windows Server 2012 R2, Windows PowerShell Web Access lets users reconnect to saved sessions at a later time, but when network errors, unplanned shutdowns, or other failures disconnect sessions, users cannot see or reconnect to saved sessions until after the time-out period specified by the gateway administrator has lapsed.</span></span>

## <a name="see-also"></a><span data-ttu-id="5da31-274">См. также</span><span class="sxs-lookup"><span data-stu-id="5da31-274">See Also</span></span>

<span data-ttu-id="5da31-275">[Установка и использование Windows PowerShell Web Access](https://technet.microsoft.com/library/hh831611(v=ws.11).aspx)</span><span class="sxs-lookup"><span data-stu-id="5da31-275">[Install and Use Windows PowerShell Web Access](https://technet.microsoft.com/library/hh831611(v=ws.11).aspx)</span></span>

[<span data-ttu-id="5da31-276">about_Session_Configurations</span><span class="sxs-lookup"><span data-stu-id="5da31-276">about_Session_Configurations</span></span>](https://technet.microsoft.com/library/dd819508.aspx)

[<span data-ttu-id="5da31-277">Командлеты Windows PowerShell Web Access</span><span class="sxs-lookup"><span data-stu-id="5da31-277">Windows PowerShell Web Access Cmdlets</span></span>](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)
