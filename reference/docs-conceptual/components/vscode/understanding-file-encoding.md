---
title: Основные сведения о кодировке файлов в VSCode и PowerShell
description: Настройка кодировки в VSCode и PowerShell
ms.date: 02/28/2019
ms.openlocfilehash: f3b133b4bee7688821a5960429e2f26b69b01e12
ms.sourcegitcommit: ce46e5098786e19d521b4bf948ff62d2b90bc53e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2019
ms.locfileid: "57251480"
---
# <a name="understanding-file-encoding-in-vscode-and-powershell"></a>Основные сведения о кодировке файлов в VSCode и PowerShell

При использовании Visual STUDIO Code для создания и редактирования сценариев PowerShell, очень важно, что ваши файлы сохраняются в формате кодирования верного символа.

## <a name="what-is-file-encoding-and-why-is-it-important"></a>Что такое кодирование и почему важно?

VSCode управляет интерфейсом между человека ввода строки символов в буфер и чтения/записи блоки байтов в файловой системе. Когда файл сохраняется в VSCode, в нем кодировки для этого текста.

Аналогичным образом при PowerShell запускает сценарий, его необходимо преобразовать байтов в файле символов для восстановления файла в программу PowerShell. Поскольку VSCode записывает файл, а PowerShell считывает файл, им необходимо использовать ту же систему кодировки. Идет процесс синтаксический анализ скрипта PowerShell: *байт* -> *символов* -> *маркеры*  ->   *дерево абстрактного синтаксиса* -> *выполнения*.

VSCode и PowerShell устанавливаются с конфигурацией кодировки по умолчанию. Тем не менее кодировка по умолчанию, используемые PowerShell был изменен с выпуском PowerShell Core (версии 6.x). Чтобы можно было без проблем, с помощью PowerShell или расширения PowerShell в VSCode, необходимо настроить параметры VSCode и PowerShell должным образом.

## <a name="common-causes-of-encoding-issues"></a>Распространенные причины проблемы кодирования

Кодировки проблемы возникают, если кодировка VSCode или свой файл сценария не совпадает с ожидаемая кодировка PowerShell. Нет способа для PowerShell, чтобы автоматически определить кодировку файла.

Вы скорее кодирования проблемы при использовании символов не в [7-разрядной кодировке ASCII](https://ascii.cl/). Например:

- Надстрочными знаками латинские символы (`É`, `ü`)
- Азиатского знаки, такие как кириллица (`Д`, `Ц`)
- Китайский хан (`脚`, `本`)

Представлены распространенные причины проблем кодирования:

- Настройки по умолчанию не были изменены кодировок VSCode и PowerShell. В PowerShell 5.1 и ниже, значение по умолчанию кодировка отличается от в VSCode.
- Другой редактор открытых и перезаписать файл в новая кодировка. Это часто происходит на интегрированную среду Сценариев.
- Файл возвращается в систему управления версиями в кодировке, отличный от какие VSCode или PowerShell ожидает. Это может произойти, когда участники совместной работы использовать редакторы с различными конфигурациями кодирования.

### <a name="how-to-tell-when-you-have-encoding-issues"></a>Инструкции по определению, при наличии проблемы кодирования

Часто кодирования ошибки представляют как ошибки в скриптах синтаксического анализа. Если вы нашли последовательности странное символов в скрипте, это может быть проблема. В примере ниже, тире (`–`) отображается в виде символов `â€“`:

```Output
Send-MailMessage : A positional parameter cannot be found that accepts argument 'Testing FuseMail SMTP...'.
At C:\Users\<User>\<OneDrive>\Development\PowerShell\Scripts\Send-EmailUsingSmtpRelay.ps1:6 char:1
+ Send-MailMessage â€“From $from â€“To $recipient1 â€“Subject $subject  ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidArgument: (:) [Send-MailMessage], ParameterBindingException
    + FullyQualifiedErrorId : PositionalParameterNotFound,Microsoft.PowerShell.Commands.SendMailMessage
```

Эта проблема возникает, так как VSCode кодирует и символ `–` в UTF-8 в качестве байты `0xE2 0x80 0x93`.
Если эти байты декодируются как Windows-1252, они интерпретируются как символы `â€“`.

Некоторые последовательности странное символов, которые можно встретить включают:

- `â€“` вместо `–`;
- `â€”` вместо `—`;
- `Ã„2` вместо `Ä`;
- `Â` вместо ` ` (неразрывный пробел);
- `Ã©` вместо `é`.

Этот удобный [ссылку](https://www.i18nqa.com/debug/utf8-debug.html) перечислены распространенные шаблоны, которые указывают на проблему кодировки UTF-8/Windows-1252.

## <a name="how-the-powershell-extension-in-vscode-interacts-with-encodings"></a>Взаимодействие с кодировками расширения PowerShell в VSCode

Расширения PowerShell взаимодействует со сценариями в несколькими способами:

1. При изменении скриптов в VSCode, содержимое отправляются VSCode для расширения. [Протокол языкового сервера][] требует, что это содержимое передается в UTF-8. Таким образом он не поддерживается для расширения для получения неправильная кодировка.
2. При выполнении скрипта непосредственно в интегрированной консоли, они все считываемые из файла PowerShell непосредственно. Кодирование tf PowerShell отличается от его VSCode, что-нибудь может пойти не так здесь.
3. Когда скрипт, который открыт в VSCode ссылается на другой сценарий, который не был открыт в VSCode, расширение возвращается к загрузке содержимого этого скрипта из файловой системы. Расширения PowerShell по умолчанию используется кодировка UTF-8, но использует [метка порядка следования байтов][], или Спецификации, обнаружения, чтобы выбрать правильную кодировку.

Проблема возникает, когда при условии, что кодировка менее Спецификации форматов (таких как [UTF-8][] без метки следования байтов и [Windows-1252][]).
Расширения PowerShell по умолчанию используется UTF-8. Расширение нельзя изменить параметры кодирования в VSCode.
Дополнительные сведения см. в разделе [выдавать #824](https://github.com/Microsoft/vscode/issues/824).

## <a name="choosing-the-right-encoding"></a>Выборе правой кодировки

Различные системы и приложения можно использовать различные кодировки:

- В .NET Standard в Интернете и в среде Linux теперь главный кодирования является UTF-8.
- Во многих приложениях .NET Framework используется [UTF-16][]. По историческим причинам, это иногда называется «Unicode», что теперь термин относится к более широкие [стандартный](https://en.wikipedia.org/wiki/Unicode) UTF-8 и UTF-16.
- На Windows многие собственного приложения, которые предшествуют Юникода по-прежнему использовать Windows-1252, по умолчанию.

Кодировки Юникод есть концепция порядка следования байтов (BOM) пометить. Спецификации находиться в начале текста, чтобы определить декодер, какая кодировка используется текст. Для многобайтовых кодировок, также указывает Спецификации [порядка следования байтов](https://en.wikipedia.org/wiki/Endianness) кодировки. Спецификации предназначены для байтов, которые редко происходят в Юникод текста, позволяя обоснованные предположения, что текст является Юникода, если метка BOM присутствует.

Спецификации являются необязательными и их внедрения не же популярной в мире Linux, поскольку везде используется соглашение о надежной UTF-8. Большинство приложений Linux предположить, что текстовое поле кодируется в UTF-8. Хотя многие приложения Linux будет распознавать и правильно обрабатывать Спецификации, номер этого не сделать, что приводит к артефактов в тексте, управлять с помощью этих приложений.

**Таким образом**:

- Если вы работаете в основном с приложениями Windows и Windows PowerShell, вы предпочитаете, кодировки как UTF-8 с метки порядка БАЙТОВ или UTF-16.
- Если вы работаете на платформах, следует отдавать предпочтение UTF-8 с метки порядка БАЙТОВ.
- Если вы работаете главным образом в контекстах, связанной с Linux, следует отдавать предпочтение UTF-8 без метки порядка БАЙТОВ.
- Windows-1252 и дополнительная латиница-1, устаревших кодировок, по возможности следует избегать.
  Тем не менее некоторые приложения предыдущих версий Windows зависит от их.
- Также стоит отметить, что подпись сценариев [кодировка зависит от](https://github.com/PowerShell/PowerShell/issues/3466), то есть изменения кодировки на сценарий со знаком потребует повторного подписывания.

## <a name="configuring-vscode"></a>Настройка VSCode

В VSCode кодировка по умолчанию — UTF-8 без метки порядка БАЙТОВ.

Чтобы задать [Кодирование в VSCode][], перейдите к параметрам VSCode (<kbd>Ctrl<kbd>+</kbd>,</kbd>) и задайте `"files.encoding"` параметр:

```json
"files.encoding": "utf8bom"
```

Ниже приведены некоторые возможные значения.

- `utf8`: [UTF-8] без метки порядка БАЙТОВ
- `utf8bom`: [UTF-8] с метки порядка БАЙТОВ
- `utf16le`: Little endian [UTF-16]
- `utf16be`: Big endian [UTF-16]
- `windows1252`: [Windows-1252]

Должен отобразиться раскрывающийся список для этого в представлении графического пользовательского интерфейса, или просмотреть завершений для него в JSON.

Чтобы обеспечить автоматическое определение кодировки, если это возможно, можно также добавить следующие:

```json
"files.autoGuessEncoding": true
```

Если вы не хотите эти параметры влияют на все типы файлов, VSCode также позволяет конфигурации каждого языка. Создание параметра конкретного языка, поместив параметры `[<language-name>]` поля. Например:

```json
"[powershell]": {
    "files.encoding": "utf8bom",
    "files.autoGuessEncoding": true
}
```

## <a name="configuring-powershell"></a>Настройка PowerShell

PowerShell кодировка по умолчанию зависит от версии:

- В PowerShell 6 + кодировку по умолчанию — UTF-8 без метки порядка БАЙТОВ на всех платформах.
- В Windows PowerShell, кодировка по умолчанию обычно является Windows-1252, расширение [Латиница 1][], которая также называется ISO 8859-1.

В PowerShell 5 + можно найти кодирования по умолчанию с этим:

```powershell
[psobject].Assembly.GetTypes() | Where-Object { $_.Name -eq 'ClrFacade'} |
  ForEach-Object {
    $_.GetMethod('GetDefaultEncoding', [System.Reflection.BindingFlags]'nonpublic,static').Invoke($null, @())
  }
```

Следующие [скрипт](https://gist.github.com/rjmholt/3d8dd4849f718c914132ce3c5b278e0e) может использоваться для определения того, что кодирование сеанс PowerShell выводит для сценарий без метки порядка БАЙТОВ.

```powershell
$badBytes = [byte[]]@(0xC3, 0x80)
$utf8Str = [System.Text.Encoding]::UTF8.GetString($badBytes)
$bytes = [System.Text.Encoding]::ASCII.GetBytes('Write-Output "') + [byte[]]@(0xC3, 0x80) + [byte[]]@(0x22)
$path = Join-Path ([System.IO.Path]::GetTempPath()) 'encodingtest.ps1'

try
{
    [System.IO.File]::WriteAllBytes($path, $bytes)

    switch (& $path)
    {
        $utf8Str
        {
            return 'UTF-8'
            break
        }

        default
        {
            return 'Windows-1252'
            break
        }
    }
}
finally
{
    Remove-Item $path
}
```

Это можно настроить PowerShell для использования в заданной кодировке более обычно с помощью параметров профиля. См. следующие статьи:

- [@mklement0]в [ответов о кодировании PowerShell на сайте StackOverflow](https://stackoverflow.com/a/40098904).
- [@rkeithhill]в [записи блога об обработке входных данных менее метки порядка БАЙТОВ UTF-8 в PowerShell](https://rkeithhill.wordpress.com/2010/05/26/handling-native-exe-output-encoding-in-utf8-with-no-bom/).

Не поддерживается для принудительного PowerShell, чтобы использовать конкретную кодировку ввода. PowerShell 5.1 и более ранних версий по умолчанию для Windows-1252, кодировку, если присутствует BOM. По причинам совместимости лучше сохранить скрипты в формате Юникод с метки порядка БАЙТОВ.

> [!IMPORTANT]
> Любые другие инструменты у вас есть что сенсорный PowerShell скриптов может зависеть от выбранных параметров кодирования или преобразовывать скрипты в другой кодировке.

### <a name="existing-scripts"></a>Существующие сценарии

Скрипты, которые уже находятся в файловой системе может потребоваться повторно кодироваться ваш новый указанную кодировку. В нижней строке из VSCode вы увидите метки UTF-8. Щелкните его, чтобы открыть панели действий и выберите **сохранить с кодировкой**. Теперь вы можете выбрать новая кодировка для этого файла. См. в разделе [Кодирование в VSCode][] подробные инструкции.

Если вам нужно повторно закодировать несколько файлов, можно использовать следующий сценарий:

```powershell
Get-ChildItem *.ps1 -Recurse | ForEach-Object {
    $content = Get-Content -Path $_
    Set-Content -Path $_.Fullname -Value $content -Encoding UTF8 -PassThru -Force
}
```

### <a name="the-powershell-integrated-scripting-environment-ise"></a>Интегрированная среда сценариев (ISE) PowerShell

При редактировании скриптов с помощью интегрированной среды Сценариев PowerShell, необходимо синхронизировать ваш кодирования параметров.

Интегрированная среда Сценариев следует принять метки порядка БАЙТОВ, но это также можно использовать отражение для [выберите кодировку](https://bensonxion.wordpress.com/2012/04/25/powershell-ise-default-saveas-encoding/).
Обратите внимание на то, что это не сохраняется между начинающих компаний.

### <a name="source-control-software"></a>Программное обеспечение управления версиями

Некоторые инструментов системы управления версиями, например git, игнорировать кодировки; git отслеживает только байты.
Другие, например TFS или Mercurial, может отличаться. Даже некоторые средства, основанных на git, зависят от того, декодирование текста.

Если это так, убедитесь, что вы:

- Настройка кодировки в системе управления версиями в соответствии с вашей конфигурации VSCode текста.
- Убедитесь, что все файлы проверяются в систему управления версиями в соответствующей кодировки.
- Будьте осторожны при изменениях в кодировку, полученные через систему управления версиями. Ключа признаком этого является diff, указывает, что изменения, но где ничего были изменены (так как имеют байт, но не иметь символов).

### <a name="collaborators-environments"></a>Средах других участников

На основе Настройка системы управления версиями, убедитесь, что других участников на все файлы, которые вы предоставляете общий доступ не имеют параметры, которые переопределяют кодирования путем повторного кодирования файлов PowerShell.

### <a name="other-programs"></a>Другие программы

Все другие программы, считывает или записывает сценарий PowerShell может повторно кодировать его.

Вот несколько примеров.

- Использование буфера обмена для копирования и вставки сценария. Такое часто встречается в сценариях, например:
  - Копирование скрипта в виртуальную Машину
  - Скопировав сценарий из электронной почты или веб-страницы
  - Копирование скрипта в или из документа Microsoft Word или PowerPoint
- Других текстовых редакторов, таких как:
  - Блокнот
  - VIM
  - Любой редактор скриптов PowerShell
- Текст, редактирование служебные программы, например:
  - `Get-Content`/`Set-Content`/`Out-File`
  - Операторы перенаправления PowerShell, такие как `>` и `>>`
  - `sed`/`awk`
- Файл программы передачи, таких как:
  - Веб-браузер, при загрузке сценариев
  - Общей папки

Некоторые из этих средств работать в байтах, а не текст, но другие предлагают кодирования конфигураций. В таких случаях, когда необходимо настроить кодировки необходимо сделать его так же, как ваш редактор, кодирование, чтобы предотвратить возникновение проблем.

## <a name="other-resources-on-encoding-in-powershell"></a>Другие ресурсы о кодировании в PowerShell

Существует несколько других неплохо сообщений на кодировании и настройка кодирование в PowerShell, обязательно прочитайте:

- [@mklement0]в [Сводка шифрования PowerShell на сайте StackOverflow](https://stackoverflow.com/questions/40098771/changing-powershells-default-output-encoding-to-utf-8)
- Предыдущие выпуски, открытый в vscode с помощью PowerShell для кодирования проблемы:
  - [#1308](https://github.com/PowerShell/vscode-powershell/issues/1308)
  - [#1628](https://github.com/PowerShell/vscode-powershell/issues/1628)
  - [#1680](https://github.com/PowerShell/vscode-powershell/issues/1680)
  - [#1744](https://github.com/PowerShell/vscode-powershell/issues/1744)
  - [#1751](https://github.com/PowerShell/vscode-powershell/issues/1751)
- [Классической *Joel on Software* пишу Юникода](https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/)
- [Кодировки в .NET Standard](https://github.com/dotnet/standard/issues/260#issuecomment-289549508)


[@mklement0]: https://github.com/mklement0
[@rkeithhill]: https://github.com/rkeithhill
[Windows-1252]: https://wikipedia.org/wiki/Windows-1252
[Латиница 1]: https://wikipedia.org/wiki/ISO/IEC_8859-1
[UTF-8]: https://wikipedia.org/wiki/UTF-8
[Метка порядка следования байтов]: https://wikipedia.org/wiki/Byte_order_mark
[UTF-16]: https://wikipedia.org/wiki/UTF-16
[Протокол языкового сервера]: https://microsoft.github.io/language-server-protocol/
[Кодирование в VSCode]: https://code.visualstudio.com/docs/editor/codebasics#_file-encoding-support