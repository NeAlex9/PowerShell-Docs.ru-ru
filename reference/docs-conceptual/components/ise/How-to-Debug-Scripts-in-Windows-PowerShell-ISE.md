---
ms.date: 01/02/2020
keywords: powershell,командлет
title: Отладка сценариев в интегрированной среде сценариев Windows PowerShell
ms.openlocfilehash: c5da80f3e0e013448533c80bbe1957a301be38f5
ms.sourcegitcommit: 058a6e86eac1b27ca57a11687019df98709ed709
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2020
ms.locfileid: "75737123"
---
# <a name="how-to-debug-scripts-in-windows-powershell-ise"></a>Отладка сценариев в интегрированной среде сценариев Windows PowerShell

В этой статье описано, как отлаживать сценарии на локальном компьютере визуальными инструментами отладки интегрированной среды сценариев (ISE) Windows PowerShell.

## <a name="how-to-manage-breakpoints"></a>Управление точками останова

Точка останова — это назначенная точка в сценарии, на которой выполнение временно останавливается, чтобы можно было проверить текущее состояние переменных и среды, в которой выполняется сценарий.
После приостановки сценария в точке останова можно выполнить команды в области консоли для проверки его состояния. Можно выводить переменные и выполнять другие команды. Можно даже изменять значения любых переменных, видимых в контексте текущего выполняемого сценария. После получения нужных сведений можно продолжить выполнение сценария.

В среде отладки Windows PowerShell можно установить три вида точек останова:

1. **Точка останова по строке**. Сценарий приостанавливается при достижении назначенной строки.

1. **Точка останова переменной.** Сценарий приостанавливается при изменении значения, назначенного переменной.

1. **Точка останова команды.** Сценарий приостанавливается перед выполнением назначенной команды. Можно указать параметры, чтобы отфильтровать для точки останова только нужную операцию. Команда также может быть созданной вами функцией.

В среде отладки интегрированной среды сценариев Windows PowerShell только точки останова по строке можно задать с помощью меню или сочетаний клавиш. Точки останова двух других типов также можно задать, но в области консоли, используя командлет [Set-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Set-PSBreakpoint.md). В этом разделе описано, как выполнять задачи отладки в интегрированной среде сценариев Windows PowerShell, по возможности используя меню, и выполнять более широкий набор команд из области консоли, используя сценарии.

### <a name="to-set-a-breakpoint"></a>Задание точки останова

Точку останова можно задать в сценарии только после его сохранения. Щелкните правой кнопкой мыши строку, где нужно задать точку останова, и выберите пункт **Точка останова**. Другой вариант: щелкните строку, где нужно задать точку останова, и нажмите клавишу <kbd>F9</kbd> либо выберите **Точка останова** в меню **Отладка**.

Следующий сценарий — пример создания точки останова по переменной из области консоли с помощью командлета [Set-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Set-PSBreakpoint.md):

```powershell
# This command sets a breakpoint on the Server variable in the Sample.ps1 script.
Set-PSBreakpoint -Script sample.ps1 -Variable Server
```

### <a name="list-all-breakpoints"></a>Перечисление всех точек останова

Отображает все точки останова в текущем сеансе Windows PowerShell.

В меню **Отладка** выберите пункт **Вывести список точек останова**. Следующий сценарий — пример перечисления всех точек останова из области консоли с помощью командлета [Get-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Get-PSBreakpoint.md):

```powershell
# This command lists all breakpoints in the current session.
Get-PSBreakpoint
```

### <a name="remove-a-breakpoint"></a>Удаление точки останова

Удаляет указанную точку останова.

Если вы считаете, что точка останова может понадобиться в будущем, лучше [отключите](#disable-a-breakpoint) ее. Щелкните правой кнопкой мыши строку, где нужно удалить точку останова, и выберите пункт **ToggleBreakpoint** (Точка останова).
Другой вариант: щелкните строку, где нужно удалить точку останова, и выберите пункт **Точка останова** в меню **Отладка**. Следующий сценарий — пример удаления точки останова с указанным идентификатором из области консоли с помощью командлета [Remove-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Remove-PSBreakpoint.md):

```powershell
# This command deletes the breakpoint with breakpoint ID 2.
Remove-PSBreakpoint -Id 2
```

### <a name="remove-all-breakpoints"></a>Удаление всех точек останова

Чтобы удалить все точки останова, определенные в текущем сеансе, выберите команду **Удалить все точки останова** в меню **Отладка**.

Следующий сценарий — пример удаления всех точек останова из области консоли с помощью командлета [Remove-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Remove-PSBreakpoint.md):

```powershell
# This command deletes all of the breakpoints in the current session.
Get-PSBreakpoint | Remove-PSBreakpoint
```

### <a name="disable-a-breakpoint"></a>Отключение точки останова

Отключение точки не приводит к ее удалению; она просто остается неактивной, пока не будет включена. Щелкните правой кнопкой мыши строку, где нужно отключить точку останова, и выберите команду **Отключить точку останова**. Другой вариант: щелкните строку, где нужно отключить точку останова, и нажмите клавишу <kbd>F9</kbd> либо выберите **Отключить точку останова** в меню **Отладка**. Следующий сценарий — пример отключения точки останова с указанным идентификатором из области консоли с помощью командлета [Disable-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Disable-PSBreakpoint.md):

```powershell
# This command disables the breakpoint with breakpoint ID 0.
Disable-PSBreakpoint -Id 0
```

### <a name="disable-all-breakpoints"></a>Отключение всех точек останова

Отключение точки не приводит к ее удалению; она просто остается неактивной, пока не будет включена. Чтобы отключить все точки останова в текущем сеансе, выберите команду **Отключить все точки останова** в меню **Отладка**. Следующий сценарий — пример отключения всех точек останова из области консоли с помощью командлета [Disable-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Disable-PSBreakpoint.md):

```powershell
# This command disables all breakpoints in the current session.
# You can abbreviate this command as: "gbp | dbp".
Get-PSBreakpoint | Disable-PSBreakpoint
```

### <a name="enable-a-breakpoint"></a>Включение точки останова

Щелкните правой кнопкой мыши строку, где нужно включить точку останова, и выберите команду **Включить точку останова**. Другой вариант: щелкните строку, где нужно включить точку останова, и нажмите клавишу <kbd>F9</kbd> либо выберите **Включить точку останова** в меню **Отладка**. Следующий сценарий — пример включения отдельных точек останова из области консоли с помощью командлета [Enable-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Enable-PSBreakpoint.md):

```powershell
# This command enables breakpoints with breakpoint IDs 0, 1, and 5.
Enable-PSBreakpoint -Id 0, 1, 5
```

### <a name="enable-all-breakpoints"></a>Включение всех точек останова

Чтобы включить все точки останова, определенные в текущем сеансе, выберите команду **Включить все точки останова** в меню **Отладка**. Следующий сценарий — пример включения всех точек останова из области консоли с помощью командлета [Enable-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Enable-PSBreakpoint.md):

```powershell
# This command enables all breakpoints in the current session.
# You can abbreviate the command by using their aliases: "gbp | ebp".
Get-PSBreakpoint | Enable-PSBreakpoint
```

## <a name="how-to-manage-a-debugging-session"></a>Управление сеансом отладки

Перед запуском отладки нужно задать одну или несколько точек останова. Точки останова нельзя задавать, если отлаживаемый сценарий не сохранен. Инструкции по заданию точек останова см. в статье [Управление точками останова](#how-to-manage-breakpoints) или [Set-PSBreakpoint](/reference/6/Microsoft.PowerShell.Utility/Set-PSBreakpoint.md).
После начала отладки сценарий нельзя редактировать до ее окончания. Сценарий, содержащий одну или несколько точек останова, автоматически сохраняется перед запуском.

### <a name="to-start-debugging"></a>Начало отладки

Нажмите клавишу <kbd>F5</kbd>, щелкните значок **Выполнить сценарий** на панели инструментов или выберите **Выполнить/продолжить** в меню **Отладка**. Сценарий выполняется до первой точки останова. В ней он приостанавливается и выделяет соответствующую строку.

### <a name="to-continue-debugging"></a>Продолжение отладки

Нажмите клавишу <kbd>F5</kbd>, щелкните значок **Run Script** (Выполнить сценарий) на панели инструментов, выберите **Run/Continue** (Выполнить/продолжить) в меню **Debug** (Отладка) либо введите `C` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>. В результате выполнение продолжается до следующей точки останова, а при ее отсутствии — до конца сценария.

### <a name="to-view-the-call-stack"></a>Просмотр стека вызовов

Стек вызовов отображает текущее расположение выполнения в сценарии. Если сценарий выполняется в функции, вызванной другой функцией, это отражается путем добавления строк в выходные данные. В самой нижней строке отображается исходный сценарий и его строка, в которой была вызвана функция. Предыдущая строка показывает эту функцию и ее строку, в которой могла быть вызвана другая функция. В самой верхней строке отображается текущий контекст для текущей строки, в которой задана точка останова.

Чтобы просмотреть текущий стек вызовов, пока выполнение приостановлено, нажмите клавиши <kbd>CTRL</kbd>+<kbd>SHIFT</kbd>+<kbd>D</kbd>, выберите команду **Display Call Stack** (Отображение стека вызовов) в меню **Debug** (Отладка) или введите `K` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>.

### <a name="to-stop-debugging"></a>Остановка отладки

Нажмите клавиши <kbd>SHIFT</kbd>+<kbd>F5</kbd>, выберите команду **Stop Debugger** (Остановить отладчик) в меню **Debug** (Отладка) или введите `Q` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>.

## <a name="how-to-step-over-step-into-and-step-out-while-debugging"></a>Выполнение шагов с обходом, заходом и выходом во время отладки

Пошаговое выполнение сценария — это поочередное выполнение его операторов. Выполнение можно остановить на любой строке кода, чтобы проверить значения переменных и состояние системы. В следующей таблице описаны задачи, часто выполняемые при отладке, такие как шаги с обходом, заходом и выходом:

| Задача отладки |                                                                                                                   Description                                                                                                                    |                                                      Способ выполнения в интегрированной среде сценариев PowerShell                                                       |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Шаг с заходом**  | Выполняет текущий оператор и останавливается на следующем операторе. Если текущий оператор является вызовом функции или сценария, отладчик выполняет их по шагам. В противном случае он останавливается на следующем операторе.                      | Нажмите клавишу <kbd>F11</kbd>, выберите **Step Into** (Шаг с заходом) в меню **Debug** (Отладка) или введите `S` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>.                 |
| **Шаг с обходом**  | Выполняет текущий оператор и останавливается на следующем операторе. Если текущий оператор является вызовом функции или сценария, отладчик выполняет их полностью и останавливается на операторе, следующем после этого вызова. | Нажмите клавишу <kbd>F10</kbd>, выберите **Step Over** (Шаг с обходом) в меню **Debug** (Отладка) или введите `V` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>.                 |
| **Шаг с выходом**   | Выходит из текущей функции и переходит на один уровень выше, если функция является вложенной. Если выполняется тело главной функции, сценарий выполняется до конца или до следующей точки останова. Пропущенные операторы выполняются, но в них отладчик не останавливается.                   | Нажмите клавиши <kbd>SHIFT</kbd>+<kbd>F11</kbd>, выберите команду **Step Out** (Шаг с выходом) в меню **Debug** (Отладка) или введите `O` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>. |
| **Продолжить**   | Продолжает выполнение до конца или до следующей точки останова. Пропущенные функции и вызовы выполняются, но в них отладчик не останавливается.                                                                                                          | Нажмите клавишу <kbd>F5</kbd>, выберите **Run/Continue** (Выполнить/продолжить) в меню **Debug** (Отладка) или введите `C` в области консоли и нажмите клавишу <kbd>ВВОД</kbd>.               |

## <a name="how-to-display-the-values-of-variables-while-debugging"></a>Отображение значений переменных при отладке

При пошаговом выполнении кода можно отобразить текущие значения переменных в сценарии.

### <a name="to-display-the-values-of-standard-variables"></a>Отображение значений стандартных переменных

Используйте один из следующих методов.

- В области сценариев наведите указатель на переменную, чтобы отобразить ее значение в подсказке.

- В области консоли введите имя переменной и нажмите клавишу <kbd>ВВОД</kbd>.

Все области в интегрированной среде сценариев всегда относятся к одной области действия. Таким образом, при отладке сценария команды, вводимые в области консоли, выполняются в области сценариев. Это позволяет использовать область консоли для поиска значений переменных и вызова функций, которые определены только в сценарии.

### <a name="to-display-the-values-of-automatic-variables"></a>Отображение значений автоматических переменных

Описанный выше метод позволяет отобразить значения почти всех переменных при отладке сценария. Однако он не работает для следующих автоматических переменных:

- `$_`

- `$Input`

- `$MyInvocation`

- `$PSBoundParameters`

- `$Args`

При попытке отобразить значение любой из этих переменных отображается значение переменной из внутреннего конвейера отладчика, а не переменной в сценарии. Для некоторых переменных (`$_`, `$Input`, `$MyInvocation`, `$PSBoundParameters` и `$Args`) это можно обойти с помощью следующего метода.

1. Присвойте значение автоматической переменной в сценарии новой переменной.

1. Отобразите значение новой переменной, наведя на нее указатель мыши в области сценариев или введя ее имя в области консоли.

Например, чтобы отобразить значение переменной `$MyInvocation` в сценарии, присвойте ее значение новой переменной, например `$scriptName`, а затем наведите указатель мыши на переменную `$scriptName` или введите ее для отображения значения.

```powershell
# In C:\ps-test\MyScript.ps1
$scriptName = $MyInvocation.MyCommand.Path
```

```PowerShell
# In the Console Pane:
.\MyScript.ps1
$scriptName
```

```Output
C:\ps-test\MyScript.ps1
```

## <a name="see-also"></a>См. также:

- [Обзор интегрированной среды скриптов Windows PowerShell](exploring-the-windows-powershell-ise.md)
