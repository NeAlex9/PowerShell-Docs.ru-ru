---
ms.date: 07/10/2019
keywords: jea,powershell,безопасность
title: Вопросы безопасности JEA
ms.openlocfilehash: befc24fec368c4f6d60477daf63bf17e9431133e
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "70017775"
---
# <a name="jea-security-considerations"></a><span data-ttu-id="a7a92-103">Вопросы безопасности JEA</span><span class="sxs-lookup"><span data-stu-id="a7a92-103">JEA Security Considerations</span></span>

<span data-ttu-id="a7a92-104">JEA помогает повысить уровень безопасности за счет сокращения числа постоянных администраторов на компьютерах.</span><span class="sxs-lookup"><span data-stu-id="a7a92-104">JEA helps you improve your security posture by reducing the number of permanent administrators on your machines.</span></span> <span data-ttu-id="a7a92-105">JEA использует конфигурацию сеанса PowerShell, чтобы создать новую точку входа пользователей для управления системой.</span><span class="sxs-lookup"><span data-stu-id="a7a92-105">JEA uses a PowerShell session configuration to create a new entry point for users to manage the system.</span></span> <span data-ttu-id="a7a92-106">Пользователи, которым требуется повышенный (но не неограниченный) уровень доступа к компьютеру для выполнения административных задач, могут получить доступ к конечной точке JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-106">Users who need elevated, but not unlimited, access to the machine to do administrative tasks can be granted access to the JEA endpoint.</span></span> <span data-ttu-id="a7a92-107">Поскольку JEA разрешает им запускать команды администратора без полного административного доступа, их можно удалить из высокопривилегированных групп безопасности.</span><span class="sxs-lookup"><span data-stu-id="a7a92-107">Since JEA allows these users to run admin commands without having full admin access, you can then remove those users from highly privileged security groups.</span></span>

## <a name="run-as-account"></a><span data-ttu-id="a7a92-108">Учетная запись запуска от имени</span><span class="sxs-lookup"><span data-stu-id="a7a92-108">Run-As account</span></span>

<span data-ttu-id="a7a92-109">Каждой конечной точке JEA назначена отдельная учетная запись **запуска от имени**.</span><span class="sxs-lookup"><span data-stu-id="a7a92-109">Each JEA endpoint has a designated **run-as** account.</span></span> <span data-ttu-id="a7a92-110">Это учетная запись, от имени которой выполняются действия подключающегося пользователя.</span><span class="sxs-lookup"><span data-stu-id="a7a92-110">This is the account under which the connecting user's actions are executed.</span></span> <span data-ttu-id="a7a92-111">Эта учетная запись настраивается в [файле конфигурации сеанса](session-configurations.md), и ее выбор оказывает значительное влияние на безопасность конечной точки.</span><span class="sxs-lookup"><span data-stu-id="a7a92-111">This account is configurable in the [session configuration file](session-configurations.md), and the account you choose has a significant bearing on the security of your endpoint.</span></span>

<span data-ttu-id="a7a92-112">Рекомендуемым способом настройки учетной записи **запуска от имени** являются **виртуальные учетные записи**.</span><span class="sxs-lookup"><span data-stu-id="a7a92-112">**Virtual accounts** are the recommended way of configuring the **run-as** account.</span></span> <span data-ttu-id="a7a92-113">Виртуальные учетные записи — это одноразовые временные локальные учетные записи, созданные для использования подключающимся пользователем во время сеанса JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-113">Virtual accounts are one-time, temporary local accounts that are created for the connecting user to use during the duration of their JEA session.</span></span> <span data-ttu-id="a7a92-114">После завершения его сеанса виртуальная учетная запись будет уничтожена, а ее дальнейшее использование станет невозможным.</span><span class="sxs-lookup"><span data-stu-id="a7a92-114">As soon as their session is terminated, the virtual account is destroyed and can't be used anymore.</span></span> <span data-ttu-id="a7a92-115">Подключающийся пользователь не знает учетные данные для виртуальной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="a7a92-115">The connecting user doesn't know the credentials for the virtual account.</span></span> <span data-ttu-id="a7a92-116">Виртуальная учетная запись не может использоваться для доступа к системе другими средствами, такими как удаленный рабочий стол или конечная точка PowerShell без ограничений.</span><span class="sxs-lookup"><span data-stu-id="a7a92-116">The virtual account can't be used to access the system via other means like Remote Desktop or an unconstrained PowerShell endpoint.</span></span>

<span data-ttu-id="a7a92-117">По умолчанию виртуальные учетные записи принадлежат к локальной группе **администраторов** на компьютере.</span><span class="sxs-lookup"><span data-stu-id="a7a92-117">By default, virtual accounts belong to the local **Administrators** group on the machine.</span></span> <span data-ttu-id="a7a92-118">Это дает им полные права на управление всеми компонентами в системе, но не дает прав на управление ресурсами в сети.</span><span class="sxs-lookup"><span data-stu-id="a7a92-118">This gives them full rights to manage anything on the system, but no rights to manage resources on the network.</span></span>
<span data-ttu-id="a7a92-119">При проверке подлинности на других компьютерах контекстом пользователя становится локальная учетная запись компьютера, а не виртуальная учетная запись.</span><span class="sxs-lookup"><span data-stu-id="a7a92-119">When authenticating with other machines, the user context is that of the local computer account, not the virtual account.</span></span>

<span data-ttu-id="a7a92-120">Контроллеры домена — это особый случай, так как понятие группы локальных **администраторов** отсутствует.</span><span class="sxs-lookup"><span data-stu-id="a7a92-120">Domain controllers are a special case since there isn't a local **Administrators** group.</span></span> <span data-ttu-id="a7a92-121">Вместо этого виртуальные учетные записи принадлежат роли **администраторов домена**, следовательно, используя их, можно управлять службами каталогов в контроллере домена.</span><span class="sxs-lookup"><span data-stu-id="a7a92-121">Instead, virtual accounts belong to **Domain Admins** and can manage the directory services on the domain controller.</span></span> <span data-ttu-id="a7a92-122">Использование доменного удостоверения по-прежнему ограничено контроллером домена, где инициирован сеанс JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-122">The domain identity is still restricted for use on the domain controller where the JEA session was instantiated.</span></span> <span data-ttu-id="a7a92-123">Любой доступ к сети производится вместо этого от лица объекта-компьютера контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="a7a92-123">Any network access appears to come from the domain controller computer object instead.</span></span>

<span data-ttu-id="a7a92-124">В обоих случаях можно явно указать, к каким группам безопасности должна принадлежать виртуальная учетная запись.</span><span class="sxs-lookup"><span data-stu-id="a7a92-124">In both cases, you may explicitly define which security groups the virtual account belongs to.</span></span> <span data-ttu-id="a7a92-125">Этой рекомендации стоит придерживаться, когда для задачи не требуются права локального администратора или администратора домена.</span><span class="sxs-lookup"><span data-stu-id="a7a92-125">This is a good practice when the task can be done without local or domain admin privileges.</span></span> <span data-ttu-id="a7a92-126">Если у вас уже определена группа безопасности для администраторов, можно предоставить виртуальной учетной записи членство в этой группе.</span><span class="sxs-lookup"><span data-stu-id="a7a92-126">If you already have a security group defined for your admins, grant the virtual account membership to that group.</span></span> <span data-ttu-id="a7a92-127">Виртуальная учетная запись ограничена локальными группами безопасности на рабочей станции или рядовом сервере.</span><span class="sxs-lookup"><span data-stu-id="a7a92-127">Virtual account group membership is limited to local security groups on workstation and member servers.</span></span> <span data-ttu-id="a7a92-128">На контроллерах домена виртуальные учетные записи должны быть членами группы безопасности домена.</span><span class="sxs-lookup"><span data-stu-id="a7a92-128">On domain controllers, virtual accounts must be members of domain security groups.</span></span>
<span data-ttu-id="a7a92-129">После добавления виртуальной учетной записи в группы безопасности она больше не принадлежит к группам по умолчанию (локальные или доменные администраторы).</span><span class="sxs-lookup"><span data-stu-id="a7a92-129">Once the virtual account has been added to one or more security groups, it no longer belongs to the default groups (local or domain admins).</span></span>

<span data-ttu-id="a7a92-130">В таблице ниже приведены возможные параметры и итоговые разрешения для виртуальных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="a7a92-130">The following table summarizes the possible configuration options and resulting permissions for virtual accounts:</span></span>

|        <span data-ttu-id="a7a92-131">Тип компьютера</span><span class="sxs-lookup"><span data-stu-id="a7a92-131">Computer type</span></span>         | <span data-ttu-id="a7a92-132">Конфигурация виртуальной учетной записи группы</span><span class="sxs-lookup"><span data-stu-id="a7a92-132">Virtual account group configuration</span></span> |                   <span data-ttu-id="a7a92-133">Контекст локального пользователя</span><span class="sxs-lookup"><span data-stu-id="a7a92-133">Local user context</span></span>                    | <span data-ttu-id="a7a92-134">Контекст сетевого пользователя</span><span class="sxs-lookup"><span data-stu-id="a7a92-134">Network user context</span></span> |
| ---------------------------- | ----------------------------------- | ------------------------------------------------------- | -------------------- |
| <span data-ttu-id="a7a92-135">Контроллер домена</span><span class="sxs-lookup"><span data-stu-id="a7a92-135">Domain controller</span></span>            | <span data-ttu-id="a7a92-136">По умолчанию</span><span class="sxs-lookup"><span data-stu-id="a7a92-136">Default</span></span>                             | <span data-ttu-id="a7a92-137">Пользователь домена, член группы "*DOMAIN*\Domain Admins"</span><span class="sxs-lookup"><span data-stu-id="a7a92-137">Domain user, member of '*DOMAIN*\Domain Admins'</span></span>         | <span data-ttu-id="a7a92-138">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="a7a92-138">Computer account</span></span>     |
| <span data-ttu-id="a7a92-139">Контроллер домена</span><span class="sxs-lookup"><span data-stu-id="a7a92-139">Domain controller</span></span>            | <span data-ttu-id="a7a92-140">Группы доменов A и B</span><span class="sxs-lookup"><span data-stu-id="a7a92-140">Domain groups A and B</span></span>               | <span data-ttu-id="a7a92-141">Пользователь домена, член групп "*DOMAIN*\A", "*DOMAIN*\B"</span><span class="sxs-lookup"><span data-stu-id="a7a92-141">Domain user, member of '*DOMAIN*\A', '*DOMAIN*\B'</span></span>       | <span data-ttu-id="a7a92-142">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="a7a92-142">Computer account</span></span>     |
| <span data-ttu-id="a7a92-143">Рядовой сервер или рабочая станция</span><span class="sxs-lookup"><span data-stu-id="a7a92-143">Member server or workstation</span></span> | <span data-ttu-id="a7a92-144">По умолчанию</span><span class="sxs-lookup"><span data-stu-id="a7a92-144">Default</span></span>                             | <span data-ttu-id="a7a92-145">Локальный пользователь, член группы "*BUILTIN*\Administrators"</span><span class="sxs-lookup"><span data-stu-id="a7a92-145">Local user, member of '*BUILTIN*\Administrators'</span></span>        | <span data-ttu-id="a7a92-146">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="a7a92-146">Computer account</span></span>     |
| <span data-ttu-id="a7a92-147">Рядовой сервер или рабочая станция</span><span class="sxs-lookup"><span data-stu-id="a7a92-147">Member server or workstation</span></span> | <span data-ttu-id="a7a92-148">Локальные группы C и D</span><span class="sxs-lookup"><span data-stu-id="a7a92-148">Local groups C and D</span></span>                | <span data-ttu-id="a7a92-149">Локальный пользователь, член групп "*COMPUTER*\C" и "*COMPUTER*\D"</span><span class="sxs-lookup"><span data-stu-id="a7a92-149">Local user, member of '*COMPUTER*\C' and '*COMPUTER*\D'</span></span> | <span data-ttu-id="a7a92-150">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="a7a92-150">Computer account</span></span>     |

<span data-ttu-id="a7a92-151">При просмотре событий аудита безопасности и журналов событий приложений вы увидите, что каждый сеанс пользователя JEA имеет уникальную виртуальную учетную запись.</span><span class="sxs-lookup"><span data-stu-id="a7a92-151">When you look at security audit events and application event logs, you see that each JEA user session has a unique virtual account.</span></span> <span data-ttu-id="a7a92-152">Эта запись помогает отслеживать действия в конечной точке JEA до исходного пользователя, выполнившего команду.</span><span class="sxs-lookup"><span data-stu-id="a7a92-152">This unique account helps you track user actions in a JEA endpoint back to the original user who ran the command.</span></span> <span data-ttu-id="a7a92-153">Имена виртуальных учетных записей соответствуют формату `WinRM Virtual Users\WinRM_VA_<ACCOUNTNUMBER>_<DOMAIN>_<sAMAccountName>`. Например, если пользователь **Alice** в домене **Contoso** перезапускает службы в конечной точке JEA, имя пользователя, связанное с любыми событиями диспетчера служб, будет иметь вид `WinRM Virtual Users\WinRM_VA_1_contoso_alice`.</span><span class="sxs-lookup"><span data-stu-id="a7a92-153">Virtual account names follow the format `WinRM Virtual Users\WinRM_VA_<ACCOUNTNUMBER>_<DOMAIN>_<sAMAccountName>` For example, if user **Alice** in domain **Contoso** restarts a service in a JEA endpoint, the username associated with any service control manager events would be `WinRM Virtual Users\WinRM_VA_1_contoso_alice`.</span></span>

<span data-ttu-id="a7a92-154">**Групповые управляемые учетные записи службы (gMSA)** полезны, когда рядовому серверу требуется доступ к сетевым ресурсам в сеансе JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-154">**Group-managed service accounts (gMSAs)** are useful when a member server needs to have access to network resources in the JEA session.</span></span> <span data-ttu-id="a7a92-155">Примером может быть конечная точка JEA, используемая для управления доступом к службе REST API, размещенной на другом компьютере.</span><span class="sxs-lookup"><span data-stu-id="a7a92-155">For example, when a JEA endpoint is used to control access to a REST API service hosted on a different machine.</span></span> <span data-ttu-id="a7a92-156">Легко писать функции для вызова интерфейсов REST API, но вам потребуется сетевое удостоверение для проверки подлинности в API.</span><span class="sxs-lookup"><span data-stu-id="a7a92-156">It's easy to write functions to invoke the REST APIs, but you need a network identity to authenticate with the API.</span></span> <span data-ttu-id="a7a92-157">Использование групповой управляемой учетной записи службы позволяет сделать "второй прыжок" и при этом управлять доступом компьютеров к этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="a7a92-157">Using a group-managed service account makes the second hop possible while maintaining control over which computers can use the account.</span></span> <span data-ttu-id="a7a92-158">Действующие разрешения учетной записи gMSA определяются группами безопасности (локальные или доменные), к которым она принадлежит.</span><span class="sxs-lookup"><span data-stu-id="a7a92-158">The effective permissions of the gMSA are defined by the security groups (local or domain) to which the gMSA account belongs.</span></span>

<span data-ttu-id="a7a92-159">Когда конечная точка JEA настроена для использования учетной записи gMSA, действия всех пользователей JEA относятся к одной и той же учетной записи gMSA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-159">When a JEA endpoint is configured to use a gMSA, the actions of all JEA users appear to come from the same gMSA.</span></span> <span data-ttu-id="a7a92-160">Единственный способ отслеживания связи действий с конкретным пользователем заключается в определении набора запущенных команд в записи сеанса PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a7a92-160">The only way to trace actions back to a specific user is to identify the set of commands run in a PowerShell session transcript.</span></span>

<span data-ttu-id="a7a92-161">**Сквозные учетные данные** используются, если вы не указываете учетную запись **запуска от имени**.</span><span class="sxs-lookup"><span data-stu-id="a7a92-161">**Pass-thru credentials** are used when you don't specify a **run-as** account.</span></span> <span data-ttu-id="a7a92-162">PowerShell использует учетные данные подключающегося пользователя для выполнения команд на удаленном сервере.</span><span class="sxs-lookup"><span data-stu-id="a7a92-162">PowerShell uses the connecting user's credential to run commands on the remote server.</span></span> <span data-ttu-id="a7a92-163">Для этого вам потребуется предоставить подключающемуся пользователю прямой доступ к привилегированным группам управления.</span><span class="sxs-lookup"><span data-stu-id="a7a92-163">This requires you to grant the connecting user direct access to privileged management groups.</span></span> <span data-ttu-id="a7a92-164">Эта настройка **не** рекомендуется для JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-164">This configuration is **not** recommended for JEA.</span></span> <span data-ttu-id="a7a92-165">Если подключающийся пользователь уже имеет права администратора, можно отказаться от JEA и управлять системой посредством других средств, не имеющих ограничений.</span><span class="sxs-lookup"><span data-stu-id="a7a92-165">If the connecting user already has admin privileges, they can avoid JEA and manage the system via other, unconstrained means.</span></span> <span data-ttu-id="a7a92-166">Дополнительные сведения см. в разделе [Отсутствие защиты от администраторов в JEA](#jea-doesnt-protect-against-admins) ниже.</span><span class="sxs-lookup"><span data-stu-id="a7a92-166">For more information, see the section below on how [JEA doesn't protect against admins](#jea-doesnt-protect-against-admins).</span></span>

<span data-ttu-id="a7a92-167">**Стандартные учетные записи запуска от имени** позволяют задать любую учетную запись пользователя, с использованием которой будет выполняться весь сеанс PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a7a92-167">**Standard run-as accounts** allow you to specify any user account under which the entire PowerShell session runs.</span></span> <span data-ttu-id="a7a92-168">Конфигурации сеанса с исправленными учетными записями **запуска от имени** (с параметром `-RunAsCredential`) не поддерживают JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-168">Session configurations using fixed **run-as** accounts (with the `-RunAsCredential` parameter) aren't JEA-aware.</span></span> <span data-ttu-id="a7a92-169">Определения ролей больше не работают должным образом.</span><span class="sxs-lookup"><span data-stu-id="a7a92-169">Role definitions no longer function as expected.</span></span> <span data-ttu-id="a7a92-170">Каждому пользователю, авторизованному для доступа к конечной точке, назначается одна и та же роль.</span><span class="sxs-lookup"><span data-stu-id="a7a92-170">Every user authorized to access the endpoint is assigned the same role.</span></span>

<span data-ttu-id="a7a92-171">Не следует использовать **RunAsCredential** на конечной точке JEA из-за сложности определения связи действий с конкретными пользователями и отсутствия поддержки для сопоставления пользователей с ролями.</span><span class="sxs-lookup"><span data-stu-id="a7a92-171">You shouldn't use a **RunAsCredential** on a JEA endpoint because it's difficult to trace actions back to specific users and lacks support for mapping users to roles.</span></span>

## <a name="winrm-endpoint-acl"></a><span data-ttu-id="a7a92-172">ACL конечной точки WinRM</span><span class="sxs-lookup"><span data-stu-id="a7a92-172">WinRM Endpoint ACL</span></span>

<span data-ttu-id="a7a92-173">Как и в случае с обычными конечными точками удаленного взаимодействия PowerShell, каждая конечная точка JEA имеет отдельный список управления доступом (ACL), который указывает, кто именно может проходить проверку подлинности на базе конечной точки JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-173">As with regular PowerShell remoting endpoints, each JEA endpoint has a separate access control list (ACL) that controls who can authenticate with the JEA endpoint.</span></span> <span data-ttu-id="a7a92-174">При неправильной настройке доступ к конечной точке JEA может отсутствовать у доверенных пользователей и предоставляться ненадежным пользователям.</span><span class="sxs-lookup"><span data-stu-id="a7a92-174">If improperly configured, trusted users may not be able to access the JEA endpoint and untrusted users may have access.</span></span> <span data-ttu-id="a7a92-175">ACL WinRM не влияет на сопоставление пользователей с ролями JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-175">The WinRM ACL doesn't affect the mapping of users to JEA roles.</span></span> <span data-ttu-id="a7a92-176">Это сопоставление регулируется полем **RoleDefinitions** в файле конфигурации сеанса, который использовался для регистрации конечной точки.</span><span class="sxs-lookup"><span data-stu-id="a7a92-176">Mapping is controlled by the **RoleDefinitions** field in the session configuration file used to register the endpoint.</span></span>

<span data-ttu-id="a7a92-177">По умолчанию, когда конечная точка JEA имеет несколько возможностей ролей, ACL WinRM настраивается так, чтобы разрешить доступ всем сопоставленным пользователям.</span><span class="sxs-lookup"><span data-stu-id="a7a92-177">By default, when a JEA endpoint has multiple role capabilities, the WinRM ACL is configured to allow access to all mapped users.</span></span> <span data-ttu-id="a7a92-178">Например, сеанс JEA, настроенный с помощью указанных ниже команд, будет предоставлять полный доступ к `CONTOSO\JEA_Lev1` и `CONTOSO\JEA_Lev2`.</span><span class="sxs-lookup"><span data-stu-id="a7a92-178">For example, a JEA session configured using the following commands grants full access to `CONTOSO\JEA_Lev1` and `CONTOSO\JEA_Lev2`.</span></span>

```powershell
$roles = @{ 'CONTOSO\JEA_Lev1' = 'Lev1Role'; 'CONTOSO\JEA_Lev2' = 'Lev2Role' }
New-PSSessionConfigurationFile -Path '.\jea.pssc' -SessionType RestrictedRemoteServer -RoleDefinitions $roles -RunAsVirtualAccount
Register-PSSessionConfiguration -Path '.\jea.pssc' -Name 'MyJEAEndpoint'
```

<span data-ttu-id="a7a92-179">Можно проводить аудит разрешений пользователя с помощью командлета [Get-PSSessionConfiguration](/powershell/module/microsoft.powershell.core/get-pssessionconfiguration).</span><span class="sxs-lookup"><span data-stu-id="a7a92-179">You can audit user permissions with the [Get-PSSessionConfiguration](/powershell/module/microsoft.powershell.core/get-pssessionconfiguration) cmdlet.</span></span>

```powershell
Get-PSSessionConfiguration -Name 'MyJEAEndpoint' | Select-Object Permission
```

```Output
Permission
----------
CONTOSO\JEA_Lev1 AccessAllowed
CONTOSO\JEA_Lev2 AccessAllowed
```

<span data-ttu-id="a7a92-180">Чтобы изменить пользователей, имеющих доступ, запустите `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` для вывода интерактивной командной строки или `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` для изменения разрешений.</span><span class="sxs-lookup"><span data-stu-id="a7a92-180">To change which users have access, run either `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` for an interactive prompt or `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` to update the permissions.</span></span> <span data-ttu-id="a7a92-181">Для доступа к конечной точке JEA пользователям требуется по меньшей мере права *вызова*.</span><span class="sxs-lookup"><span data-stu-id="a7a92-181">Users need at least *Invoke* rights to access the JEA endpoint.</span></span>

<span data-ttu-id="a7a92-182">Можно создать конечную точку JEA, которая не сопоставляет каждого пользователя, имеющего доступ, с определенной ролью.</span><span class="sxs-lookup"><span data-stu-id="a7a92-182">It's possible to create a JEA endpoint that doesn't map a defined role to every user that has access.</span></span> <span data-ttu-id="a7a92-183">Такие пользователи могут запустить сеанс JEA, но имеют доступ только к командлетам по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a7a92-183">These users can start a JEA session, but only have access to the default cmdlets.</span></span> <span data-ttu-id="a7a92-184">Можно выполнить аудит разрешений пользователя в конечной точке JEA, запустив `Get-PSSessionCapability`.</span><span class="sxs-lookup"><span data-stu-id="a7a92-184">You can audit user permissions in a JEA endpoint by running `Get-PSSessionCapability`.</span></span> <span data-ttu-id="a7a92-185">Дополнительные сведения см. в разделе [Аудит и отчеты для JEA](audit-and-report.md).</span><span class="sxs-lookup"><span data-stu-id="a7a92-185">For more information, see [Auditing and Reporting on JEA](audit-and-report.md).</span></span>

## <a name="least-privilege-roles"></a><span data-ttu-id="a7a92-186">Роли, предоставляющие минимальные права</span><span class="sxs-lookup"><span data-stu-id="a7a92-186">Least privilege roles</span></span>

<span data-ttu-id="a7a92-187">При разработке ролей JEA важно помнить о том, что виртуальная или групповая управляемая учетная запись, используемая внутри системы, часто имеет неограниченный доступ к локальному компьютеру.</span><span class="sxs-lookup"><span data-stu-id="a7a92-187">When designing JEA roles, it's important to remember that the virtual and group-managed service accounts running behind the scenes can have unrestricted access to the local machine.</span></span> <span data-ttu-id="a7a92-188">Возможности ролей JEA помогают ограничить набор команд и приложений, которые могут выполняться из этого привилегированного контекста.</span><span class="sxs-lookup"><span data-stu-id="a7a92-188">JEA role capabilities help limit the commands and applications that can be run in that privileged context.</span></span>
<span data-ttu-id="a7a92-189">Неправильно спроектированные роли могут разрешать запуск опасных команд, позволяющих пользователю нарушить границы JEA или получить доступ к конфиденциальной информации.</span><span class="sxs-lookup"><span data-stu-id="a7a92-189">Improperly designed roles can allow dangerous commands that may permit a user to break out of the JEA boundaries or obtain access to sensitive information.</span></span>

<span data-ttu-id="a7a92-190">Рассмотрим, например, следующую запись возможности роли:</span><span class="sxs-lookup"><span data-stu-id="a7a92-190">For example, consider the following role capability entry:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\*-Process'
}
```

<span data-ttu-id="a7a92-191">Эта возможность роли позволяет пользователям запустить любой командлет PowerShell с существительным **Process** из модуля **Microsoft.PowerShell.Management**.</span><span class="sxs-lookup"><span data-stu-id="a7a92-191">This role capability allows users to run any PowerShell cmdlet with the noun **Process** from the **Microsoft.PowerShell.Management** module.</span></span> <span data-ttu-id="a7a92-192">Пользователям может потребоваться доступ к таким командлетам, как `Get-Process`, чтобы понять, какие именно приложения запущены в системе, и `Stop-Process`, чтобы завершить приложения, которые не отвечают.</span><span class="sxs-lookup"><span data-stu-id="a7a92-192">Users may need to access cmdlets like `Get-Process` to see what applications are running on the system and `Stop-Process` to kill applications that aren't responding.</span></span> <span data-ttu-id="a7a92-193">Однако данная запись также разрешает `Start-Process`, который можно использовать для запуска произвольной программы с полными правами администратора.</span><span class="sxs-lookup"><span data-stu-id="a7a92-193">However, this entry also allows `Start-Process`, which can be used to start up an arbitrary program with full administrator permissions.</span></span> <span data-ttu-id="a7a92-194">Программа не обязана быть установлена локально в системе.</span><span class="sxs-lookup"><span data-stu-id="a7a92-194">The program doesn't need to be installed locally on the system.</span></span> <span data-ttu-id="a7a92-195">Подключенный пользователь может запустить программу из общей папки, где у него есть права локального администратора, выполнять вредоносные программы и многое другое.</span><span class="sxs-lookup"><span data-stu-id="a7a92-195">A connected user could start a program from a file share that gives the user local admin privileges, runs malware, and more.</span></span>

<span data-ttu-id="a7a92-196">Более безопасная версия этой же возможности роли выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a7a92-196">A more secure version of this same role capability would look like:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\Get-Process', 'Microsoft.PowerShell.Management\Stop-Process'
}
```

<span data-ttu-id="a7a92-197">Избегайте подстановочных знаков в возможностях ролей.</span><span class="sxs-lookup"><span data-stu-id="a7a92-197">Avoid using wildcards in role capabilities.</span></span> <span data-ttu-id="a7a92-198">Не забудьте регулярно проводить [аудит действующих разрешений пользователей](audit-and-report.md#check-effective-rights-for-a-specific-user), чтобы понять, какие команды доступны пользователям.</span><span class="sxs-lookup"><span data-stu-id="a7a92-198">Be sure to regularly [audit effective user permissions](audit-and-report.md#check-effective-rights-for-a-specific-user) to understand which commands are accessible to the user.</span></span>

## <a name="jea-doesnt-protect-against-admins"></a><span data-ttu-id="a7a92-199">Отсутствие защиты от администраторов в JEA</span><span class="sxs-lookup"><span data-stu-id="a7a92-199">JEA doesn't protect against admins</span></span>

<span data-ttu-id="a7a92-200">Одним из основных принципов функции JEA является то, что она позволяет пользователям без прав администратора выполнять некоторые задачи администрирования.</span><span class="sxs-lookup"><span data-stu-id="a7a92-200">One of the core principles of JEA is that it allows non-admins to do some admin tasks.</span></span> <span data-ttu-id="a7a92-201">JEA не защищает от тех пользователей, кто уже обладает правами администратора.</span><span class="sxs-lookup"><span data-stu-id="a7a92-201">JEA doesn't protect against users who already have administrator privileges.</span></span> <span data-ttu-id="a7a92-202">**Администраторы домена**, локальные **администраторы** или другие высокопривилегированные группы могут обойти средства защиты JEA другими средствами.</span><span class="sxs-lookup"><span data-stu-id="a7a92-202">Users who belong **Domain Admins**, local **Administrators**, or other highly privileged groups can circumvent JEA's protections via another means.</span></span> <span data-ttu-id="a7a92-203">Например, они могут войти в систему с помощью протокола удаленного рабочего стола, использовать удаленные консоли MMC или подключиться к конечным точкам PowerShell, не имеющим ограничений.</span><span class="sxs-lookup"><span data-stu-id="a7a92-203">For example, they could sign in with RDP, use remote MMC consoles, or connect to unconstrained PowerShell endpoints.</span></span> <span data-ttu-id="a7a92-204">Локальные администраторы могут также изменить конфигурацию JEA, чтобы дать доступ другим пользователям, либо изменить возможность роли, расширив область действия пользователя в своем сеансе JEA.</span><span class="sxs-lookup"><span data-stu-id="a7a92-204">Also, local admins on a system can modify JEA configurations to allow additional users or change a role capability to extend the scope of what a user can do in their JEA session.</span></span> <span data-ttu-id="a7a92-205">Важно оценить расширенные разрешения пользователей JEA и попытаться определить другие способы, с помощью которых они могут получить привилегированный доступ к системе.</span><span class="sxs-lookup"><span data-stu-id="a7a92-205">It's important to evaluate your JEA users' extended permissions to see if there are other ways to gain privileged access to the system.</span></span>

<span data-ttu-id="a7a92-206">Распространенной практикой является использование JEA для регулярного повседневного обслуживания и наличие решения по управлению привилегированным доступом JIT, что позволяет пользователям временно становиться локальными администраторами в аварийных ситуациях.</span><span class="sxs-lookup"><span data-stu-id="a7a92-206">A common practice is to use JEA for regular day-to-day maintenance and have a just-in-time, privileged access management solution that allows users to temporarily become local admins in emergency situations.</span></span> <span data-ttu-id="a7a92-207">При этом пользователи не являются постоянными администраторами системы и могут получить подобные права только после завершения рабочего процесса, регулирующего использование ими таких разрешений.</span><span class="sxs-lookup"><span data-stu-id="a7a92-207">This helps ensure users aren't permanent admins on the system, but can get those rights if, and only when, they complete a workflow that documents their use of those permissions.</span></span>
