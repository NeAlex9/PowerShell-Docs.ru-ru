---
ms.date: 12/12/2018
keywords: dsc,powershell,конфигурация,установка
title: Настройка LCM в PowerShell 4.0
ms.openlocfilehash: 747b15c483c79a7ecbb62214ef5a59f8dc137bd4
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "71953831"
---
# <a name="configuring-the-lcm-in-powershell-40"></a><span data-ttu-id="2cf51-103">Настройка LCM в PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="2cf51-103">Configuring the LCM in PowerShell 4.0</span></span>

><span data-ttu-id="2cf51-104">Область применения: Windows PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="2cf51-104">Applies To: Windows PowerShell 4.0</span></span>

<span data-ttu-id="2cf51-105">**Сведения, относящиеся к Windows PowerShell 5.0 и более поздней версии, см. в разделе [Настройка локального диспетчера конфигураций](metaConfig.md).**</span><span class="sxs-lookup"><span data-stu-id="2cf51-105">**For information related to Windows PowerShell 5.0 and later, see [Configuring the Local Configuration Manager](metaConfig.md).**</span></span>

<span data-ttu-id="2cf51-106">Локальный диспетчер конфигураций — это механизм настройки требуемого состояния (DSC) Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2cf51-106">Local Configuration Manager is the Windows PowerShell Desired State Configuration (DSC) engine.</span></span>
<span data-ttu-id="2cf51-107">Он работает на всех целевых узлах и отвечает за вызов ресурсов конфигураций, включенных в сценарий конфигурации DSC.</span><span class="sxs-lookup"><span data-stu-id="2cf51-107">It runs on all target nodes, and it is responsible for calling the configuration resources that are included in a DSC configuration script.</span></span>
<span data-ttu-id="2cf51-108">В этом разделе перечислены свойства локального диспетчера конфигураций и описано, как изменять параметры локального диспетчера конфигурации на целевом узле.</span><span class="sxs-lookup"><span data-stu-id="2cf51-108">This topic lists the properties of Local Configuration Manager and describes how you can modify the Local Configuration Manager settings on a target node.</span></span>

## <a name="local-configuration-manager-properties"></a><span data-ttu-id="2cf51-109">Свойства локального диспетчера конфигураций</span><span class="sxs-lookup"><span data-stu-id="2cf51-109">Local Configuration Manager properties</span></span>

<span data-ttu-id="2cf51-110">Ниже перечислены свойства локального диспетчера конфигураций, которые можно задавать или извлекать.</span><span class="sxs-lookup"><span data-stu-id="2cf51-110">The following lists the Local Configuration Manager properties that you can set or retrieve.</span></span>

- <span data-ttu-id="2cf51-111">**AllowModuleOverwrite**: определяет, могут ли новые конфигурации, которые скачиваются из службы настройки, перезаписывать старые конфигурации, уже находящиеся в целевом узле.</span><span class="sxs-lookup"><span data-stu-id="2cf51-111">**AllowModuleOverwrite**: Controls whether new configurations downloaded from the configuration service are allowed to overwrite the old ones on the target node.</span></span> <span data-ttu-id="2cf51-112">Возможные значения — True и False.</span><span class="sxs-lookup"><span data-stu-id="2cf51-112">Possible values are True and False.</span></span>
- <span data-ttu-id="2cf51-113">**CertificateID**: Отпечаток сертификата, защищающего учетные данные, которые передаются в конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="2cf51-113">**CertificateID**: The thumbprint of a certificate used to secure credentials passed in a configuration.</span></span> <span data-ttu-id="2cf51-114">Дополнительные сведения см. в статье [Защита учетных данных в службе настройки требуемого состояния Windows PowerShell](https://blogs.msdn.microsoft.com/powershell/2014/01/31/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/).</span><span class="sxs-lookup"><span data-stu-id="2cf51-114">For more information see [Want to secure credentials in Windows PowerShell Desired State Configuration?](https://blogs.msdn.microsoft.com/powershell/2014/01/31/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/).</span></span>
- <span data-ttu-id="2cf51-115">**ConfigurationID**: GUID, используемый для получения определенного файла конфигурации из опрашивающей службы.</span><span class="sxs-lookup"><span data-stu-id="2cf51-115">**ConfigurationID**: Indicates a GUID which is used to get a particular configuration file from a pull service.</span></span> <span data-ttu-id="2cf51-116">Этот GUID обеспечивает доступ к нужному файлу конфигурации.</span><span class="sxs-lookup"><span data-stu-id="2cf51-116">The GUID ensures that the correct configuration file is accessed.</span></span>
- <span data-ttu-id="2cf51-117">**ConfigurationMode**: указывает, как именно локальный диспетчер конфигураций применяет конфигурацию к целевым узлам.</span><span class="sxs-lookup"><span data-stu-id="2cf51-117">**ConfigurationMode**: Specifies how the Local Configuration Manager actually applies the configuration to the target nodes.</span></span> <span data-ttu-id="2cf51-118">Этот параметр может принимать перечисленные ниже значения.</span><span class="sxs-lookup"><span data-stu-id="2cf51-118">It can take the following values:</span></span>
  - <span data-ttu-id="2cf51-119">**ApplyOnly**: если выбран этот параметр, DSC применяет конфигурацию и не выполняет никаких действий, пока не будет обнаружена новая конфигурация. Это произойдет, если вы принудительно отправите новую конфигурацию в целевой узел или подключите опрашивающую службу, а DSC обнаружит новую конфигурацию при ее проверке.</span><span class="sxs-lookup"><span data-stu-id="2cf51-119">**ApplyOnly**: With this option, DSC applies the configuration and does nothing further unless a new configuration is detected, either by you sending a new configuration directly to the target node or if you are connecting to a pull service and DSC discovers a new configuration when it checks with the pull service.</span></span> <span data-ttu-id="2cf51-120">При расхождениях с конфигурацией на целевом узле никакие действия не предпринимаются.</span><span class="sxs-lookup"><span data-stu-id="2cf51-120">If the target node's configuration drifts, no action is taken.</span></span>
  - <span data-ttu-id="2cf51-121">**ApplyAndMonitor**: если выбран этот параметр (он используется по умолчанию), DSC применяет все новые конфигурации, как отправленные вами в целевой узел, так и обнаруженные в опрашивающей службе.</span><span class="sxs-lookup"><span data-stu-id="2cf51-121">**ApplyAndMonitor**: With this option (which is the default), DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="2cf51-122">Затем, если конфигурация на целевом узле отличается от файла конфигурации, DSC сообщает о расхождении в журналах.</span><span class="sxs-lookup"><span data-stu-id="2cf51-122">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs.</span></span> <span data-ttu-id="2cf51-123">Дополнительные сведения о ведении журналов DSC см. в статье [Использование журналов событий для диагностики ошибок в службе настройки требуемого состояния](https://blogs.msdn.com/b/powershell/archive/2014/01/03/using-event-logs-to-diagnose-errors-in-desired-state-configuration.aspx).</span><span class="sxs-lookup"><span data-stu-id="2cf51-123">For more about DSC logging, see [Using Event Logs to Diagnose Errors in Desired State Configuration](https://blogs.msdn.com/b/powershell/archive/2014/01/03/using-event-logs-to-diagnose-errors-in-desired-state-configuration.aspx).</span></span>
  - <span data-ttu-id="2cf51-124">**ApplyAndAutoCorrect**: если выбран этот параметр, DSC применяет все новые конфигурации, как отправленные вами в целевой узел, так и обнаруженные в опрашивающей службе.</span><span class="sxs-lookup"><span data-stu-id="2cf51-124">**ApplyAndAutoCorrect**: With this option, DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="2cf51-125">Затем, если конфигурация на целевом узле отличается от файла конфигурации, DSC сообщает о расхождении в журналах и пытается привести конфигурацию на целевом узле в соответствие с файлом конфигурации.</span><span class="sxs-lookup"><span data-stu-id="2cf51-125">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs, and then attempts to adjust the target node configuration to bring in compliance with the configuration file.</span></span>
- <span data-ttu-id="2cf51-126">**ConfigurationModeFrequencyMins**: представляет частоту (в минутах), с которой фоновое приложение DSC осуществляет попытки применить текущую конфигурацию для целевого узла.</span><span class="sxs-lookup"><span data-stu-id="2cf51-126">**ConfigurationModeFrequencyMins**: Represents the frequency (in minutes) at which the background application of DSC attempts to implement the current configuration on the target node.</span></span> <span data-ttu-id="2cf51-127">Значение по умолчанию — 15.</span><span class="sxs-lookup"><span data-stu-id="2cf51-127">The default value is 15.</span></span> <span data-ttu-id="2cf51-128">Это свойство может быть задано в сочетании со свойством RefreshMode.</span><span class="sxs-lookup"><span data-stu-id="2cf51-128">This value can be set in conjunction with RefreshMode.</span></span> <span data-ttu-id="2cf51-129">Если свойство RefreshMode имеет значение PULL, целевой узел подключается к службе настройки с интервалом, заданным свойством RefreshFrequencyMins, и загружает текущую конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="2cf51-129">When RefreshMode is set to PULL, the target node contacts the configuration service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="2cf51-130">Независимо от значения свойства RefreshMode модуль обеспечения согласованности применяет последнюю конфигурацию, загруженную на целевой узел, с интервалом, заданным свойством ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="2cf51-130">Regardless of the RefreshMode value, at the interval set by ConfigurationModeFrequencyMins, the consistency engine applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="2cf51-131">Значение свойства RefreshFrequencyMins должно быть выражено целым числом, кратным значению свойства ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="2cf51-131">RefreshFrequencyMins should be set to an integer multiple of ConfigurationModeFrequencyMins.</span></span>
- <span data-ttu-id="2cf51-132">**Credential**: указывает учетные данные (как при использовании командлета Get-Credential), необходимые для доступа к удаленным ресурсам, например для подключения к службе настройки.</span><span class="sxs-lookup"><span data-stu-id="2cf51-132">**Credential**: Indicates credentials (as with Get-Credential) required to access remote resources, such as to contact the configuration service.</span></span>
- <span data-ttu-id="2cf51-133">**DownloadManagerCustomData**: представляет массив, который содержит пользовательские данные, относящиеся к диспетчеру загрузки.</span><span class="sxs-lookup"><span data-stu-id="2cf51-133">**DownloadManagerCustomData**: Represents an array that contains custom data specific to the download manager.</span></span>
- <span data-ttu-id="2cf51-134">**DownloadManagerName**: указывает имя конфигурации и диспетчер загрузки модулей.</span><span class="sxs-lookup"><span data-stu-id="2cf51-134">**DownloadManagerName**: Indicates the name of the configuration and module download manager.</span></span>
- <span data-ttu-id="2cf51-135">**RebootNodeIfNeeded**: задайте значение `$true`, разрешающее ресурсам перезагружать узел, с помощью флага `$global:DSCMachineStatus`.</span><span class="sxs-lookup"><span data-stu-id="2cf51-135">**RebootNodeIfNeeded**: Set this to `$true` to allow resources to reboot the Node using the `$global:DSCMachineStatus` flag.</span></span> <span data-ttu-id="2cf51-136">В противном случае для каждой такой конфигурации узел придется перезагружать вручную.</span><span class="sxs-lookup"><span data-stu-id="2cf51-136">Otherwise, you will have to manually reboot the node for any configuration that requires it.</span></span> <span data-ttu-id="2cf51-137">Значение по умолчанию — `$false`.</span><span class="sxs-lookup"><span data-stu-id="2cf51-137">The default value is `$false`.</span></span> <span data-ttu-id="2cf51-138">Чтобы использовать этот параметр, если условие перезагрузки инициируется не с помощью DSC (а например, установщика Windows), объедините этот параметр с модулем [xPendingReboot](https://github.com/powershell/xpendingreboot).</span><span class="sxs-lookup"><span data-stu-id="2cf51-138">To use this setting when a reboot condition is enacted by something other than DSC (such as Windows Installer), combine this setting with the [xPendingReboot](https://github.com/powershell/xpendingreboot) module.</span></span>
- <span data-ttu-id="2cf51-139">**RefreshFrequencyMins**: используется при настройке опрашивающей службы.</span><span class="sxs-lookup"><span data-stu-id="2cf51-139">**RefreshFrequencyMins**: Used when you have set up a pull service.</span></span> <span data-ttu-id="2cf51-140">Представляет частоту (в минутах), с которой локальный диспетчер конфигураций подключается к опрашивающей службе для скачивания текущей конфигурации.</span><span class="sxs-lookup"><span data-stu-id="2cf51-140">Represents the frequency (in minutes) at which the Local Configuration Manager contacts a pull service to download the current configuration.</span></span> <span data-ttu-id="2cf51-141">Это свойство может быть задано в сочетании со свойством ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="2cf51-141">This value can be set in conjunction with ConfigurationModeFrequencyMins.</span></span> <span data-ttu-id="2cf51-142">Если свойство RefreshMode имеет значение PULL, целевой узел подключается к опрашивающей службе с интервалом, заданным свойством RefreshFrequencyMins, и скачивает текущую конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="2cf51-142">When RefreshMode is set to PULL, the target node contacts the pull service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="2cf51-143">Модуль обеспечения согласованности применяет последнюю конфигурацию, загруженную на целевой узел, с интервалом, заданным свойством ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="2cf51-143">At the interval set by ConfigurationModeFrequencyMins, the consistency engine then applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="2cf51-144">Если значение свойства RefreshFrequencyMins не выражено целым числом, кратным значению свойства ConfigurationModeFrequencyMins, система его округлит.</span><span class="sxs-lookup"><span data-stu-id="2cf51-144">If RefreshFrequencyMins is not set to an integer multiple of ConfigurationModeFrequencyMins, the system will round it up.</span></span> <span data-ttu-id="2cf51-145">Значение по умолчанию — 30.</span><span class="sxs-lookup"><span data-stu-id="2cf51-145">The default value is 30.</span></span>
- <span data-ttu-id="2cf51-146">**RefreshMode**: возможные значения — **Push** (по умолчанию) и **Pull**.</span><span class="sxs-lookup"><span data-stu-id="2cf51-146">**RefreshMode**: Possible values are **Push** (the default) and **Pull**.</span></span> <span data-ttu-id="2cf51-147">Если выбрана конфигурация push, файл конфигурации необходимо разместить на каждом целевом узле, используя любой клиентский компьютер.</span><span class="sxs-lookup"><span data-stu-id="2cf51-147">In the "push" configuration, you must place a configuration file on each target node, using any client computer.</span></span> <span data-ttu-id="2cf51-148">В режиме pull необходимо настроить опрашивающую службу для локального диспетчера конфигураций, чтобы он мог подключаться и осуществлять доступ к файлам конфигураций.</span><span class="sxs-lookup"><span data-stu-id="2cf51-148">In the "pull" mode, you must set up a pull service for Local Configuration Manager to contact and access the configuration files.</span></span>

> [!NOTE]
> <span data-ttu-id="2cf51-149">LCM запустит цикл **ConfigurationModeFrequencyMins** на основе:</span><span class="sxs-lookup"><span data-stu-id="2cf51-149">The LCM starts the **ConfigurationModeFrequencyMins** cycle based on:</span></span>
>
> - <span data-ttu-id="2cf51-150">Применяется новая метаконфигурация с помощью `Set-DscLocalConfigurationManager`.</span><span class="sxs-lookup"><span data-stu-id="2cf51-150">A new metaconfig is applied using `Set-DscLocalConfigurationManager`</span></span>
> - <span data-ttu-id="2cf51-151">Перезагрузка компьютера.</span><span class="sxs-lookup"><span data-stu-id="2cf51-151">A machine restart</span></span>
>
> <span data-ttu-id="2cf51-152">В любой ситуации, когда в процессе таймера возникает сбой, который обнаруживается в течение 30 секунд, цикл будет перезапущен.</span><span class="sxs-lookup"><span data-stu-id="2cf51-152">For any condition where the timer process experiences a crash, that will be detected within 30 seconds and the cycle will be restarted.</span></span>
> <span data-ttu-id="2cf51-153">Параллельная операция может задержать запуск цикла, если длительность этой операции превышает настроенную частоту цикла, и очередной таймер не запустится.</span><span class="sxs-lookup"><span data-stu-id="2cf51-153">A concurrent operation could delay the cycle from being started, if the duration of this operation exceeds the configured cycle frequency, the next timer will not start.</span></span>
>
> <span data-ttu-id="2cf51-154">Например, метаконфигурация настроена с частотой опроса в 15 минут, и в момент T1 происходит опрос.</span><span class="sxs-lookup"><span data-stu-id="2cf51-154">Example, the metaconfig is configured at a 15 minute pull frequency and a pull occurs at T1.</span></span>  <span data-ttu-id="2cf51-155">Узел не завершает работу 16 минут.</span><span class="sxs-lookup"><span data-stu-id="2cf51-155">The Node does not finish work for 16 minutes.</span></span>  <span data-ttu-id="2cf51-156">Первый 15-минутный цикл игнорируется, и далее запрос произойдет в момент T1+15+15.</span><span class="sxs-lookup"><span data-stu-id="2cf51-156">The first 15 minute cycle is ignored, and next pull will happen at T1+15+15.</span></span>

### <a name="example-of-updating-local-configuration-manager-settings"></a><span data-ttu-id="2cf51-157">Примеры обновления настроек локального диспетчера конфигураций</span><span class="sxs-lookup"><span data-stu-id="2cf51-157">Example of updating Local Configuration Manager settings</span></span>

<span data-ttu-id="2cf51-158">Настройки локального диспетчера конфигураций на целевом узле можно обновить, включив блок **LocalConfigurationManager** в блоке узла в сценарий конфигурации, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="2cf51-158">You can update the Local Configuration Manager settings of a target node by including a **LocalConfigurationManager** block inside the node block in a configuration script, as shown in the following example.</span></span>

```powershell
Configuration ExampleConfig
{
    Node "Server001"
    {
        LocalConfigurationManager
        {
            ConfigurationID = "646e48cb-3082-4a12-9fd9-f71b9a562d4e"
            ConfigurationModeFrequencyMins = 45
            ConfigurationMode = "ApplyAndAutocorrect"
            RefreshMode = "Pull"
            RefreshFrequencyMins = 90
            DownloadManagerName = "WebDownloadManager"
            DownloadManagerCustomData = (@{ServerUrl="https://$PullService/psdscpullserver.svc"})
            CertificateID = "71AA68562316FE3F73536F1096B85D66289ED60E"
            Credential = $cred
            RebootNodeIfNeeded = $true
            AllowModuleOverwrite = $false
        }
# One or more resource blocks can be added here
    }
}

# The following line invokes the configuration and creates a file called Server001.meta.mof at the specified path
ExampleConfig -OutputPath "c:\users\public\dsc"
```

<span data-ttu-id="2cf51-159">При выполнении сценария из предыдущего примера создается MOF-файл с желаемыми настройками.</span><span class="sxs-lookup"><span data-stu-id="2cf51-159">Running the script in the previous example generates a MOF file that specifies and stores the desired settings.</span></span>
<span data-ttu-id="2cf51-160">Для применения настроек используйте командлет **Set-DscLocalConfigurationManager**, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="2cf51-160">To apply the settings, you can use the **Set-DscLocalConfigurationManager** cmdlet, as shown in the following example.</span></span>

```powershell
Set-DscLocalConfigurationManager -Path "c:\users\public\dsc"
```

> [!NOTE]
> <span data-ttu-id="2cf51-161">Для параметра **Path** необходимо указать тот же путь, который был указан для параметра **OutputPath** при вызове конфигурации в предыдущем примере.</span><span class="sxs-lookup"><span data-stu-id="2cf51-161">For the **Path** parameter, you must specify the same path that you specified for the **OutputPath** parameter when you invoked the configuration in the previous example.</span></span>

<span data-ttu-id="2cf51-162">Для просмотра текущих настроек локального диспетчера конфигураций можно использовать командлет **Get-DscLocalConfigurationManager**.</span><span class="sxs-lookup"><span data-stu-id="2cf51-162">To see the current Local Configuration Manager settings, you can use the **Get-DscLocalConfigurationManager** cmdlet.</span></span>
<span data-ttu-id="2cf51-163">Если вызвать этот командлет без параметров, он по умолчанию получит настройки локального диспетчера конфигураций для узла, на котором был выполнен.</span><span class="sxs-lookup"><span data-stu-id="2cf51-163">If you invoke this cmdlet with no parameters, by default it will get the Local Configuration Manager settings for the node on which you run it.</span></span>
<span data-ttu-id="2cf51-164">Чтобы указать другой узел, задайте в этом командлете параметр **CimSession**.</span><span class="sxs-lookup"><span data-stu-id="2cf51-164">To specify another node, use the **CimSession** parameter with this cmdlet.</span></span>
