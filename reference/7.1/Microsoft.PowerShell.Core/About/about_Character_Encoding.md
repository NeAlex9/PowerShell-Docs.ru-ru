---
description: Описывает, как PowerShell использует кодировку символов для ввода и вывода строковых данных.
Locale: en-US
ms.date: 10/21/2020
online version: https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_character_encoding?view=powershell-7.1&WT.mc_id=ps-gethelp
schema: 2.0.0
title: О кодировке символов
ms.openlocfilehash: 27a5d818c1ed8e114e15d8a121626fc79101a59f
ms.sourcegitcommit: cc72c40315fd2981d3009b335accbfa52d57640c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2020
ms.locfileid: "96349778"
---
# <a name="about_character_encoding"></a>О кодировке символов

## <a name="short-description"></a>Краткое описание
Описывает, как PowerShell использует кодировку символов для ввода и вывода строковых данных.

## <a name="long-description"></a>Подробное описание

Юникод — это мировой стандарт кодировки символов. Система использует Юникод исключительно для обработки символов и строк. Подробное описание всех аспектов Юникода см. в [стандарте Юникода](https://www.unicode.org/standard/standard.html).

Windows поддерживает Юникод и традиционные наборы символов. Традиционные кодировки, например кодовые страницы Windows, используют 8-разрядные значения или сочетания 8-разрядных значений для представления символов, используемых в определенном языке или географических регионах.

По умолчанию PowerShell использует набор символов Юникода. Однако несколько командлетов имеют параметр **кодирования** , который может указывать кодировку для другой кодировки. Этот параметр позволяет выбрать конкретную кодировку символов, необходимую для взаимодействия с другими системами и приложениями.

Следующие командлеты имеют параметр **Encoding** :

- Microsoft.PowerShell.Management
  - Add-Content
  - Get-Content
  - Set-Content
- Microsoft.PowerShell.Utility
  - Export-Clixml
  - Export-Csv
  - Export-PSSession
  - Format-Hex
  - Import-Csv
  - Out-File
  - Select-String
  - Send-MailMessage

## <a name="the-byte-order-mark"></a>Пометка порядка байтов

Символ-пометка (BOM) — это _сигнатура в Юникоде_ в первых нескольких байтах файла или текстового потока, указывающих, какая кодировка Юникода используется для данных. Дополнительные сведения см. в документации по [метке порядка байтов](/globalization/encoding/byte-order-mark) .

В Windows PowerShell любая Кодировка Юникода, за исключением `UTF7` , всегда создает спецификацию. По умолчанию PowerShell Core имеет значение `utf8NoBOM` для всех текстовых выходных данных.

Для обеспечения оптимальной совместимости Избегайте использования спецификаций в файлах UTF-8. Платформы UNIX и служебные программы Unix-Heritage, которые также используются на платформах Windows, не поддерживают спецификации.

Аналогичным образом `UTF7` следует избегать кодирования. UTF-7 не является стандартной кодировкой Юникода и записывается без спецификации во всех версиях PowerShell.

Создание сценариев PowerShell на платформе, похожем на UNIX, или использовании кросс-платформенного редактора в Windows, например Visual Studio Code, приводит к созданию файла, закодированного с помощью `UTF8NoBOM` . Эти файлы прекрасно работают в PowerShell Core, но могут нарушить работу Windows PowerShell, если файл содержит символы, отличные от ASCII.

Если в скриптах необходимо использовать символы, отличные от ASCII, сохраните их как UTF-8 с помощью BOM. Без спецификации Windows PowerShell ошибочно интерпретирует скрипт как закодированный в устаревшей кодовой странице ANSI. И наоборот, файлы, имеющие СПЕЦИФИКАЦИю UTF-8, могут быть проблематичными для платформ, подобных Unix. Многие средства UNIX, такие как `cat` ,, `sed` `awk` и некоторые редакторы, например, `gedit` не узнают, как обрабатывать спецификацию.

## <a name="character-encoding-in-windows-powershell"></a>Кодировка символов в Windows PowerShell

В PowerShell 5,1 параметр **Encoding** поддерживает следующие значения:

- `Ascii` Использует кодировку ASCII (7-разрядных).
- `BigEndianUnicode` Использует UTF-16 с обратным порядком байтов.
- `BigEndianUTF32` Использует UTF-32 с обратным порядком байтов.
- `Byte` Кодирует набор символов в последовательность байтов.
- `Default` Использует кодировку, соответствующую активной кодовой странице системы (обычно ANSI).
- `Oem` Использует кодировку, соответствующую текущей кодовой странице OEM системы.
- `String` аналогичен `Unicode`.
- `Unicode` Использует UTF-16 с прямым порядком байтов.
- `Unknown` аналогичен `Unicode`.
- `UTF32` Использует UTF-32 с прямым порядком байтов.
- `UTF7` Использует UTF-7.
- `UTF8` Использует UTF-8 (с BOM).

В общем случае Windows PowerShell по умолчанию использует кодировку Юникод [UTF-16LE](https://wikipedia.org/wiki/UTF-16) . Однако кодировка по умолчанию, используемая командлетами в Windows PowerShell, не согласуется.

> [!NOTE]
> При использовании любой кодировки Юникода, за исключением `UTF7` , всегда создает спецификацию.

Для командлетов, записывающих выходные данные в файлы:

- `Out-File` и операторы перенаправления `>` и `>>` создают UTF-16LE, который, в свою очередь, отличается от `Set-Content` и `Add-Content` .

- `New-ModuleManifest` а `Export-CliXml` также создавать файлы UTF-16LE.

- Если целевой файл пуст или не существует, `Set-Content` и `Add-Content` Используйте `Default` кодировку. `Default` — это кодировка, определяемая кодовой страницей устаревшей версии ANSI на языке активного системы.

- `Export-Csv` создает `Ascii` файлы, но использует другую кодировку при использовании параметра **append** (см. ниже).

- `Export-PSSession` по умолчанию создает файлы UTF-8 с BOM.

- `New-Item -Type File -Value` создает файл UTF-8 с кодировкой BOM.

- `Send-MailMessage` по `Default` умолчанию использует кодировку.

- `Start-Transcript` создает `Utf8` файлы с помощью спецификации. При использовании параметра **append** кодировка может отличаться (см. ниже).

Для команд, которые добавляют к существующему файлу:

- `Out-File -Append` и `>>` оператор перенаправления не пытается сопоставить кодировку содержимого существующего целевого файла. Вместо этого они используют кодировку по умолчанию, если не используется параметр **Encoding** . При добавлении содержимого необходимо использовать исходную кодировку файлов.

- При отсутствии явного параметра **кодировки** `Add-Content` обнаруживает существующую кодировку и автоматически применяет ее к новому содержимому. Если имеющееся содержимое не имеет BOM, `Default` используется кодировка ANSI. Поведение аналогично `Add-Content` в PowerShell Core (V6 и более поздних версиях), кроме кодировки по умолчанию — `Utf8` .

- `Export-Csv -Append` соответствует существующей кодировке, если целевой файл содержит СПЕЦИФИКАЦИю. В отсутствие спецификации используется `Utf8` Кодировка.

- `Start-Transcript -Append` соответствует существующей кодировке файлов, включающих СПЕЦИФИКАЦИю. При отсутствии спецификации по умолчанию используется `Ascii` Кодировка. Такая кодировка может привести к утере данных или повреждению символов, если данные в записи содержат многобайтовые символы.

Для командлетов, считывающих строковые данные в отсутствие спецификации:

- `Get-Content` и `Import-PowerShellDataFile` использует `Default` кодировку ANSI. ANSI также используется механизмом PowerShell при чтении исходного кода из файлов.

- `Import-Csv`, `Import-CliXml` и `Select-String` предполагают `Utf8` отсутствие спецификации.

## <a name="character-encoding-in-powershell-core"></a>Кодировка символов в PowerShell Core

В PowerShell Core (V6 и более поздних версий) параметр **Encoding** поддерживает следующие значения:

- `ascii`: Использует кодировку для набора символов ASCII (7-разрядных).
- `bigendianunicode`: Кодируется в формате UTF-16 с обратным порядком байтов.
- `oem`: Использует кодировку по умолчанию для программ MS-DOS и консолей.
- `unicode`: Кодируется в формате UTF-16 с прямым порядком байтов.
- `utf7`: Кодируется в формате UTF-7.
- `utf8`: Кодирует в формате UTF-8 (без спецификации).
- `utf8BOM`: Кодирует в формате UTF-8 с меткой порядка байтов (BOM)
- `utf8NoBOM`: Кодирует в формате UTF-8 без метки порядка байтов (BOM)
- `utf32`: Кодируется в формате UTF-32.

По умолчанию PowerShell Core имеет значение `utf8NoBOM` для всех выходных данных.

Начиная с PowerShell 6,2, параметр **кодировки** также разрешает числовые идентификаторы зарегистрированных кодовых страниц (например `-Encoding 1251` ,) или строковых имен зарегистрированных кодовых страниц (например `-Encoding "windows-1251"` ,). Дополнительные сведения см. в документации .NET по [кодированию. codepage](/dotnet/api/system.text.encoding.codepage).

## <a name="changing-the-default-encoding"></a>Изменение кодировки по умолчанию

В PowerShell есть две переменные по умолчанию, которые можно использовать для изменения поведения кодировки по умолчанию.

- `$PSDefaultParameterValues`
- `$OutputEncoding`

Дополнительные сведения см. в разделе [about_Preference_Variables](about_Preference_Variables.md).

Начиная с PowerShell 5,1, операторы перенаправления ( `>` и `>>` ) вызывают `Out-File` командлет. Таким образом, можно задать кодировку по умолчанию для них с помощью `$PSDefaultParameterValues` переменной предпочтений, как показано в следующем примере:

```powershell
$PSDefaultParameterValues['Out-File:Encoding'] = 'utf8'
```

Используйте следующую инструкцию, чтобы изменить кодировку по умолчанию для всех командлетов, имеющих параметр **Encoding** .

```powershell
$PSDefaultParameterValues['*:Encoding'] = 'utf8'
```

> [!IMPORTANT]
> При размещении этой команды в профиле PowerShell предпочтение влияет на глобальные параметры сеанса, влияющие на все команды и скрипты, которые явно не задают кодировку.
>
> Аналогичным образом следует включить такие команды в скрипты или модули, которые должны вести себя одинаково. Использование этих команд гарантирует, что командлеты ведут себя одинаково даже при запуске другого пользователя, на другом компьютере или в другой версии PowerShell.

Автоматическая переменная `$OutputEncoding` влияет на кодирование, используемое PowerShell для взаимодействия с внешними программами. Он не влияет на кодировку, которую операторы перенаправления вывода и командлеты PowerShell используют для сохранения в файлах.

## <a name="see-also"></a>См. также

- [Общие сведения о кодировании символов в .NET](/dotnet/standard/base-types/character-encoding-introduction)
- [Кодовые страницы — приложения Win32](/windows/win32/intl/code-pages)
- [Стандарт Юникода](https://www.unicode.org/standard/standard.html)
- [Кодирование. кодовая страница](/dotnet/api/system.text.encoding.codepage)
- [UTF-16LE](https://wikipedia.org/wiki/UTF-16)
- [Метка порядка байтов](https://wikipedia.org/wiki/Byte_order_mark)
- [about_Preference_Variables](about_Preference_Variables.md)
