---
description: Описывает, как получить доступ к переменным среды Windows в PowerShell.
keywords: powershell,командлет
Locale: en-US
ms.date: 09/22/2020
online version: https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_environment_variables?view=powershell-7.1&WT.mc_id=ps-gethelp
schema: 2.0.0
title: about_Environment_Variables
ms.openlocfilehash: c954ee6e783b7926dbcd05a3e08b6b9b5cf9bc25
ms.sourcegitcommit: f874dc1d4236e06a3df195d179f59e0a7d9f8436
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "93231701"
---
# <a name="about-environment-variables"></a>Сведения о переменных среды

## <a name="short-description"></a>КРАТКОЕ ОПИСАНИЕ
Описывает, как получить доступ к переменным среды Windows в PowerShell.

## <a name="long-description"></a>ПОДРОБНОЕ ОПИСАНИЕ

Переменные среды хранят сведения о среде операционной системы. Эти сведения включают в себя такие сведения, как путь операционной системы, количество процессоров, используемых операционной системой, и расположение временных папок.

Переменные среды хранят данные, используемые операционной системой и другими программами. Например, `WINDIR` переменная среды содержит расположение каталога установки Windows. Программы могут запрашивать значение этой переменной, чтобы определить, где находятся файлы операционной системы Windows.

PowerShell может обращаться к переменным среды и управлять ими на любой из поддерживаемых платформ операционной системы. Поставщик среды PowerShell упрощает этот процесс, облегчая просмотр и изменение переменных среды.

Переменные среды, в отличие от других типов переменных в PowerShell, наследуются дочерними процессами, такими как локальные фоновые задания и сеансы, в которых выполняются элементы модуля. Это делает переменные среды наиболее подходящими для хранения значений, необходимых как в родительских, так и в дочерних процессах.

## <a name="using-and-changing-environment-variables"></a>Использование и изменение переменных среды

В Windows переменные среды могут быть определены в трех областях:

- Область компьютера (или системы)
- Область пользователей
- Область процесса

Область _процесса_ содержит переменные среды, доступные в текущем процессе, или сеанс PowerShell. Этот список переменных наследуется от родительского процесса и создается из переменных в областях _компьютера_ и _пользователя_ . Платформы на базе UNIX имеют только область _процесса_ .

Можно отображать и изменять значения переменных среды без использования командлета с помощью переменных синтаксиса в поставщике среды. Чтобы отобразить значение переменной среды, используйте следующий синтаксис:

```
$Env:<variable-name>
```

Например, чтобы отобразить значение `WINDIR` переменной среды, введите в командной строке PowerShell следующую команду:

```powershell
$Env:windir
```

В этом синтаксисе знак доллара ( `$` ) указывает на переменную, а имя диска ( `Env:` ) указывает на переменную среды, за которой следует имя переменной ( `windir` ).

Изменение переменных среды в PowerShell влияет только на текущий сеанс. Это поведение напоминает поведение `Set` команды в командной оболочке Windows и `Setenv` команду в средах на базе UNIX. Чтобы изменить значения в областях компьютера или пользователя, необходимо использовать методы класса **System. Environment** .

Чтобы внести изменения в переменные на уровне компьютера, необходимо также иметь разрешение. Если вы попытаетесь изменить значение без достаточных разрешений, команда завершится ошибкой, и в PowerShell отобразится сообщение об ошибке.

Можно изменить значения переменных без использования командлета, используя следующий синтаксис:

```powershell
$Env:<variable-name> = "<new-value>"
```

Например, чтобы добавить `;c:\temp` к значению `Path` переменной среды, используйте следующий синтаксис:

```powershell
$Env:Path += ";c:\temp"
```

В Linux или MacOS двоеточие ( `:` ) в команде отделяет новый путь от пути, расположенного перед ним в списке.

```powershell
$Env:PATH += ":/usr/local/temp"
```

Можно также использовать командлеты Item, такие как `Set-Item` , `Remove-Item` и, `Copy-Item` чтобы изменить значения переменных среды. Например, чтобы использовать `Set-Item` командлет для добавления `;c:\temp` к значению `Path` переменной среды, используйте следующий синтаксис:

```powershell
Set-Item -Path Env:Path -Value ($Env:Path + ";C:\Temp")
```

В этой команде значение заключается в круглые скобки, чтобы интерпретироваться как единое целое.

## <a name="environment-variables-that-store-preferences"></a>Переменные среды, в которых хранятся настройки

Функции PowerShell могут использовать переменные среды для хранения настроек пользователя.
Эти переменные работают подобно переменным предпочтений, но они наследуются дочерними сеансами сеансов, в которых они созданы. Дополнительные сведения о переменных предпочтений см. в разделе [about_preference_variables](about_Preference_Variables.md).

Ниже перечислены переменные среды, в которых хранятся настройки.

- PSExecutionPolicyPreference

  Хранит политику выполнения, заданную для текущего сеанса. Эта переменная среды существует только в том случае, если задана политика выполнения для одного сеанса.
  Это можно сделать двумя разными способами.

  - Запустите сеанс из командной строки с помощью параметра **ExecutionPolicy** , чтобы задать политику выполнения для сеанса.

  - Используйте командлет `Set-ExecutionPolicy`. Используйте параметр Scope со значением "Process".

    Подробнее см. в разделе [about_Execution_Policies](about_Execution_Policies.md).

- псмодулеаналисискачепас

  PowerShell обеспечивает контроль над файлом, используемым для кэширования данных о модулях и их командлетах. Кэш считывается при запуске во время поиска команды и записывается в фоновом потоке после импорта модуля.

  Расположение кэша по умолчанию:

  - Windows PowerShell 5.1: `$env:LOCALAPPDATA\Microsoft\Windows\PowerShell`.
  - PowerShell 6,0 и более поздние версии: `$env:LOCALAPPDATA\Microsoft\PowerShell`
  - По умолчанию не для Windows: `~/.cache/powershell`

  По умолчанию для кэша используется имя файла `ModuleAnalysisCache` . Если установлено несколько экземпляров PowerShell, имя файла включает в себя шестнадцатеричный суффикс, чтобы для каждой установки существовало уникальное имя файла.

  > [!NOTE]
  > Если обнаружение команд работает неправильно, например, в IntelliSense отображаются несуществующие команды, можно удалить файл кэша. Кэш создается повторно при следующем запуске PowerShell.

  Чтобы изменить расположение кэша по умолчанию, задайте переменную среды перед запуском PowerShell. Изменения этой переменной среды влияют только на дочерние процессы. Значение должно быть полным путем (включая имя файла), на создание и запись файлов по которому у среды PowerShell есть разрешение.

  Чтобы отключить файловый кэш, укажите в качестве этого значения недопустимое расположение, например:

  ```powershell
  # `NUL` here is a special device on Windows that cannot be written to,
  # on non-Windows you would use `/dev/null`
  $env:PSModuleAnalysisCachePath = 'NUL'
  ```

  Это задает путь к устройству **NUL** . PowerShell не удается выполнить запись в путь, но ошибка не возвращается. Вы можете увидеть ошибки, о которых сообщили с помощью трассировки:

  ```powershell
  Trace-Command -PSHost -Name Modules -Expression { Import-Module Microsoft.PowerShell.Management -Force }
  ```

- псдисаблемодулеаналисискачеклеануп

  При вызаписи кэша анализа модуля PowerShell проверяет наличие модулей, которые больше не существуют, чтобы избежать необязательного большого объема кэша. Иногда эти проверки нежелательны. в этом случае их можно отключить, задав для этого значения переменной среды значение `1` .

  Установка этой переменной среды вступает в силу немедленно в текущем процессе.

- PSModulePath

  `$env:PSModulePath`Переменная среды содержит список расположений папок, в которых выполняется поиск модулей и ресурсов.

  По умолчанию действующие расположения, назначенные, `$env:PSModulePath` являются:

  - Расположения на уровне системы. Эти папки содержат модули, поставляемые с PowerShell. Модули хранятся в `$PSHOME\Modules` расположении. Кроме того, это расположение, в котором устанавливаются модули управления Windows.

  - Модули, установленные пользователем: это модули, установленные пользователем.
    `Install-Module` имеет параметр **области** , который позволяет указать, установлен ли модуль для текущего пользователя или для всех пользователей. Дополнительные сведения см. в разделе [Install-Module](xref:PowerShellGet.Install-Module).

    - В Windows расположением определяемой пользователем области **CurrentUser** является `$HOME\Documents\PowerShell\Modules` Папка. Областью **ALLUSERS** является расположение `$env:ProgramFiles\PowerShell\Modules` .
    - В системах, отличных от Windows, расположением определяемой пользователем области **CurrentUser** является `$HOME/.local/share/powershell/Modules` Папка. Областью **ALLUSERS** является расположение `/usr/local/share/powershell/Modules` .

  Кроме того, программы установки, устанавливающие модули в других каталогах, например каталог Program Files, могут добавлять свои расположения к значению `$env:PSModulePath` .

  Дополнительные сведения см. в разделе [about_PSModulePath](about_PSModulePath.md).

## <a name="managing-environment-variables"></a>Управление переменными среды

PowerShell предоставляет несколько различных методов для управления переменными среды.

- Диск поставщика среды
- Командлеты элементов
- Класс .NET **System. Environment**
- В Windows Панель управления системы

### <a name="using-the-environment-provider"></a>Использование поставщика среды

Каждая переменная среды представлена экземпляром класса **System. Collections. DictionaryEntry** . В каждом объекте **DictionaryEntry** имя переменной среды является ключом словаря. Значением переменной является значение словаря.

Чтобы отобразить свойства и методы объекта, представляющего переменную среды в PowerShell, используйте `Get-Member` командлет. Например, чтобы отобразить методы и свойства всех объектов на `Env:` диске, введите:

```powershell
Get-Item -Path Env:* | Get-Member
```

Поставщик среды PowerShell позволяет получить доступ к переменным среды на диске PowerShell ( `Env:` диск). Этот диск выглядит примерно так же, как диск файловой системы. Чтобы открыть `Env:` диск, введите:

```powershell
Set-Location Env:
```

Используйте командлеты Content, чтобы получить или задать значения переменной среды.

```powershell
PS Env:\> Set-Content -Path Test -Value 'Test value'
PS Env:\> Get-Content -Path Test
Test value
```

Можно просмотреть переменные среды на `Env:` диске с любого другого диска PowerShell, а также можно перейти на `Env:` диск, чтобы просмотреть и изменить переменные среды.

### <a name="using-item-cmdlets"></a>Использование командлетов Item

При ссылке на переменную среды введите `Env:` имя диска, за которым следует имя переменной. Например, чтобы отобразить значение `COMPUTERNAME` переменной среды, введите:

```powershell
Get-ChildItem Env:Computername
```

Чтобы отобразить значения всех переменных среды, введите:

```powershell
Get-ChildItem Env:
```

Так как переменные среды не имеют дочерних элементов, выходные данные `Get-Item` и `Get-ChildItem` одинаковы.

По умолчанию PowerShell отображает переменные среды в том порядке, в котором они извлекаются. Чтобы отсортировать список переменных среды по имени переменной, необходимо передать выходные данные `Get-ChildItem` команды в `Sort-Object` командлет. Например, с любого диска PowerShell введите:

```powershell
Get-ChildItem Env: | Sort Name
```

Вы также можете войти на `Env:` диск с помощью `Set-Location` командлета:

```powershell
Set-Location Env:
```

Если вы используете `Env:` диск, можно опустить `Env:` имя диска из пути. Например, чтобы отобразить все переменные среды, введите:

```powershell
PS Env:\> Get-ChildItem
```

Чтобы отобразить значение `COMPUTERNAME` переменной в пределах `Env:` диска, введите:

```powershell
PS Env:\> Get-ChildItem ComputerName
```

### <a name="saving-changes-to-environment-variables"></a>Сохранение изменений в переменных среды

Чтобы внести постоянное изменение в переменную среды в Windows, используйте панель управления "система". Выберите **Дополнительные параметры системы** . На вкладке **Дополнительно** щелкните **переменная среды...** . Можно добавлять или изменять существующие переменные среды в области **пользователя** и **системы** (компьютера). Windows записывает эти значения в реестр, чтобы они сохранялись в сеансах и перезапусках системы.

Кроме того, можно добавить или изменить переменные среды в профиле PowerShell. Этот метод работает для любой версии PowerShell на любой поддерживаемой платформе.

### <a name="using-systemenvironment-methods"></a>Использование методов System. Environment

Класс **System. Environment** предоставляет методы **GetEnvironmentVariable** и **SetEnvironmentVariable** , позволяющие указать область действия переменной.

В следующем примере метод **GetEnvironmentVariable** используется для получения параметра компьютера, `PSModulePath` а метод **SetEnvironmentVariable** — для добавления `C:\Program Files\Fabrikam\Modules` пути к значению.

```powershell
$path = [Environment]::GetEnvironmentVariable('PSModulePath', 'Machine')
$newpath = $path + ';C:\Program Files\Fabrikam\Modules'
[Environment]::SetEnvironmentVariable("PSModulePath", $newpath, 'Machine')
```

Дополнительные сведения о методах класса **System. Environment** см. в разделе [методы среды](/dotnet/api/system.environment).

## <a name="see-also"></a>СМ. ТАКЖЕ

- [Среда (поставщик)](../About/about_Environment_Provider.md)
- [about_Modules](about_Modules.md)

