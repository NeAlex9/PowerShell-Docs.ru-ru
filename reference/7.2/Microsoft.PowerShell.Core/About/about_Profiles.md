---
description: Описание создания и использования профиля PowerShell.
ms.date: 11/30/2017
online version: https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_profiles?view=powershell-7.2&WT.mc_id=ps-gethelp
schema: 2.0.0
title: about_Profiles
ms.openlocfilehash: 3c739d6fd65714d5b6ef0f45990b614486d4e5ff
ms.sourcegitcommit: 95d41698c7a2450eeb70ef2fb6507fe7e6eff3b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2020
ms.locfileid: "99602083"
---
# <a name="about-profiles"></a>О профилях

## <a name="short-description"></a>Краткое описание
Описание создания и использования профиля PowerShell.

## <a name="long-description"></a>Полное описание

Можно создать профиль PowerShell для настройки вашей среды и добавления элементов, относящихся к каждому сеансу PowerShell, который вы запускаете.

Профиль PowerShell — это скрипт, выполняющийся при запуске PowerShell. Профиль можно использовать в качестве сценария входа в систему для настройки среды. Вы можете добавлять команды, псевдонимы, функции, переменные, оснастки, модули и диски PowerShell. Можно также добавить в профиль другие элементы, относящиеся к сеансу, чтобы они были доступны в каждом сеансе без необходимости их импорта или повторного создания.

PowerShell поддерживает несколько профилей для пользователей и ведущих программ. Однако профили не создаются. В этом разделе описываются профили и описывается создание и обслуживание профилей на компьютере.

В этом разделе объясняется, как использовать параметр " **Непрофиль** " консоли powershell (PowerShell.exe) для запуска PowerShell без профилей. Кроме того, в нем объясняется воздействие политики выполнения PowerShell на профили.

## <a name="the-profile-files"></a>Файлы профиля

PowerShell поддерживает несколько файлов профилей. Кроме того, ведущие программы PowerShell могут поддерживать собственные профили конкретных узлов.

Например, консоль PowerShell поддерживает следующие файлы с базовым профилем. Профили перечислены в порядке очередности. Первый профиль имеет наивысший приоритет.

|Описание               | Путь                                          |
|--------------------------|-----------------------------------------------|
|Все пользователи, все узлы      |$PSHOME \\Profile.ps1                           |
|Все пользователи, текущий узел   |$PSHOME \\Microsoft.PowerShell_profile.ps1      |
|Текущий пользователь, все узлы   |$Home \\ [мои] документы \\ PowerShell \\Profile.ps1 |
|Текущий пользователь, текущий узел|$Home \\ [мои] документы \\ PowerShell\\<br>Microsoft.PowerShell_profile.ps1 |

Пути к профилю включают следующие переменные:

- `$PSHOME`Переменная, в которой хранится каталог установки для PowerShell.
- `$Home`Переменная, в которой хранится домашний каталог текущего пользователя.

Кроме того, другие программы, на которых размещается PowerShell, могут поддерживать собственные профили. Например, Visual Studio Code поддерживает следующие профили конкретных узлов.

|Описание               | Путь                                     |
|--------------------------|------------------------------------------|
|Все пользователи, текущий узел   |$PSHOME \\Microsoft.VSCode_profile.ps1|
|Текущий пользователь, текущий узел|$Home \\ [мои] документы \\ PowerShell\\<br>Microsoft.VSCode_profile.ps1|

В справке PowerShell профиль "CurrentUser, текущий узел" является профилем, который чаще всего называется "вашим профилем PowerShell".

## <a name="the-profile-variable"></a>Переменная $PROFILE

`$PROFILE`Автоматическая переменная сохраняет пути к профилям PowerShell, доступным в текущем сеансе.

Чтобы просмотреть путь к профилю, отобразите значение `$PROFILE` переменной. Можно также использовать `$PROFILE` переменную в команде для представления пути.

`$PROFILE`Переменная хранит путь к профилю "текущий пользователь, текущий узел". Другие профили сохраняются в свойствах заметки `$PROFILE` переменной.

Например, `$PROFILE` переменная имеет следующие значения в консоли Windows PowerShell.

|Описание                |Имя                              |
|---------------------------|----------------------------------|
|Текущий пользователь, текущий узел |`$PROFILE`                        |
|Текущий пользователь, текущий узел |`$PROFILE.CurrentUserCurrentHost` |
|Текущий пользователь, все узлы    |`$PROFILE.CurrentUserAllHosts`    |
|Все пользователи, текущий узел    |`$PROFILE.AllUsersCurrentHost`    |
|Все пользователи, все узлы       |`$PROFILE.AllUsersAllHosts`       |

Поскольку значения `$PROFILE` переменной изменяются для каждого пользователя и в каждом ведущем приложении, убедитесь, что значения переменных профиля отображаются в каждом используемом хост-приложении PowerShell.

Чтобы просмотреть текущие значения `$PROFILE` переменной, введите:

```powershell
$PROFILE | Get-Member -Type NoteProperty
```

Переменную можно использовать `$PROFILE` во многих командах. Например, следующая команда открывает профиль "текущий пользователь, текущий узел" в блокноте:

```powershell
notepad $PROFILE
```

Следующая команда определяет, был ли создан профиль "все пользователи, все узлы" на локальном компьютере:

```powershell
Test-Path -Path $PROFILE.AllUsersAllHosts
```

## <a name="how-to-create-a-profile"></a>Создание профиля

Чтобы создать профиль PowerShell, используйте следующий формат команды:

```powershell
if (!(Test-Path -Path <profile-name>)) {
  New-Item -ItemType File -Path <profile-name> -Force
}
```

Например, чтобы создать профиль для текущего пользователя в текущем хост-приложении PowerShell, используйте следующую команду:

```powershell
if (!(Test-Path -Path $PROFILE)) {
  New-Item -ItemType File -Path $PROFILE -Force
}
```

В этой команде `If` инструкция не позволяет перезаписывать существующий профиль. Замените значение \<profile-path\> заполнителя на путь к файлу профиля, который необходимо создать.

> [!NOTE]
> Чтобы создать профили "все пользователи" в Windows Vista и более поздних версиях Windows, запустите PowerShell с параметром " **Запуск от имени администратора** ".

## <a name="how-to-edit-a-profile"></a>Изменение профиля

Любой профиль PowerShell можно открыть в текстовом редакторе, например в блокноте.

Чтобы открыть профиль текущего пользователя в текущем ведущем приложении PowerShell в блокноте, введите:

```powershell
notepad $PROFILE
```

Чтобы открыть другие профили, укажите имя профиля. Например, чтобы открыть профиль для всех пользователей всех ведущих приложений, введите:

```powershell
notepad $PROFILE.AllUsersAllHosts
```

Чтобы применить изменения, сохраните файл профиля и перезапустите PowerShell.

## <a name="how-to-choose-a-profile"></a>Выбор профиля

Если вы используете несколько ведущих приложений, помещайте элементы, используемые во всех ведущих приложениях, в `$PROFILE.CurrentUserAllHosts` профиль. Размещение элементов, относящихся к ведущему приложению, например команды, устанавливающей цвет фона для ведущего приложения, в профиле, характерном для этого хост-приложения.

Если вы являетесь администратором, который настраивает PowerShell для многих пользователей, следуйте приведенным ниже рекомендациям.

- Хранение общих элементов в `$PROFILE.AllUsersAllHosts` профиле
- Хранение элементов, относящихся к ведущему приложению, в `$PROFILE.AllUsersCurrentHost` профилях, относящихся к ведущему приложению
- Хранение элементов для конкретных пользователей в пользовательских профилях

Обязательно ознакомьтесь с документацией по ведущему приложению, чтобы получить специальные реализации профилей PowerShell.

## <a name="how-to-use-a-profile"></a>Как использовать профиль

Многие элементы, создаваемые в PowerShell, и большинство выполняемых команд влияют только на текущий сеанс. После завершения сеанса элементы удаляются.

Команды и элементы, относящиеся к сеансу, включают переменные, привилегированные переменные, псевдонимы, функции, команды (кроме [Set-ExecutionPolicy](xref:Microsoft.PowerShell.Security.Set-ExecutionPolicy)) и модули PowerShell, добавленные в сеанс.

Чтобы сохранить эти элементы и сделать их доступными во всех будущих сеансах, добавьте их в профиль PowerShell.

Другим распространенным применением профилей является сохранение часто используемых функций, псевдонимов и переменных. При сохранении элементов в профиле их можно использовать в любом соответствующем сеансе без их повторного создания.

## <a name="how-to-start-a-profile"></a>Как запустить профиль

При открытии файла профиля он остается пустым. Однако его можно заполнить переменными, псевдонимами и командами, которые часто используются.

Вот несколько советов, которые помогут вам приступить к работе.

### <a name="add-commands-that-make-it-easy-to-open-your-profile"></a>Добавьте команды, упрощающие открытие профиля

Это особенно полезно, если используется профиль, отличный от профиля "текущий пользователь, текущий узел". Например, добавьте следующую команду:

```powershell
function Pro {notepad $PROFILE.CurrentUserAllHosts}
```

### <a name="add-a-function-that-lists-the-aliases-for-any-cmdlet"></a>Добавление функции, которая перечисляет псевдонимы для любого командлета

```powershell
function Get-CmdletAlias ($cmdletname) {
  Get-Alias |
    Where-Object -FilterScript {$_.Definition -like "$cmdletname"} |
      Format-Table -Property Definition, Name -AutoSize
}
```

### <a name="customize-your-console"></a>Настройка консоли

```powershell
function Color-Console {
  $Host.ui.rawui.backgroundcolor = "white"
  $Host.ui.rawui.foregroundcolor = "black"
  $hosttime = (Get-ChildItem -Path $PSHOME\PowerShell.exe).CreationTime
  $hostversion="$($Host.Version.Major)`.$($Host.Version.Minor)"
  $Host.UI.RawUI.WindowTitle = "PowerShell $hostversion ($hosttime)"
  Clear-Host
}
Color-Console
```

### <a name="add-a-customized-powershell-prompt"></a>Добавление настраиваемой командной строки PowerShell

```powershell
function Prompt
{
$env:COMPUTERNAME + "\" + (Get-Location) + "> "
}
```

Дополнительные сведения о командной строке PowerShell см. в разделе [about_Prompts](about_Prompts.md).

## <a name="the-noprofile-parameter"></a>Параметр параметра непрофиля

Чтобы запустить PowerShell без профилей, **используйте параметр** **PowerShell.exe**, программу, запускающую PowerShell.

Для начала откройте программу, в которой можно запустить PowerShell, например Cmd.exe или PowerShell. Можно также использовать диалоговое окно Запуск в Windows.

Тип:

```
PowerShell -NoProfile
```

Чтобы получить полный список параметров PowerShell.exe, введите:

```
PowerShell -?
```

## <a name="profiles-and-execution-policy"></a>Профили и политика выполнения

Политика выполнения PowerShell определяет, можно ли выполнять сценарии и загружать файлы конфигурации, включая профили. Политика выполнения **ограничена** по умолчанию. Это предотвращает запуск всех скриптов, включая профили. Если используется политика "ограничено", профиль не запускается и его содержимое не применяется.

`Set-ExecutionPolicy`Команда задает и изменяет политику выполнения. Это одна из нескольких команд, которые применяются во всех сеансах PowerShell, поскольку значение сохраняется в реестре. Его не нужно задавать при открытии консоли, и нет необходимости хранить `Set-ExecutionPolicy` команду в профиле.

## <a name="profiles-and-remote-sessions"></a>Профили и удаленные сеансы

Профили PowerShell не запускаются автоматически в удаленных сеансах, поэтому команды, добавленные профилями, отсутствуют в удаленном сеансе. Кроме того, `$PROFILE` Автоматическая переменная не заполняется в удаленных сеансах.

Чтобы запустить профиль в сеансе, используйте командлет [Invoke-Command](xref:Microsoft.PowerShell.Core.Invoke-Command) .

Например, следующая команда запускает профиль "текущий пользователь, текущий узел" с локального компьютера в сеансе `$s` .

```powershell
Invoke-Command -Session $s -FilePath $PROFILE
```

Следующая команда запускает профиль "текущий пользователь, текущий узел" с удаленного компьютера в сеансе `$s` . Так как `$PROFILE` переменная не заполнена, команда использует явный путь к профилю. Мы используем оператор "точка с точкой", чтобы профиль выполнялся в текущей области на удаленном компьютере, а не в собственной области.

```powershell
Invoke-Command -Session $s -ScriptBlock {
  . "$HOME\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1"
}
```

После выполнения этой команды команды, которые профиль добавляет в сеанс, будут доступны в `$s` .

## <a name="see-also"></a>См. также:

[about_Automatic_Variables](about_Automatic_Variables.md)

[about_Functions](about_Functions.md)

[about_Prompts](about_Prompts.md)

[about_Execution_Policies](about_Execution_Policies.md)

[about_Signing](about_Signing.md)

[about_Remote](about_Remote.md)

[about_Scopes](about_Scopes.md)

[Set-ExecutionPolicy](xref:Microsoft.PowerShell.Security.Set-ExecutionPolicy)

