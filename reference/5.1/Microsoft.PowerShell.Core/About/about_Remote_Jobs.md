---
description: Описывает, как выполнять фоновые задания на удаленных компьютерах.
keywords: powershell,командлет
Locale: en-US
ms.date: 12/01/2017
online version: https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_remote_jobs?view=powershell-5.1&WT.mc_id=ps-gethelp
schema: 2.0.0
title: about_Remote_Jobs
ms.openlocfilehash: 5e74de2684d65a66025c4f2c815e9130dfe57e05
ms.sourcegitcommit: f874dc1d4236e06a3df195d179f59e0a7d9f8436
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "93232309"
---
# <a name="about-remote-jobs"></a>Об удаленных заданиях

## <a name="short-description"></a>КРАТКОЕ ОПИСАНИЕ

Описывает, как выполнять фоновые задания на удаленных компьютерах.

## <a name="detailed-description"></a>ПОДРОБНОЕ ОПИСАНИЕ

Фоновое задание — это команда, которая выполняется асинхронно без взаимодействия с текущим сеансом. Командная строка немедленно возвращается, и вы можете продолжать использовать сеанс во время выполнения задания.

По умолчанию фоновые задания выполняются на локальном компьютере. Однако для выполнения фоновых заданий на удаленных компьютерах можно использовать несколько разных процедур.

В этом разделе объясняется, как запустить фоновое задание на удаленном компьютере. Дополнительные сведения о выполнении фоновых заданий на локальном компьютере см. в разделе [about_Jobs](about_Jobs.md). Дополнительные сведения о фоновых заданиях см. в разделе [about_Job_Details](about_Job_Details.md).

## <a name="remote-background-jobs"></a>УДАЛЕННЫЕ ФОНОВЫЕ ЗАДАНИЯ

Фоновые задания можно выполнять на удаленных компьютерах с помощью трех различных методов.

- Запустите интерактивный сеанс с удаленным компьютером и запустите задание в интерактивном сеансе. Процедуры совпадают с выполнением локального задания, хотя все действия выполняются на удаленном компьютере.

- Запуск фонового задания на удаленном компьютере, который возвращает результаты на локальный компьютер. Используйте этот метод, если требуется получать результаты фоновых заданий и обслуживать их в центральном расположении на локальном компьютере.

- Выполнение фонового задания на удаленном компьютере, в котором хранятся результаты на удаленном компьютере. Используйте этот метод, если данные задания более безопасно поддерживаются на исходном компьютере.

### <a name="start-a-background-job-in-an-interactive-session"></a>ЗАПУСК ФОНОВОГО ЗАДАНИЯ В ИНТЕРАКТИВНОМ СЕАНСЕ

Можно запустить интерактивный сеанс с удаленным компьютером, а затем запустить фоновое задание во время интерактивного сеанса. Дополнительные сведения о интерактивных сеансах см. в разделе about_Remote и см. в разделе Ввод-PSSession.

Процедура запуска фонового задания в интерактивном сеансе практически идентична процедуре запуска фонового задания на локальном компьютере. Однако все операции выполняются на удаленном компьютере, а не на локальном компьютере.

#### <a name="step-1-enter-pssession"></a>ШАГ 1. ВВОД-PSSESSION

Используйте командлет Enter-PSSession для запуска интерактивного сеанса с удаленным компьютером. Чтобы установить временное подключение для интерактивного сеанса, можно использовать параметр ComputerName из Enter-PSSession. Кроме того, можно использовать параметр Session для выполнения интерактивного сеанса в сеансе Windows PowerShell (PSSession).

Следующая команда запускает интерактивный сеанс на компьютере Server01.

```powershell
C:\PS> Enter-PSSession -computername Server01
```

Командная строка изменится и отобразится, что теперь вы подключены к компьютеру Server01.

```
Server01\C:>
```

#### <a name="step-2-start-job"></a>ШАГ 2. ЗАПУСК — ЗАДАНИЕ

Чтобы запустить фоновое задание в сеансе, используйте командлет Start-Job.

Следующая команда запускает фоновое задание, которое получает события в журнале событий Windows PowerShell на компьютере Server01. Командлет Start-Job возвращает объект, представляющий задание.

Эта команда сохраняет объект задания в \$ переменной задания.

```powershell
Server01\C:> $job = start-job -scriptblock {
  get-eventlog "Windows PowerShell"
}
```

Во время выполнения задания можно использовать интерактивный сеанс для выполнения других команд, включая другие фоновые задания. Однако интерактивный сеанс должен быть открыт до завершения задания. Если завершить сеанс, задание будет прервано и результаты будут утеряны.

#### <a name="step-3-get-job"></a>ШАГ 3. ПОЛУЧЕНИЕ И ЗАДАНИЕ

Чтобы узнать, завершено ли задание, отобразите значение \$ переменной задания или используйте командлет Get-Job для получения задания. Следующая команда использует командлет Get-Job для вывода задания.

```powershell
Server01\C:> get-job $job

SessionId  Name  State      HasMoreData  Location   Command
---------  ----  -----      -----------  --------   -------
1          Job1  Complete   True         localhost  get-eventlog "Windows...
```

В выходных данных Get-Job показано, что задание выполняется на компьютере "localhost", так как задание было запущено на том же компьютере (в данном случае Server01).

#### <a name="step-4-receive-job"></a>ШАГ 4. ПОЛУЧЕНИЕ-ЗАДАНИЕ

Чтобы получить результаты задания, используйте командлет Receive-Job. Результаты можно отобразить в интерактивном сеансе или сохранить в файл на удаленном компьютере. Следующая команда возвращает результаты задания в переменной $job. Команда использует оператор перенаправления (>) для сохранения результатов задания в файле PsLog.txt на компьютере Server01.

```powershell
Server01\C:> receive-job $job > c:\logs\PsLog.txt
```

#### <a name="step-5-exit-pssession"></a>ШАГ 5. EXIT-PSSESSION

Чтобы завершить интерактивный сеанс, используйте командлет Exit-PSSession. Командная строка изменится, чтобы отобразить, что вы снова используете исходный сеанс на локальном компьютере.

```powershell
Server01\C:> Exit-PSSession
C:\PS>
```

#### <a name="step-6-invoke-command-get-content"></a>ШАГ 6. ВЫЗОВ КОМАНДЫ: GET-CONTENT

Чтобы просмотреть содержимое файла PsLog.txt на компьютере Server01 в любое время, запустите другой интерактивный сеанс или выполните удаленную команду. Этот тип команды лучше выполнять в PSSession (постоянное подключение) на случай, если требуется использовать несколько команд для исследования и управления данными в файле PsLog.txt. Дополнительные сведения о PSSession см. в разделе about_PSSessions.

Следующие команды используют командлет New-PSSession для создания сеанса PSSession, подключенного к компьютеру Server01, и используют командлет Invoke-Command для выполнения команды Get-Content в сеансе PSSession для просмотра содержимого файла.

```powershell
$s = new-pssession -computername Server01
invoke-command -session $s -scriptblock {
  get-content c:\logs\pslog.txt}
```

### <a name="start-a-remote-job-that-returns-the-results-to-the-local-computer-asjob"></a>Запуск удаленного задания, которое ВОЗВРАЩАЕТ результаты на локальный компьютер ( \( ASJOB)\)

Чтобы запустить фоновое задание на удаленном компьютере, которое возвращает результаты команды на локальный компьютер, используйте параметр AsJob командлета, например командлет Invoke-Command.

При использовании параметра AsJob объект задания на самом деле создается на локальном компьютере, даже если задание выполняется на удаленном компьютере. После завершения задания результаты возвращаются на локальный компьютер.

Для управления любыми заданиями, созданными любым командлетом, можно использовать командлеты, содержащие существительное задания (командлеты задания). Многие командлеты, имеющие параметры AsJob, не используют удаленное взаимодействие Windows PowerShell, поэтому их можно использовать даже на компьютерах, которые не настроены на удаленное взаимодействие и которые не соответствуют требованиям удаленного взаимодействия.

#### <a name="step-1-invoke-command--asjob"></a>ШАГ 1. INVOKE-COMMAND-ASJOB

Следующая команда использует параметр AsJob Invoke-Command для запуска фонового задания на компьютере Server01. Задание выполняет команду Get-Eventlog, которая получает события в журнале системы. Вы можете использовать параметр JobName, чтобы назначить для задания отображаемое имя.

```powershell
invoke-command -computername Server01 -scriptblock {
  get-eventlog system} -asjob
```

Результаты выполнения команды похожи на приведенный ниже образец выходных данных.

```Output
SessionId   Name   State    HasMoreData   Location   Command
---------   ----   -----    -----------   --------   -------
1           Job1   Running  True          Server01   get-eventlog system
```

При использовании параметра AsJob Invoke-Command возвращает тот же тип объекта задания, который Start-Job возвращает. Вы можете сохранить объект задания в переменной или воспользоваться командой Get-Job для получения задания.

Обратите внимание, что значение свойства Location показывает, что задание запущено на компьютере Server01.

#### <a name="step-2-get-job"></a>ШАГ 2. ПОЛУЧЕНИЕ-ЗАДАНИЕ

Для управления заданием, запущенным с помощью параметра AsJob командлета Invoke-Command, используйте командлеты задания. Так как объект задания, представляющий удаленное задание, находится на локальном компьютере, выполнять удаленные команды для управления заданием не требуется.

Чтобы определить, завершено ли задание, используйте команду Get-Job. Следующая команда возвращает все задания, запущенные в текущем сеансе.

```powershell
get-job
```

Так как удаленное задание было запущено в текущем сеансе, локальная команда Get-Job получает задание. Свойство State объекта Job показывает, что команда выполнена успешно.

```Output
SessionId   Name   State      HasMoreData   Location   Command
---------   ----   -----      -----------   --------   -------
1           Job1   Completed  True          Server01   get-eventlog system
```

#### <a name="step-3-receive-job"></a>ШАГ 3. ПОЛУЧЕНИЕ-ЗАДАНИЕ

Чтобы получить результаты задания, используйте командлет Receive-Job. Так как результаты задания автоматически возвращаются на компьютер, где находится объект задания, результаты можно получить с помощью локальной команды Receive-Job.

Следующая команда использует командлет Receive-Job для получения результатов задания. Для идентификации задания используется идентификатор сеанса. Эта команда сохраняет результаты задания в переменной $results. Можно также перенаправить результаты в файл.

```powershell
$results = receive-job -id 1
```

### <a name="start-a-remote-job-that-keeps-the-results-on-the-remote-computer"></a>ЗАПУСК УДАЛЕННОГО ЗАДАНИЯ, СОХРАНЯЮЩЕГО РЕЗУЛЬТАТЫ НА УДАЛЕННОМ КОМПЬЮТЕРЕ

Чтобы запустить фоновое задание на удаленном компьютере, сохраняющем результаты команды на удаленном компьютере, используйте командлет Invoke-Command, чтобы выполнить команду Start-Job на удаленном компьютере. Этот метод можно использовать для выполнения фоновых заданий на нескольких компьютерах.

При удаленном запуске команды Start-Job на удаленном компьютере создается объект задания, а результаты задания сохраняются на удаленном компьютере.
С точки зрения задания все операции являются локальными. Команды выполняются удаленно для управления локальным заданием на удаленном компьютере.

#### <a name="step-1-invoke-command-start-job"></a>ШАГ 1. ЗАПУСК-КОМАНДА START — ЗАДАНИЕ

Используйте командлет Invoke-Command, чтобы выполнить команду Start-Job на удаленном компьютере.

Для этой команды требуется сеанс PSSession (постоянное подключение). Если для установления временного подключения используется параметр ComputerName Invoke-Command, то Invoke-Command команда считается завершенной при возвращении объекта задания. В результате этого временное подключение закрывается и задание отменяется.

Следующая команда использует командлет New-PSSession для создания сеанса PSSession, подключенного к компьютеру Server01. Команда сохраняет PSSession в \$ переменной s.

```powershell
$s = new-pssession -computername Server01
```

Следующая команда использует командлет Invoke-Command для выполнения команды Start-Job в сеансе PSSession. Команда Start-Job и команда Get-Eventlog заключаются в фигурные скобки.

```powershell
invoke-command -session $s -scriptblock {
  start-job -scriptblock {get-eventlog system}}
```

Результаты похожи на приведенный ниже пример выходных данных.

```Output
Id       Name    State      HasMoreData     Location   Command
--       ----    -----      -----------     --------   -------
2        Job2    Running    True            Localhost  get-eventlog system
```

При удаленном запуске команды Start-Job Invoke-Command возвращает тот же тип объекта задания, который Start-Job возвращает. Вы можете сохранить объект задания в переменной или воспользоваться командой Get-Job для получения задания.

Обратите внимание, что значение свойства Location указывает на то, что задание было запущено на локальном компьютере, известном как LocalHost, даже если задание было запущено на компьютере Server01. Так как объект задания создается на компьютере Server01 и задание выполняется на том же компьютере, оно считается локальным фоновым заданием.

#### <a name="step-2-invoke-command-get-job"></a>ШАГ 2. КОМАНДЛЕТ INVOKE-COMMAND GET-JOB

Для управления удаленным фоновым заданием используйте командлеты задания. Так как объект задания находится на удаленном компьютере, необходимо выполнить удаленные команды, чтобы получать, прекращать, ожидать или получать результаты задания.

Чтобы узнать, завершено ли задание, используйте команду Invoke-Command, чтобы выполнить команду Get-Job в сеансе PSSession, подключенном к компьютеру Server01.

```powershell
invoke-command -session $s -scriptblock {get-job}
```

Команда возвращает объект задания. Свойство State объекта Job показывает, что команда выполнена успешно.

```Output
SessionId   Name  State      HasMoreData   Location   Command
---------   ----  -----      -----------   --------   -------
2           Job2  Completed  True          LocalHost   get-eventlog system
```

#### <a name="step-3-invoke-command-receive-job"></a>ШАГ 3. ПОЛУЧЕНИЕ ВЫЗОВА КОМАНДЫ ДЛЯ ЗАДАНИЯ

Чтобы получить результаты задания, используйте командлет Invoke-Command, чтобы выполнить команду Receive-Job в сеансе PSSession, подключенном к компьютеру Server01.

Следующая команда использует командлет Receive-Job для получения результатов задания. Для идентификации задания используется идентификатор сеанса. Эта команда сохраняет результаты задания в \$ переменной results. Для сохранения результатов в кэше заданий на удаленном компьютере используется параметр сохранения Receive-Job.

```powershell
$results = invoke-command -session $s -scriptblock {
  receive-job -sessionid 2 -keep}
```

Можно также перенаправить результаты в файл на локальном или удаленном компьютере.
Следующая команда использует оператор перенаправления для сохранения результатов в файл на компьютере Server01.

```powershell
invoke-command -session $s -command {
  receive-job -sessionid 2 > c:\logs\pslog.txt}
```

## <a name="see-also"></a>СМ. ТАКЖЕ

[about_Jobs](about_Jobs.md)

[about_Job_Details](about_Job_Details.md)

[about_Remote](about_Remote.md)

[about_Remote_Variables](about_Remote_Variables.md)

[Invoke-Command](xref:Microsoft.PowerShell.Core.Invoke-Command)

[Start-Job](xref:Microsoft.PowerShell.Core.Start-Job)

[Get-Job.](xref:Microsoft.PowerShell.Core.Get-Job)

[Wait-Job](xref:Microsoft.PowerShell.Core.Wait-Job)

[Stop-Job.](xref:Microsoft.PowerShell.Core.Stop-Job)

[Remove-Job](xref:Microsoft.PowerShell.Core.Remove-Job)

[New-PSSession](xref:Microsoft.PowerShell.Core.New-PSSession)

[Enter-PSSession](xref:Microsoft.PowerShell.Core.Enter-PSSession)

[Exit-PSSession;](xref:Microsoft.PowerShell.Core.Exit-PSSession)
