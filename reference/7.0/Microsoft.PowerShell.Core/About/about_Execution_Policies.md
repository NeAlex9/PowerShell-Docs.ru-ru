---
description: Описывает политики выполнения PowerShell и способы управления ими.
keywords: powershell,командлет
Locale: en-US
ms.date: 08/10/2020
online version: https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7&WT.mc_id=ps-gethelp
schema: 2.0.0
title: about_Execution_Policies
ms.openlocfilehash: 5a9cb331c0c500f3b8bb944acdaae64788aff834
ms.sourcegitcommit: f874dc1d4236e06a3df195d179f59e0a7d9f8436
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "93232601"
---
# <a name="about-execution-policies"></a>Общие сведения о политиках выполнения

## <a name="short-description"></a>Краткое описание
Описывает политики выполнения PowerShell и способы управления ими.

## <a name="long-description"></a>Полное описание

Политика выполнения PowerShell — это функция безопасности, которая управляет условиями, при которых PowerShell загружает файлы конфигурации и запускает сценарии. Эта функция помогает предотвратить выполнение вредоносных сценариев.

На компьютере Windows можно задать политику выполнения для локального компьютера, для текущего пользователя или для конкретного сеанса. Можно также использовать параметр групповая политика, чтобы задать политики выполнения для компьютеров и пользователей.

Политики выполнения для локального компьютера и текущего пользователя хранятся в реестре. В профиле PowerShell не нужно задавать политики выполнения.
Политика выполнения для определенного сеанса сохраняется только в памяти и теряется при закрытии сеанса.

Политика выполнения не является системой безопасности, которая ограничивают действия пользователя. Например, пользователи могут без труда обходить политику, вводя содержимое скрипта в командной строке, если не удается выполнить сценарий. Вместо этого политика выполнения помогает пользователям задавать основные правила и запрещает их непреднамеренное нарушение.

На компьютерах, отличных от Windows, политика выполнения по умолчанию не **ограничена** и не может быть изменена. `Set-ExecutionPolicy`Командлет доступен, но PowerShell отображает сообщение консоли, которое не поддерживается. Несмотря `Get-ExecutionPolicy` на то, **что функция** возвращает **неограниченные** на платформах, отличных от Windows, поведение действительно соответствует обходу, поскольку эти платформы не реализуют зоны безопасности Windows.

## <a name="powershell-execution-policies"></a>Политики выполнения PowerShell

Принудительное применение этих политик выполняется только на платформах Windows. Ниже перечислены политики выполнения PowerShell.

### <a name="allsigned"></a>AllSigned

- Сценарии могут выполняться.
- требует, чтобы все скрипты и файлы конфигурации, включая скрипты, подготовленные на локальном компьютере, были подписаны доверенным издателем.
- Выводит приглашение перед запуском скриптов от издателей, которые еще не классифицированы как доверенные или ненадежные.
- Риски, в которых выполняются подписанные, но вредоносные сценарии.

### <a name="bypass"></a>обход проверки.

- ничего не блокируется, и никакие предупреждения и запросы не появляются.
- Эта политика выполнения предназначена для конфигураций, в которых сценарий PowerShell встроен в более крупное приложение, или для конфигураций, в которых PowerShell является основой для программы, имеющей собственную модель безопасности.

### <a name="default"></a>По умолчанию

- Задает политику выполнения по умолчанию.
- **Ограничено** для клиентов Windows.
- **RemoteSigned** для серверов Windows.

### <a name="remotesigned"></a>RemoteSigned

- Политика выполнения по умолчанию для компьютеров Windows Server.
- Сценарии могут выполняться.
- Требуется цифровая подпись от доверенного издателя для сценариев и файлов конфигурации, загружаемых из Интернета, которые включают программы электронной почты и мгновенные сообщения.
- Не требует цифровых подписей для сценариев, которые записываются на локальном компьютере и не загружаются из Интернета.
- Запускает скрипты, скачанные из Интернета и не подписанные, если скрипты разблокированы, например с помощью `Unblock-File` командлета.
- Риски запуска неподписанных скриптов из источников, отличных от Интернета, и подписанных сценариев, которые могут быть вредоносными.

### <a name="restricted"></a>С ограниченным доступом

- Политика выполнения по умолчанию для клиентских компьютеров Windows.
- Разрешает отдельные команды, но не разрешает сценарии.
- Предотвращает запуск всех файлов скриптов, включая файлы форматирования и конфигурации ( `.ps1xml` ), файлы скриптов модуля ( `.psm1` ) и профили PowerShell ( `.ps1` ).

### <a name="undefined"></a>Не определено.

- В текущей области не задана политика выполнения.
- Если политика выполнения во всех областях не **определена** , действующая политика выполнения **ограничена** для клиентов Windows и **RemoteSigned** для Windows Server.

### <a name="unrestricted"></a>С неограниченным доступом

- Политика выполнения по умолчанию для компьютеров, отличных от Windows, и не может быть изменена.
- Неподписанные скрипты могут выполняться. Существует риск запуска вредоносных сценариев.
- Предупреждает пользователя перед запуском скриптов и файлов конфигурации, которые не входят в зону местной интрасети.

> [!NOTE]
> В системах, которые не отличают пути UNC от Интернет-путей, сценарии, определяемые путем UNC, могут быть запрещены для выполнения с политикой выполнения **RemoteSigned** .

## <a name="execution-policy-scope"></a>Область политики выполнения

Можно задать политику выполнения, действующую только в определенной области.

Допустимые значения для **Scope** : **мачинеполици** , **UserPolicy** , **Process** , **CurrentUser** и **LocalMachine**. **Хранилище LocalMachine** используется по умолчанию при задании политики выполнения.

Значения **области** перечислены в порядке очередности. Политика, которая имеет приоритет, вступает в силу в текущем сеансе, даже если более ограничивающая политика была установлена на более низком уровне приоритета.

Дополнительные сведения см. в разделе [Set-ExecutionPolicy](xref:Microsoft.PowerShell.Security.Set-ExecutionPolicy).

### <a name="machinepolicy"></a>мачинеполици

Задается групповая политика для всех пользователей компьютера.

### <a name="userpolicy"></a>UserPolicy

Задается групповая политика для текущего пользователя компьютера.

### <a name="process"></a>Процесс

Область **процесса** влияет только на текущий сеанс PowerShell. Политика выполнения сохраняется в переменной среды `$env:PSExecutionPolicyPreference` , а не в реестре. При закрытии сеанса PowerShell переменная и значение удаляются.

### <a name="currentuser"></a>CurrentUser

политика выполнения распространяется только на текущего пользователя. Он хранится в подразделе реестра **HKEY_CURRENT_USER** .

### <a name="localmachine"></a>LocalMachine

Политика выполнения влияет на всех пользователей на текущем компьютере. Он хранится в подразделе реестра **HKEY_LOCAL_MACHINE** .

## <a name="managing-the-execution-policy-with-powershell"></a>Управление политикой выполнения с помощью PowerShell

Чтобы получить действующую политику выполнения для текущего сеанса PowerShell, используйте `Get-ExecutionPolicy` командлет.

Следующая команда получает действующую политику выполнения:

```powershell
Get-ExecutionPolicy
```

Чтобы получить все политики выполнения, влияющие на текущий сеанс, и отобразить их в порядке очередности:

```powershell
Get-ExecutionPolicy -List
```

Результат выглядит примерно так, как показано в следующем примере:

```Output
        Scope ExecutionPolicy
        ----- ---------------
MachinePolicy       Undefined
   UserPolicy       Undefined
      Process       Undefined
  CurrentUser    RemoteSigned
 LocalMachine       AllSigned
```

В этом случае действующая политика выполнения — **RemoteSigned** , так как политика выполнения для текущего пользователя имеет приоритет над политикой выполнения, заданной для локального компьютера.

Чтобы получить политику выполнения, заданную для определенной области, используйте параметр **Scope** объекта `Get-ExecutionPolicy` .

Например, следующая команда возвращает политику выполнения для области **CurrentUser** :

```powershell
Get-ExecutionPolicy -Scope CurrentUser
```

### <a name="change-the-execution-policy"></a>Изменение политики выполнения

Чтобы изменить политику выполнения PowerShell на компьютере Windows, используйте `Set-ExecutionPolicy` командлет. Изменение вступает в силу немедленно. Вам не нужно перезапускать PowerShell.

Если задать политику выполнения для областей **LocalMachine** или **CurrentUser** , это изменение будет сохранено в реестре и останется эффективным, пока вы не измените его.

Если задать политику выполнения для области **процесса** , она не будет сохранена в реестре. Политика выполнения сохраняется до закрытия текущего процесса и любых дочерних процессов.

> [!NOTE]
> В Windows Vista и более поздних версиях Windows для выполнения команд, изменяющих политику выполнения для локального компьютера, область **LocalMachine** , запустите PowerShell с параметром **Запуск от имени администратора** .

Чтобы изменить политику выполнения, выполните следующие действия.

```powershell
Set-ExecutionPolicy -ExecutionPolicy <PolicyName>
```

Пример:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned
```

Чтобы задать политику выполнения в определенной области, выполните следующие действия.

```powershell
Set-ExecutionPolicy -ExecutionPolicy <PolicyName> -Scope <scope>
```

Пример:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

Команда для изменения политики выполнения может быть выполнена, но не будет изменена действующая политика выполнения.

Например, команда, которая задает политику выполнения для локального компьютера, может быть выполнена, но переопределена политикой выполнения для текущего пользователя.

### <a name="remove-the-execution-policy"></a>Удаление политики выполнения

Чтобы удалить политику выполнения для определенной области, задайте для политики выполнения значение **undefine**.

Например, чтобы удалить политику выполнения для всех пользователей локального компьютера, выполните следующие действия.

```powershell
Set-ExecutionPolicy -ExecutionPolicy Undefined -Scope LocalMachine
```

Чтобы удалить политику выполнения для **области** , выполните следующие действия.

```powershell
Set-ExecutionPolicy -ExecutionPolicy Undefined -Scope CurrentUser
```

Если в какой-либо области не задана политика выполнения, действующая политика выполнения **ограничена** , что является значением по умолчанию для клиентов Windows.

### <a name="set-a-different-policy-for-one-session"></a>Задание другой политики для одного сеанса

Чтобы задать политику выполнения для нового сеанса PowerShell, можно использовать параметр **ExecutionPolicy** **pwsh.exe** . Политика влияет только на текущий сеанс и дочерние сеансы.

Чтобы задать политику выполнения для нового сеанса, запустите PowerShell из командной строки, например **cmd.exe** или PowerShell, а затем используйте параметр **ExecutionPolicy** из **pwsh.exe** , чтобы задать политику выполнения.

Пример:

```powershell
pwsh.exe -ExecutionPolicy AllSigned
```

Заданная политика выполнения не хранится в реестре. Вместо этого он хранится в `$env:PSExecutionPolicyPreference` переменной среды. Переменная удаляется при закрытии сеанса, в котором задана политика. Вы не можете изменить политику, изменив значение переменной.

Во время сеанса политика выполнения, заданная для сеанса, имеет приоритет над политикой выполнения, заданной в реестре для локального компьютера или текущего пользователя. Однако он не имеет приоритета над политикой выполнения, заданной с помощью групповая политика.

## <a name="use-group-policy-to-manage-execution-policy"></a>Использование групповая политика для управления политикой выполнения

Для управления политикой выполнения компьютеров предприятия можно использовать параметр групповая политика **включить выполнение скрипта** . Параметр групповая политика переопределяет политики выполнения, заданные в PowerShell во всех областях.

Включить параметры политики **выполнения сценария** следующим образом:

- Если отключить **выполнение скрипта** , скрипты не будут выполняться. Это эквивалентно **ограниченной** политике выполнения.
- Если включить **выполнение скрипта** , можно выбрать политику выполнения. Параметры групповая политика эквивалентны следующим параметрам политики выполнения.

  | Групповая политика                                  | Политика выполнения |
  | --------------------------------------------- | ---------------- |
  | Разрешить все скрипты                             | С неограниченным доступом     |
  | Разрешить локальные скрипты и удаленные подписанные скрипты | RemoteSigned     |
  | Разрешить только подписанные скрипты                     | AllSigned        |

- Если параметр **включить выполнение скрипта** не настроен, он не будет действовать. Политика выполнения, заданная в PowerShell, вступает в силу.

Файлы Повершеллексекутионполици. adm и Повершеллексекутионполици. ADMX добавляют политику **выполнения сценария включения** в узлы Конфигурация компьютера и Конфигурация пользователя в групповая политика Editor по следующим путям.

Для Windows XP и Windows Server 2003:

Административные шаблоны управления Windows — PowerShell

Для Windows Vista и более поздних версий Windows:

Администрирование Темплатес\классик административные шаблоны \
Windows \ PowerShell

Политики, заданные в узле Конфигурация компьютера, имеют приоритет над политиками, заданными в узле Конфигурация пользователя.

Дополнительные сведения см. в статье [О параметрах групповой политики](about_Group_Policy_Settings.md).

### <a name="execution-policy-precedence"></a>Приоритет политики выполнения

При определении действующей политики выполнения для сеанса PowerShell оценивает политики выполнения в следующем порядке очередности.

- Групповая политика: Мачинеполици
- Групповая политика: UserPolicy
- Политика выполнения: процесс (или `pwsh.exe -ExecutionPolicy` )
- Политика выполнения: CurrentUser
- Политика выполнения: LocalMachine

## <a name="manage-signed-and-unsigned-scripts"></a>Управление подписанными и неподписанными скриптами

В Windows такие программы, как Internet Explorer и Microsoft ребр, добавляют альтернативный поток данных к загруженным файлам. Этот файл помечается как «поступающий из Интернета». Если политика выполнения PowerShell — **RemoteSigned** , PowerShell не будет запускать неподписанные сценарии, которые загружаются из Интернета, в том числе программы электронной почты и обмена мгновенными сообщениями.

Вы можете подписать сценарий или выбрать Запуск неподписанного скрипта без изменения политики выполнения.

Начиная с версии PowerShell 3,0 можно использовать параметр **Stream** `Get-Item` командлета для обнаружения заблокированных файлов, так как они были загружены из Интернета. Используйте `Unblock-File` командлет, чтобы разблокировать скрипты, чтобы их можно было запускать в PowerShell.

Дополнительные сведения см. в разделе [about_Signing](about_Signing.md), [Get-Item](xref:Microsoft.PowerShell.Management.Get-Item)и [Unblock-File](xref:Microsoft.PowerShell.Utility.Unblock-File).

> [!NOTE]
> Другие методы загрузки файлов могут не помечать файлы как поступающие из зоны Интернета. Некоторые примеры:
>
> - `curl.exe`
> - `Invoke-RestMethod`
> - `Invoke-WebRequest`

## <a name="execution-policy-on-windows-server-core-and-window-nano-server"></a>Политика выполнения в Windows Server Core и в окне Nano Server

Когда PowerShell 6 запускается на Windows Server Core или Windows Nano Server при определенных условиях, политики выполнения могут завершиться со следующей ошибкой:

```Output
AuthorizationManager check failed.
At line:1 char:1
+ C:\scriptpath\scriptname.ps1
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess
```

PowerShell использует интерфейсы API в оболочке Windows Desktop Shell ( `explorer.exe` ) для проверки зоны файла скрипта. Оболочка Windows недоступна в Windows Server Core и Windows Nano Server.

Эту ошибку также можно получить в любой системе Windows, если оболочка Windows для настольных компьютеров недоступна или не отвечает. Например, во время входа сценарий входа PowerShell может начать выполнение до того, как рабочий стол Windows будет готов, что приведет к сбою.

При использовании политики выполнения **обхода** или **AllSigned** не требуется проверка зоны, которая позволяет избежать проблемы.

## <a name="see-also"></a>См. также:

[about_Environment_Variables](about_Environment_Variables.md)

[about_Group_Policy_Settings](about_Group_Policy_Settings.md)

[about_Signing](about_Signing.md)

[Get-ExecutionPolicy](xref:Microsoft.PowerShell.Security.Get-ExecutionPolicy)

[Get-Item](xref:Microsoft.PowerShell.Management.Get-Item)

[Справка по консоли Pwsh](about_pwsh.md)

[Set-ExecutionPolicy](xref:Microsoft.PowerShell.Security.Set-ExecutionPolicy)

[Unblock-File](xref:Microsoft.PowerShell.Utility.Unblock-File)
