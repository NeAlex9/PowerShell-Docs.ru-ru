---
ms.date: 06/12/2017
keywords: jea,powershell,безопасность
title: Вопросы безопасности JEA
ms.openlocfilehash: 9526e141517601ae3b6d6932cd3536fdf49aa9a6
ms.sourcegitcommit: e7445ba8203da304286c591ff513900ad1c244a4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62084782"
---
# <a name="jea-security-considerations"></a><span data-ttu-id="6c3f5-103">Вопросы безопасности JEA</span><span class="sxs-lookup"><span data-stu-id="6c3f5-103">JEA Security Considerations</span></span>

> <span data-ttu-id="6c3f5-104">Применяется к: Windows PowerShell 5.0</span><span class="sxs-lookup"><span data-stu-id="6c3f5-104">Applies to: Windows PowerShell 5.0</span></span>

<span data-ttu-id="6c3f5-105">JEA помогает повысить уровень безопасности за счет сокращения числа постоянных администраторов на компьютерах.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-105">JEA helps you improve your security posture by reducing the number of permanent administrators on your machines.</span></span>
<span data-ttu-id="6c3f5-106">Это достигается путем создания новой точки входа пользователей для управления системой (конфигурация сеанса PowerShell), которая по умолчанию надежно защищена от несанкционированного использования.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-106">It does so by creating a new entry point for users to manage the system (a PowerShell session configuration) which is tightly locked down by default to prevent misuse.</span></span>
<span data-ttu-id="6c3f5-107">Пользователи, которым требуется некоторый (но не неограниченный) уровень доступа к компьютеру для выполнения административных задач, могут получить доступ к конечной точке JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-107">Users who need some, but not unlimited, access to the machine to perform administrative tasks can be granted access to the JEA endpoint.</span></span>
<span data-ttu-id="6c3f5-108">Поскольку JEA разрешает им запускать команды администратора без непосредственного административного доступа, их можно удалить из высокопривилегированных групп безопасности (сделав обычными пользователями).</span><span class="sxs-lookup"><span data-stu-id="6c3f5-108">Because JEA allows them to run admin commands without directly having admin access, you can then remove those users from highly privileged security groups (make them standard users).</span></span>

<span data-ttu-id="6c3f5-109">Этот раздел подробнее описывает рекомендации и модель безопасности для JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-109">This topic describes the JEA security model and best practices in more detail.</span></span>

## <a name="run-as-account"></a><span data-ttu-id="6c3f5-110">учетная запись запуска от имени</span><span class="sxs-lookup"><span data-stu-id="6c3f5-110">Run As account</span></span>

<span data-ttu-id="6c3f5-111">Каждая конечная точка JEA имеет назначенную учетную запись запуска от имени, с помощью которой выполняются действия подключающегося пользователя.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-111">Each JEA endpoint has a designated "run as" account, which is the account under which the connecting user's actions are performed.</span></span>
<span data-ttu-id="6c3f5-112">Эта учетная запись настраивается в [файле конфигурации сеанса](session-configurations.md), и ее выбор оказывает значительное влияние на безопасность конечной точки.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-112">This account is configurable in the [session configuration file](session-configurations.md), and the account you choose has a significant bearing on the security of your endpoint.</span></span>

<span data-ttu-id="6c3f5-113">Рекомендуемым способом настройки учетной записи запуска от имени являются **виртуальные учетные записи**.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-113">**Virtual accounts** are the recommended way of configuring the run as account.</span></span>
<span data-ttu-id="6c3f5-114">Виртуальные учетные записи — это одноразовые временные локальные учетные записи, созданные для использования подключающимся пользователем во время сеанса JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-114">Virtual accounts are one-time, temporary local accounts that are created for the connecting user to use during the duration of their JEA session.</span></span>
<span data-ttu-id="6c3f5-115">После завершения его сеанса виртуальная учетная запись будет уничтожена, а ее дальнейшее использование станет невозможным.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-115">As soon as their session is terminated, the virtual account will be destroyed and cannot be used anymore.</span></span>
<span data-ttu-id="6c3f5-116">Подключающийся пользователь не знает учетных данных для виртуальной учетной записи и не может использовать ее для доступа к системе другими средствами, такими как удаленный рабочий стол или конечная точка PowerShell без ограничений.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-116">The connecting user does not know the credentials for the virtual account and cannot use the virtual account to access the system via other means, such as Remote Desktop or an unconstrained PowerShell endpoint.</span></span>

<span data-ttu-id="6c3f5-117">По умолчанию виртуальные учетные записи принадлежат к локальной группе администраторов на компьютере.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-117">By default, virtual accounts belong to the local administrators group on the machine.</span></span>
<span data-ttu-id="6c3f5-118">Это дает им полные права на управление всеми компонентами в системе, но не дает прав на управление ресурсами в сети.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-118">This gives them full rights to manage anything on the system, but no rights to manage resources on the network.</span></span>
<span data-ttu-id="6c3f5-119">При выполнении аутентификации на других компьютерах контекстом пользователя становится локальная учетная запись компьютера, а не виртуальная учетная запись.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-119">When authenticating with other machines, the user context will be that of the local computer account, not the virtual account.</span></span>

<span data-ttu-id="6c3f5-120">Контроллеры домена — это особый случай, так как понятие группы локальных администраторов отсутствует.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-120">Domain controllers are a special case since there is no concept of a local administrators group.</span></span>
<span data-ttu-id="6c3f5-121">Вместо этого виртуальные учетные записи принадлежат роли администраторов домена, следовательно, используя их, можно управлять службами каталогов в контроллере домена.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-121">Instead, virtual accounts belong to Domain Admins instead and can manage the directory services on the domain controller.</span></span>
<span data-ttu-id="6c3f5-122">Использование идентификатора по-прежнему ограничивается контроллером домена, где инициирован сеанс JEA, когда любой доступ к сети будет отображаться как связанный с объектом компьютера контроллера домена в качестве источника.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-122">The domain identity is still restricted to use on the domain controller where the JEA session was instantiated, and any network access will appear to come from the domain controller computer object instead.</span></span>

<span data-ttu-id="6c3f5-123">В обоих случаях можно явно определить, к каким группам безопасности должна принадлежать виртуальная учетная запись.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-123">In both cases, you can also explicitly define which security groups the virtual account should belong to.</span></span>
<span data-ttu-id="6c3f5-124">Этой рекомендации стоит придерживаться, когда для выполнения задачи не требуются права локального администратора или администратора домена.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-124">This is a good practice when the task you are performing can be done without local/domain admin privileges.</span></span>
<span data-ttu-id="6c3f5-125">Если у вас уже определена группа безопасности для администраторов, можно просто предоставить виртуальной учетной записи членство в этой группе для назначения ей необходимых разрешений.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-125">If you already have a security group defined for your admins, you can simply grant the virtual account membership to that group to give it the permissions it needs.</span></span>
<span data-ttu-id="6c3f5-126">Виртуальная учетная запись может быть членом локальных групп безопасности на рабочей станции или рядовом сервере, но на контроллере домена она может быть только членом групп безопасности домена.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-126">Virtual account group membership is limited to local security groups on workstation and member servers, but on a domain controller they can only be members of domain security groups.</span></span>
<span data-ttu-id="6c3f5-127">Если для виртуальной учетной записи указана одна или несколько групп безопасности, она больше не будет принадлежать к группам по умолчанию (локальный администратор или администратор домена).</span><span class="sxs-lookup"><span data-stu-id="6c3f5-127">Once you specify one or more security groups for the virtual account to belong to, it will no longer belong to the default groups (local admin or domain admin).</span></span>

<span data-ttu-id="6c3f5-128">В таблице ниже приведены возможные параметры и итоговые разрешения для виртуальных учетных записей:</span><span class="sxs-lookup"><span data-stu-id="6c3f5-128">The table below summarizes the possible configuration options and resulting permissions for virtual accounts</span></span>

<span data-ttu-id="6c3f5-129">Тип компьютера</span><span class="sxs-lookup"><span data-stu-id="6c3f5-129">Computer type</span></span>                | <span data-ttu-id="6c3f5-130">Конфигурация виртуальной учетной записи группы</span><span class="sxs-lookup"><span data-stu-id="6c3f5-130">Virtual account group configuration</span></span> | <span data-ttu-id="6c3f5-131">Контекст локального пользователя</span><span class="sxs-lookup"><span data-stu-id="6c3f5-131">Local user context</span></span>                                      | <span data-ttu-id="6c3f5-132">Контекст сетевого пользователя</span><span class="sxs-lookup"><span data-stu-id="6c3f5-132">Network user context</span></span>
-----------------------------|-------------------------------------|---------------------------------------------------------|--------------------------------------------------
<span data-ttu-id="6c3f5-133">Контроллер домена</span><span class="sxs-lookup"><span data-stu-id="6c3f5-133">Domain controller</span></span>            | <span data-ttu-id="6c3f5-134">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="6c3f5-134">Default</span></span>                             | <span data-ttu-id="6c3f5-135">Пользователь домена, член группы "*DOMAIN*\Domain Admins"</span><span class="sxs-lookup"><span data-stu-id="6c3f5-135">Domain user, member of '*DOMAIN*\Domain Admins'</span></span>         | <span data-ttu-id="6c3f5-136">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="6c3f5-136">Computer account</span></span>
<span data-ttu-id="6c3f5-137">Контроллер домена</span><span class="sxs-lookup"><span data-stu-id="6c3f5-137">Domain controller</span></span>            | <span data-ttu-id="6c3f5-138">Группы доменов A и B</span><span class="sxs-lookup"><span data-stu-id="6c3f5-138">Domain groups A and B</span></span>               | <span data-ttu-id="6c3f5-139">Пользователь домена, член групп "*DOMAIN*\A", "*DOMAIN*\B"</span><span class="sxs-lookup"><span data-stu-id="6c3f5-139">Domain user, member of '*DOMAIN*\A', '*DOMAIN*\B'</span></span>       | <span data-ttu-id="6c3f5-140">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="6c3f5-140">Computer account</span></span>
<span data-ttu-id="6c3f5-141">Рядовой сервер или рабочая станция</span><span class="sxs-lookup"><span data-stu-id="6c3f5-141">Member server or workstation</span></span> | <span data-ttu-id="6c3f5-142">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="6c3f5-142">Default</span></span>                             | <span data-ttu-id="6c3f5-143">Локальный пользователь, член группы "*BUILTIN*\Administrators"</span><span class="sxs-lookup"><span data-stu-id="6c3f5-143">Local user, member of '*BUILTIN*\Administrators'</span></span>        | <span data-ttu-id="6c3f5-144">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="6c3f5-144">Computer account</span></span>
<span data-ttu-id="6c3f5-145">Рядовой сервер или рабочая станция</span><span class="sxs-lookup"><span data-stu-id="6c3f5-145">Member server or workstation</span></span> | <span data-ttu-id="6c3f5-146">Локальные группы C и D</span><span class="sxs-lookup"><span data-stu-id="6c3f5-146">Local groups C and D</span></span>                | <span data-ttu-id="6c3f5-147">Локальный пользователь, член групп "*COMPUTER*\C" и "*COMPUTER*\D"</span><span class="sxs-lookup"><span data-stu-id="6c3f5-147">Local user, member of '*COMPUTER*\C' and '*COMPUTER*\D'</span></span> | <span data-ttu-id="6c3f5-148">Учетная запись компьютера</span><span class="sxs-lookup"><span data-stu-id="6c3f5-148">Computer account</span></span>

<span data-ttu-id="6c3f5-149">При просмотре событий аудита безопасности и журналов событий приложений вы увидите, что каждый сеанс пользователя JEA имеет уникальную виртуальную учетную запись.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-149">When you look at security audit events and application event logs, you will see that each JEA user session has a unique virtual account.</span></span>
<span data-ttu-id="6c3f5-150">Это помогает отслеживать действия в конечной точке JEA до исходного пользователя, выполнившего команду.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-150">This helps you track user actions in a JEA endpoint back to the original user who ran the command.</span></span>
<span data-ttu-id="6c3f5-151">Имена виртуальных учетных записей соответствуют формату "WinRM Virtual Users\\WinRM\_VA\_*ACCOUNTNUMBER*\_*DOMAIN*\_*sAMAccountName*". Например, если пользователь "Alice" в домене "Contoso" перезапускает службы в конечной точке JEA, имя пользователя, связанное с любыми событиями диспетчера служб, будет иметь вид "WinRM Virtual Users\\WinRM\_VA\_1\_contoso\_alice".</span><span class="sxs-lookup"><span data-stu-id="6c3f5-151">Virtual account names follow the format "WinRM Virtual Users\\WinRM\_VA\_*ACCOUNTNUMBER*\_*DOMAIN*\_*sAMAccountName*" For example, if user "Alice" in domain "Contoso" restarts a service in a JEA endpoint, the username associated with any service control manager events would be "WinRM Virtual Users\\WinRM\_VA\_1\_contoso\_alice".</span></span>


<span data-ttu-id="6c3f5-152">**Групповые управляемые учетные записи службы (gMSA)** полезны, когда рядовому серверу требуется доступ к сетевым ресурсам в сеансе JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-152">**Group managed service accounts (gMSAs)** are useful when a member server needs to have access to network resources in the JEA session.</span></span>
<span data-ttu-id="6c3f5-153">Примером такого варианта применения является конечная точка JEA, используемая для управления доступом к REST API, размещенном на другом компьютере.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-153">An example use case for this is a JEA endpoint that is used to control access to a REST API hosted on a different machine.</span></span>
<span data-ttu-id="6c3f5-154">Написание функций для выполнения нужных вызовов REST API не вызывает сложностей, однако в целях проверки подлинности для API вам потребуется сетевое удостоверение.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-154">It is easy to write functions to make the desired invocations on the REST API, but in order to authenticate with the API you need a network identity.</span></span>
<span data-ttu-id="6c3f5-155">Использование групповой управляемой учетной записи службы позволяет сделать "второй прыжок" и при этом управлять доступом компьютеров к этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-155">Using a group managed service account makes the "second hop" possible while still having control over which computers can use the account.</span></span>
<span data-ttu-id="6c3f5-156">Действующие разрешения учетной записи gMSA определяются группами безопасности (локальные или доменные), к которым она принадлежит.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-156">The effective permissions of the gMSA are defined by the security groups (local or domain) to which the gMSA account belongs.</span></span>

<span data-ttu-id="6c3f5-157">Когда конечная точка JEA настроена для использования учетной записи gMSA, действия всех пользователей JEA относятся к одной учетной записи gMSA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-157">When a JEA endpoint is configured to use a gMSA account, the actions of all JEA users will appear to come from the same group managed service account.</span></span>
<span data-ttu-id="6c3f5-158">Единственный способ установления связи действий с конкретным пользователем заключается в определении набора запущенных команд в записи сеанса PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-158">The only way you can trace actions back to a specific user is to identify the set of commands run in a PowerShell session transcript.</span></span>

<span data-ttu-id="6c3f5-159">**Сквозные учетные данные** — если не указать учетную запись запуска от имени, PowerShell будет использовать учетные данные подключающегося пользователя для выполнения команд на удаленном сервере.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-159">**Pass-thru credentials** are used when you do not specify a run as account and want PowerShell to use the connecting user's credential to run commands on the remote server.</span></span>
<span data-ttu-id="6c3f5-160">Такая конфигурация *не* является рекомендуемой для JEA, так как требует от вас предоставить подключающемуся пользователю прямой доступ к привилегированным группам управления.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-160">This configuration is *not* recommended for JEA as it would require you to grant the connecting user direct access to privileged management groups.</span></span>
<span data-ttu-id="6c3f5-161">Если подключающийся пользователь уже имеет права администратора, можно полностью отказаться от JEA и управлять системой посредством других средств, не имеющих ограничений.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-161">If the connecting user already has admin privileges, they can avoid JEA altogether and manage the system via other, unconstrained means.</span></span>
<span data-ttu-id="6c3f5-162">Дополнительные сведения см. в разделе [Отсутствие защиты от администраторов в JEA](#jea-does-not-protect-against-admins) ниже.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-162">See the section below on how [JEA does not protect against admins](#jea-does-not-protect-against-admins) for more information.</span></span>

<span data-ttu-id="6c3f5-163">**Стандартные учетные записи запуска от имени** позволяют задать любую учетную запись пользователя, с использованием которой будет выполняться весь сеанс PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-163">**Standard run as accounts** allow you to specify any user account under which the entire PowerShell session will run.</span></span>
<span data-ttu-id="6c3f5-164">Это важное отличие, так как конфигурация сеанса, настроенная для использования фиксированной учетной записи запуска от имени (с помощью параметра `-RunAsCredential`), не поддерживает функции JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-164">This is an important distinction, because a session configuration set to use a fixed run as account (with the `-RunAsCredential` parameter) is not JEA-aware.</span></span>
<span data-ttu-id="6c3f5-165">Это означает, что определения ролей перестают работать должным образом, а каждому пользователю, авторизованному для доступа к конечной точке, будет назначаться одна и та же роль.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-165">That means that role definitions no longer function as expected, and every user authorized to access the endpoint will be assigned the same role.</span></span>

<span data-ttu-id="6c3f5-166">Не следует использовать RunAsCredential на конечной точке JEA из-за сложности определения связи действий с конкретными пользователями и отсутствия поддержки для сопоставления пользователей с ролями.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-166">You should not use a RunAsCredential on a JEA endpoint because of the difficulty in tracing actions back to specific users and the lack of support for mapping users to roles.</span></span>

## <a name="winrm-endpoint-acl"></a><span data-ttu-id="6c3f5-167">ACL конечной точки WinRM</span><span class="sxs-lookup"><span data-stu-id="6c3f5-167">WinRM Endpoint ACL</span></span>

<span data-ttu-id="6c3f5-168">Как и в случае с обычными конечными точками удаленного взаимодействия PowerShell, каждая конечная точка JEA имеет отдельный список управления доступом (ACL), заданный в конфигурации WinRM, который указывает, кто именно может проходить проверку подлинности на базе конечной точки JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-168">As with regular PowerShell remoting endpoints, each JEA endpoint has a separate access control list (ACL) set in the WinRM configuration that controls who can authenticate with the JEA endpoint.</span></span>
<span data-ttu-id="6c3f5-169">При неправильной настройке доступ к конечной точке JEA может отсутствовать у доверенных пользователей и (или) предоставляться ненадежным пользователям.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-169">If improperly configured, trusted users may not be able to access the JEA endpoint and/or untrusted users may gain access.</span></span>
<span data-ttu-id="6c3f5-170">Однако ACL WinRM не влияет на сопоставление пользователей с ролями JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-170">The WinRM ACL does not, however, affect the mapping of users to JEA roles.</span></span>
<span data-ttu-id="6c3f5-171">Это регулируется полем *RoleDefinitions* в файле конфигурации сеанса, который был зарегистрирован в системе.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-171">That is controlled by the *RoleDefinitions* field in the session configuration file that was registered on the system.</span></span>

<span data-ttu-id="6c3f5-172">По умолчанию при регистрации конечной точки JEA с помощью файла конфигурации сеанса и одной или нескольких возможностей ролей ACL WinRM будет настроен для предоставления всем пользователям сопоставления с одной или несколькими ролями для доступа к конечной точке.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-172">By default, when you register a JEA endpoint using a session configuration file and one or more role capabilities, the WinRM ACL will be configured to allow all users mapping to one or more roles access to the endpoint.</span></span>
<span data-ttu-id="6c3f5-173">Например, сеанс JEA, настроенный с помощью указанных ниже команд, будет предоставлять полный доступ к *CONTOSO\JEA\_Lev1* и *CONTOSO\JEA\_Lev2*.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-173">For example, a JEA session configured using the following commands will grant full access to *CONTOSO\JEA\_Lev1* and *CONTOSO\JEA\_Lev2*.</span></span>

```powershell
$roles = @{ 'CONTOSO\JEA_Lev1' = 'Lev1Role'; 'CONTOSO\JEA_Lev2' = 'Lev2Role' }
New-PSSessionConfigurationFile -Path '.\jea.pssc' -SessionType RestrictedRemoteServer -RoleDefinitions $roles -RunAsVirtualAccount
Register-PSSessionConfiguration -Path '.\jea.pssc' -Name 'MyJEAEndpoint'
```

<span data-ttu-id="6c3f5-174">Можно проводить аудит разрешений пользователя с помощью командлета [Get-PSSessionConfiguration](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.core/get-pssessionconfiguration).</span><span class="sxs-lookup"><span data-stu-id="6c3f5-174">You can audit user permissions with the [Get-PSSessionConfiguration](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.core/get-pssessionconfiguration) cmdlet.</span></span>

```powershell
PS C:\> Get-PSSessionConfiguration -Name 'MyJEAEndpoint' | Select-Object Permission

Permission
----------
CONTOSO\JEA_Lev1 AccessAllowed
CONTOSO\JEA_Lev2 AccessAllowed
```

<span data-ttu-id="6c3f5-175">Чтобы изменить пользователей, имеющих доступ, запустите `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` для вывода интерактивной командной строки или `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` для изменения разрешений.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-175">To change which users have access, run either `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` for an interactive prompt or `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` to update the permissions.</span></span>
<span data-ttu-id="6c3f5-176">Для доступа к конечной точке JEA пользователям требуется по меньшей мере права *вызова*.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-176">Users need at least *Invoke* rights to access the JEA endpoint.</span></span>

<span data-ttu-id="6c3f5-177">Если дополнительные пользователи получают доступ к конечной точке JEA, но не соответствуют ни одной роли, определенной в файле конфигурации сеанса, они смогут запустить сеанс JEA, но при этом использовать только командлеты по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-177">If additional users are granted access to the JEA endpoint but do not fall into any of the roles defined in the session configuration file, they will be able to start a JEA session but only have access to the default cmdlets.</span></span>
<span data-ttu-id="6c3f5-178">Можно выполнить аудит разрешений пользователя в конечной точке JEA, запустив `Get-PSSessionCapability`.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-178">You can audit user permissions in a JEA endpoint by running `Get-PSSessionCapability`.</span></span>
<span data-ttu-id="6c3f5-179">Ознакомьтесь со статьей [Аудит и отчеты для JEA](audit-and-report.md) для получения дополнительных сведений об аудите команд, к которым пользователь имеет доступ в конечной точке JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-179">Check out the [Auditing and Reporting on JEA](audit-and-report.md) article for more information about auditing which commands a user has access to in a JEA endpoint.</span></span>

## <a name="least-privilege-roles"></a><span data-ttu-id="6c3f5-180">Роли, предоставляющие минимальные права</span><span class="sxs-lookup"><span data-stu-id="6c3f5-180">Least privilege roles</span></span>

<span data-ttu-id="6c3f5-181">При разработке ролей JEA важно помнить о том, что виртуальная или групповая управляемая учетная запись, используемая внутри системы, часто имеет неограниченный доступ к функциям управления локальным компьютером.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-181">When designing JEA roles, it is important to remember that the virtual or group managed service account running behind the scenes often has unrestricted access to manage the local machine.</span></span>
<span data-ttu-id="6c3f5-182">Возможности ролей JEA помогают сузить сферу применения учетной записи, ограничив число команд и приложений, которые могут выполняться, с использованием этого привилегированного контекста.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-182">JEA role capabilities help restrict what that account can be used for by limiting the commands and applications that can be run using that privileged context.</span></span>
<span data-ttu-id="6c3f5-183">Неправильно спроектированные роли могут разрешать запуск опасных команд, позволяющих пользователю нарушить границы JEA или получить доступ к конфиденциальной информации.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-183">Improperly designed roles can allow dangerous commands to run that may allow a user to break out of the JEA boundaries or obtain access to sensitive information.</span></span>

<span data-ttu-id="6c3f5-184">Рассмотрим, например, следующую запись возможности роли:</span><span class="sxs-lookup"><span data-stu-id="6c3f5-184">For example, consider the following role capability entry:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\*-Process'
}
```

<span data-ttu-id="6c3f5-185">Эта возможность роли позволяет пользователям запустить любой командлет PowerShell с существительным "Process" из модуля Microsoft.PowerShell.Management.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-185">This role capability allows users to run any PowerShell cmdlet with the noun "Process" from the Microsoft.PowerShell.Management module.</span></span>
<span data-ttu-id="6c3f5-186">Пользователям может потребоваться доступ к таким командлетам, как `Get-Process`, чтобы понять, какие именно приложения запущены в системе, и `Stop-Process`, чтобы завершить приложения, которые не отвечают.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-186">Users may need to access cmdlets like `Get-Process` to understand what applications are running on the system and `Stop-Process` to kill any applications that are not responding.</span></span>
<span data-ttu-id="6c3f5-187">Однако данная запись также разрешает `Start-Process`, который можно использовать для запуска произвольной программы с полными правами администратора.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-187">However, this entry also allows `Start-Process`, which can be used to start up an arbitrary program with full administrator permissions.</span></span>
<span data-ttu-id="6c3f5-188">Так как локальная установка программы не требуется, злоумышленник может просто запустить из общего файлового ресурса программу, предоставляющую подключающемуся пользователю права локального администратора, запускающая вредоносное ПО и выполняющая многие другие операции.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-188">The program doesn't need to be installed locally on the system, so an adversary could simply start a program on a file share that gives the connecting user local admin privileges, runs malware, and more.'</span></span>

<span data-ttu-id="6c3f5-189">Более безопасная версия этой же возможности роли выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="6c3f5-189">A more secure version of this same role capability would look like:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\Get-Process', 'Microsoft.PowerShell.Management\Stop-Process'
}
```

<span data-ttu-id="6c3f5-190">Избегайте использования подстановочных знаков в возможностях ролей и не забудьте регулярно проводить [аудит действующих разрешений пользователя](audit-and-report.md#check-effective-rights-for-a-specific-user), чтобы понять, какие команды доступны пользователю.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-190">Avoid using wildcards in role capabilities, and be sure to [audit effective user permissions](audit-and-report.md#check-effective-rights-for-a-specific-user) regularly to understand which commands a user has access to.</span></span>

## <a name="jea-does-not-protect-against-admins"></a><span data-ttu-id="6c3f5-191">Отсутствие защиты от администраторов в JEA</span><span class="sxs-lookup"><span data-stu-id="6c3f5-191">JEA does not protect against admins</span></span>

<span data-ttu-id="6c3f5-192">Одним из основных принципов функции JEA является то, что она позволяет пользователям без прав администратора выполнять *некоторые* задачи администрирования.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-192">One of the core principles of JEA is that it allows non-admins to perform *some* admin tasks.</span></span>
<span data-ttu-id="6c3f5-193">JEA не защищает от тех пользователей, кто уже обладает правами администратора.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-193">JEA does not protect against those who already have administrator privileges.</span></span>
<span data-ttu-id="6c3f5-194">Пользователи, входящие в группу администраторов домена, локальных администраторов, или другие высокопривилегированные группы в вашей среде могут обойти средства защиты JEA, выполнив вход на компьютер другими средствами.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-194">Users who belong "domain admins," "local admins," or other highly privileged groups in your environment will still be able to get around JEA's protections by signing into the machine via another means.</span></span>
<span data-ttu-id="6c3f5-195">Например, они могут войти в систему с помощью протокола удаленного рабочего стола, использовать удаленные консоли MMC или подключиться к конечным точкам PowerShell, не имеющим ограничений.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-195">They could, for example, sign in with RDP, use remote MMC consoles, or connect to unconstrained PowerShell endpoints.</span></span>
<span data-ttu-id="6c3f5-196">Локальные администраторы также могут изменить конфигурацию JEA, чтобы разрешить другим пользователям управлять системой, либо изменить возможность роли, расширив область действия пользователя в своем сеансе JEA.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-196">Local admins on the system can also modify JEA configurations to allow additional users to manage the system or change a role capability to extend the scope of what a user can do in their JEA session.</span></span>
<span data-ttu-id="6c3f5-197">Поэтому важно оценить расширенные разрешения пользователей JEA и попытаться определить другие способы, с помощью которых они могут получить привилегированный доступ к системе.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-197">It is therefore important to evaluate your JEA users' extended permissions to see if there are other ways they could gain privileged access to the system.</span></span>

<span data-ttu-id="6c3f5-198">Распространенной практикой является использование JEA для регулярного повседневного обслуживания и наличие решения по управлению привилегированным доступом "JIT", что позволяет пользователям временно становиться локальными администраторами в аварийных ситуациях.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-198">A common practice is to use JEA for regular day-to-day maintenance and have a "just in time" privileged access management solution allow users to temporarily become local admins in emergency situations.</span></span>
<span data-ttu-id="6c3f5-199">При этом пользователи не являются постоянными администраторами системы и могут получить подобные права только после завершения рабочего процесса, регулирующего использование ими таких разрешений.</span><span class="sxs-lookup"><span data-stu-id="6c3f5-199">This helps ensure users are not permanent admins on the system, but can get those rights if, and only when, they complete a workflow that documents their use of those permissions.</span></span>